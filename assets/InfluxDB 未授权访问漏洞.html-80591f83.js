import{_ as i}from"./plugin-vue_export-helper-c27b6911.js";import{r as d,o as s,c as r,a as e,b as t,d as a,e as o}from"./app-58e4a7d6.js";const l={},c=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),t(" 漏洞描述")],-1),p=e("p",null,[t("influxdb是一款著名的时序数据库，其使用jwt作为鉴权方式。在用户开启了认证，但未设置参数"),e("code",null,"shared-secret"),t("的情况下，jwt的认证密钥为空字符串，此时攻击者可以伪造任意用户身份在influxdb中执行SQL语句。")],-1),u=e("p",null,"JWT，全称是JSON Web Token，是一种易于使用、无状态的鉴权方式。简单来说，就是Server端把JSON数据经过加密做成token，以授权给Client端。",-1),h=e("p",null,"参考链接：",-1),f={href:"https://www.komodosec.com/post/when-all-else-fails-find-a-0-day",target:"_blank",rel:"noopener noreferrer"},m={href:"https://docs.influxdata.com/influxdb/v1.7/administration/config/#http-endpoints-settings",target:"_blank",rel:"noopener noreferrer"},_=o(`<h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>执行如下命令启动influxdb 1.6.6：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker-compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>环境启动后，访问<code>http://your-ip:8086/debug/vars</code>即可查看一些服务信息，但此时执行SQL语句则会出现401错误：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202241319614.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2>`,6),b={href:"https://jwt.io/%E6%9D%A5%E7%94%9F%E6%88%90jwt",target:"_blank",rel:"noopener noreferrer"},g=o(`<div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>{
  &quot;alg&quot;: &quot;HS256&quot;,
  &quot;typ&quot;: &quot;JWT&quot;
}
{
  &quot;username&quot;: &quot;admin&quot;,
  &quot;exp&quot;: 1745680213
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中，<code>admin</code>是一个已经存在的用户，<code>exp</code>是一个时间戳，代表着这个token的过期时间，你需要设置为一个未来的时间戳，<code>secret</code>置空。</p><p>最终生成的token：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202241328222.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>发送带有这个jwt token的数据包，注意Content-Type设置为<code>application/x-www-form-urlencoded</code>。</p><p>可见SQL语句执行成功：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202241333480.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,7);function v(x,k){const n=d("ExternalLinkIcon");return s(),r("div",null,[c,p,u,h,e("ul",null,[e("li",null,[e("a",f,[t("https://www.komodosec.com/post/when-all-else-fails-find-a-0-day"),a(n)])]),e("li",null,[e("a",m,[t("https://docs.influxdata.com/influxdb/v1.7/administration/config/#http-endpoints-settings"),a(n)])])]),_,e("p",null,[t("借助"),e("a",b,[t("https://jwt.io/来生成jwt"),a(n)]),t(" token：")]),g])}const y=i(l,[["render",v],["__file","InfluxDB 未授权访问漏洞.html.vue"]]);export{y as default};
