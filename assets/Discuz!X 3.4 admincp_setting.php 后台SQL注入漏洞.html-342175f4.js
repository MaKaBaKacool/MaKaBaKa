import{_ as a}from"./plugin-vue_export-helper-c27b6911.js";import{o as i,c as e,e as t}from"./app-58e4a7d6.js";const n={},p=t(`<h2 id="漏洞描述" tabindex="-1"><a class="header-anchor" href="#漏洞描述" aria-hidden="true">#</a> 漏洞描述</h2><p>不久以前Discuz!X的后台披露了一个sql注入的漏洞，这里也要感谢漏洞的发现和研究者（无糖的kn1f3)。</p><h2 id="漏洞影响" tabindex="-1"><a class="header-anchor" href="#漏洞影响" aria-hidden="true">#</a> 漏洞影响</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Discuz!X &lt;3.4 R20191201 版本
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>将 <strong>upload</strong>目录下的文件拷入<strong>phpstudy</strong>下的WWW目录打开网站按照步骤安装就行了</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202170909104.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202170909233.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>来到后台页面, 在 <strong>UCenter 应用 ID</strong> 位置的参数添加单引号并抓包</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202170909920.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>发现出现SQL语句报错</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202170909020.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>使用报错注入去获取版本号</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202170909358.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>这里的参数为 <code>settingnew[uc][appid]</code></p><p>查看文件 <strong>\\source\\admincp\\admincp_setting.php</strong>， 在2677行找到了输入点</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202170910537.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>根据报错语句找到SQL语句执行点，在文件<strong>uc_client\\model\\base.php</strong> 中的 206行</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202170910751.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>通过这里的语句可以看到我们可以使用 <strong>union注入</strong> 的方法来写入恶意文件(<strong>secure_file_priv不能为Null</strong>)</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202170910657.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><div class="language-plain line-numbers-mode" data-ext="plain"><pre class="language-plain"><code>1&#39; union select &quot;&lt;?php phpinfo();?&gt;&quot;  into outfile &#39;D:/test.php&#39;;--+
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>也可以使用其他的方法</p>`,24),r=[p];function o(s,c){return i(),e("div",null,r)}const l=a(n,[["render",o],["__file","Discuz!X 3.4 admincp_setting.php 后台SQL注入漏洞.html.vue"]]);export{l as default};
