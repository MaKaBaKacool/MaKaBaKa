import{_ as t}from"./plugin-vue_export-helper-c27b6911.js";import{r as n,o,c as s,a as e,b as a,d as i,e as l}from"./app-58e4a7d6.js";const c={},d=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),a(" 漏洞描述")],-1),p=e("p",null,"Apache Airflow是一款开源的，分布式任务调度框架。在其1.10.10版本及以前，如果攻击者控制了Celery的消息中间件（如Redis/RabbitMQ），将可以通过控制消息，在Worker进程中执行任意命令。",-1),u=e("p",null,"由于启动的组件比较多，可能会有点卡，运行此环境可能需要准备2G以上的内存。",-1),h=e("p",null,"参考链接：",-1),_={href:"https://lists.apache.org/thread/cn57zwylxsnzjyjztwqxpmly0x9q5ljx",target:"_blank",rel:"noopener noreferrer"},m={href:"https://github.com/apache/airflow/pull/9178",target:"_blank",rel:"noopener noreferrer"},b=l(`<h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Vulhub依次执行如下命令启动Apache Airflow 1.10.10：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>#初始化数据库
docker-compose run airflow-init

#启动服务
docker-compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>利用这个漏洞需要控制消息中间件，Vulhub环境中Redis存在未授权访问。通过未授权访问，攻击者可以下发自带的任务<code>airflow.executors.celery_executor.execute_command</code>来执行任意命令，参数为命令执行中所需要的数组。</p>`,5),x={href:"https://github.com/vulhub/vulhub/blob/master/airflow/CVE-2020-11981/exploit_airflow_celery.py",target:"_blank",rel:"noopener noreferrer"},f=e("code",null,"touch /tmp/airflow_celery_success",-1),v=l(`<div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>pip install redis
python exploit_airflow_celery.py [your-vps-ip]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>查看日志：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker-compose logs airflow-worker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>可以看到如下信息：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202204251947997.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker-compose exec airflow-worker ls -l /tmp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>可以看到成功创建了文件<code>airflow_celery_success</code>：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202204251947998.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,8);function g(w,y){const r=n("ExternalLinkIcon");return o(),s("div",null,[d,p,u,h,e("ul",null,[e("li",null,[e("a",_,[a("https://lists.apache.org/thread/cn57zwylxsnzjyjztwqxpmly0x9q5ljx"),i(r)])]),e("li",null,[e("a",m,[a("apache/airflow#9178"),i(r)])])]),b,e("p",null,[a("使用"),e("a",x,[a("exploit_airflow_celery.py"),i(r)]),a("这个脚本来执行命令"),f,a("：")]),v])}const z=t(c,[["render",g],["__file","Apache Airflow Celery 消息中间件命令执行 CVE-2020-11981.html.vue"]]);export{z as default};
